PHTTP198.189.255.216"Ø
.GET /cnn/macalerts/js/safaripush.js HTTP/1.1
Host: i.cdn.turner.com
Connection: keep-alive
Accept: */*
vUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36
Referer: http://www.cnn.com/
$Accept-Encoding: gzip,deflate,sdch
!Accept-Language: en-US,en;q=0.8

*Ø
HTTP/1.1 200 OK
Server: Apache
.Last-Modified: Thu, 09 Jan 2014 00:36:33 GMT
Accept-Ranges: bytes
Content-Length: 3354
(Content-Type: application/x-javascript
Cache-Control: max-age=1993
(Expires: Mon, 24 Mar 2014 20:35:42 GMT
%Date: Mon, 24 Mar 2014 20:02:29 GMT
Connection: keep-alive
œ
var safaripushLib = function(param) {

     var userAgent = /7.*Safari/;
     var rootURL = 'https://redalert.cnn.com/push';
     var appNS = 'web.com.cnn.redalert';
     var pushToken = '';

     var permGranted = 'granted';
     var permDenied = 'denied';
     var permDefault = 'default';



     function requestPermissions(clientID, callback) {

         var clientPermission = permDenied;

         window.safari.pushNotification.requestPermission(rootURL, appNS, {
             "id": clientID
         }, function(result) {

             clientPermission = result.permission;

             if (result.permission === permGranted) {
                 console.log("user gratned permission");
             } else if (result.permission === permDenied) {
                 console.log("permission denied");
             }
         });
         if (callback) callback(clientPermission);
     }


     function checkPermissions(clientID, callback) {

         //make sure we are in the right browser
         if (this.checkEnv()) {

             //get the current permission state in the browser
             var pResult = window.safari.pushNotification.permission(appNS);
             var clientPermission = pResult.permission;

             if (clientPermission === permDefault) {
                 //request permission from user
                 requestPermissions(clientID, function(clientPermission) {

                     pResult = window.safari.pushNotification.permission(appNS);

                     var clientResult = {
                         pushToken: pushToken,
                         permission: clientPermission,
                         clientID: clientID
                     };

                     if (callback) callback(clientResult);
                 });

             } else {

                 if (clientPermission === permGranted) {

                     pushToken = pResult.deviceToken;
                 } else if (clientPermission === permDenied) {
                     pushToken = '';
                 }

                 var clientResult = {
                     pushToken: pushToken,
                     permission: clientPermission,
                     clientID: clientID
                 };

                 if (callback) callback(clientResult);
             }
         } else {
             //we are not in safari so nothing here.  Set everything to not going to work
             pushToken = null;
             clientPermission = permDenied;

             var clientResult = {
                 pushToken: pushToken,
                 permission: clientPermission,
                 clientID: clientID
             };

             if (callback) callback(clientResult);
         }
     }


     function checkEnv() {
         if (userAgent.test(window.navigator.userAgent) > -1) {
           return true;
         } else {
           return false;
         }
     }

     function currentPermissions() {
         if (checkEnv()) {
             var pResult = window.safari.pushNotification.permission(appNS);

             return pResult.permission;
         } else {
             return permDenied;
         }
     }

     return {
         requestPermissions: requestPermissions,
         checkPermissions: checkPermissions,
         checkEnv: checkEnv,
         currentPermissions: currentPermissions
     };

 }();
