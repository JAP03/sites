PHTTP38.102.136.104"’
5GET /stationmaps/wundermap.min.js?v=3.5.16 HTTP/1.1
Host: www.wunderground.com
Connection: keep-alive
Accept: */*
vUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36
'Referer: http://www.wunderground.com/
$Accept-Encoding: gzip,deflate,sdch
!Accept-Language: en-US,en;q=0.8
$Cookie: DT=1396996584:18493:365-o4

*ë‰
HTTP/1.1 200 OK
%Date: Tue, 08 Apr 2014 22:36:25 GMT
(Server: Apache/1.3.42 (Unix) PHP/5.3.2
.Last-Modified: Sat, 11 Jan 2014 00:47:00 GMT
Accept-Ranges: bytes
Content-Length: 312288
Connection: close
(Content-Type: application/x-javascript
â‡
var wundermap;(function(a){wundermap={map:null,options:{iconsdomain:"http://icons.wxug.com",stationicondomain:"http://stationicon-ak.wxug.com",units:"english",brand:null,RadSatSync:true,accordion:true,StreetsOverlay:false,moveToTop:false,infobox:{disableAutoPan:false,position:null},timezone:{"short":"UTC","long":"UTC",offset:{text:"+0000",hours:0},useBrowserTime:false},accordionStartExpanded:"activelayers",apikey:"e466a9feecedb389",layerDefaults:{},classNames:{},palettes:{},refreshPeriod:0},layers:{},date:null,date_is_changed:false,locked_:false,loading_:false,utils:{},selmarker:null,imageFormat:"png",status:{animating:false},firstIdle:false,mapTypes:[],classNames:{timelordWarning:"timelord-warning",timelordAware:"timelord-aware",layerTitleHover:"hover",layerTitleSelected:"selected",optionsInfobox:"infoBox posAbs",infoboxPointerTop:"infobox-pointer-top",infoboxPointerBot:"infobox-pointer-bot",accordionHover:"accordion-header-hover",accordionSelected:"accordion-header-selected",selected:"selected",presentationMode:"presentationMode"},type:"satellite",palettes:{temperature:[[-9999,17,17,17,255,255,255],[-60,17,17,17,255,255,255],[-55,33,0,107,255,255,255],[-50,76,0,107,255,255,255],[-45,107,0,107,255,255,255],[-40,130,0,130,255,255,255],[-35,153,0,153,255,255,255],[-30,179,0,179,255,255,255],[-25,204,0,204,255,255,255],[-20,230,0,230,255,255,255],[-15,255,0,255,255,255,255],[-10,209,0,255,255,255,255],[-5,158,0,255,255,255,255],[0,102,0,255,255,255,255],[5,0,0,255,255,255,255],[10,0,74,255,255,255,255],[15,0,115,255,255,255,255],[20,0,163,255,255,255,255],[25,0,204,255],[30,0,230,255],[35,0,255,255],[40,0,255,179],[45,127,255,0],[50,206,255,0],[55,255,255,0],[60,255,230,0],[65,255,204,0],[70,255,174,0],[75,255,153,0],[80,255,127,0],[85,255,79,0],[90,255,0,0],[95,255,69,69],[100,255,104,104],[105,255,135,135],[110,255,158,158],[115,255,181,181],[120,255,207,207],[125,255,232,232],[9999,255,232,232]]}};wundermap.setOptions=function(c){a.extend(true,wundermap.options,c);wundermap.map=wundermap.options.map;a.extend(true,wundermap.classNames,wundermap.options.classNames);a.extend(true,wundermap.palettes,wundermap.options.palettes);wundermap.debug=wundermap.options.debug||0};wundermap.getMapTypeId=function(d){var c={map:google.maps.MapTypeId.ROADMAP,sat:google.maps.MapTypeId.SATELLITE,hyb:google.maps.MapTypeId.HYBRID,ter:google.maps.MapTypeId.TERRAIN,wui:"wumaps"};return c[d]||d};wundermap.getMapTypes=function(d){var f=[];for(var e in google.maps.MapTypeId){f.push(google.maps.MapTypeId[e]);if(e=="ROADMAP"&&d=="all"){f.push("darkmap");f.push("lightmap")}}var c=["polarnavy_vector","polarnavy_raster",];if(d=="google"){return f}else{if(d=="wund"){return c}else{return f.concat(c)}}};wundermap.addMapTypes=function(){var c=this.map;var m=this.mapTypes;var l=[{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#b8bece"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{color:"#f0f0f0"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{visibility:"simplified"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"transit.station.airport",stylers:[{saturation:-100},{gamma:1.18}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#b4b4b4"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#a0a7be"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{weight:1},{color:"#b4b4b4"}]},{featureType:"administrative",stylers:[{saturation:-100}]},{featureType:"landscape",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels"},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"on"},{color:"#808080"}]},{featureType:"administrative.locality",elementType:"labels.text",stylers:[{visibility:"on"},{color:"#e6e6e6"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#2d2d2d"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#2d2d2d"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#e6e6e6"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#a5a5a5"}]},{featureType:"road.highway.controlled_access",elementType:"labels.text",stylers:[{visibility:"on"},{saturation:-100}]}];var e=new google.maps.StyledMapType(l,{name:"Light Map"});m.push({id:"lightmap",mapType:e});var d=[{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#646464"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{color:"#343434"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#474747"}]},{featureType:"administrative",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#dcdcdc"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"on"},{weight:1},{color:"#232323"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#232323"}]},{featureType:"administrative.neighborhood",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#dcdcdc"},{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#343434"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels",stylers:[{saturation:-100},{gamma:0.99}]},{featureType:"road.highway.controlled_access",elementType:"geometry.fill",stylers:[{color:"#808080"}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:-100}]},{featureType:"transit.station.rail",stylers:[{saturation:-100}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#9b9b9b"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"transit.station.airport",stylers:[{saturation:-100},{lightness:-45}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"on"},{weight:1.1},{color:"#dcdadc"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.highway.controlled_access",elementType:"labels.icon",stylers:[{gamma:0.01}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{saturation:-100},{gamma:0.45}]},{featureType:"transit",elementType:"labels.icon",stylers:[{saturation:-100},{visibility:"on"},{gamma:0.63}]}];var k=new google.maps.StyledMapType(d,{name:"Dark Map"});m.push({id:"darkmap",mapType:k});var g=["polarnavy_vector","polarnavy_raster"];m.push({id:"polarnavy_vector",mapType:new google.maps.ImageMapType({getTileUrl:function(s,q){var p=1<<q;var o=((s.x%p)+p)%p;var r=s.y;return"http://timelord.wunderground.com/basemaps/marine/vector/m"+q+"/XG"+o+"/YG"+r+".png"},tileSize:new google.maps.Size(256,256),maxZoom:15,name:"Polar Navy (Vector)",alt:"Polar Navy (Vector)"})});m.push({id:"polarnavy_raster",mapType:new google.maps.ImageMapType({getTileUrl:function(s,q){var p=1<<q;var o=((s.x%p)+p)%p;var r=s.y;return"http://timelord.wunderground.com/basemaps/marine/raster/m"+q+"/XG"+o+"/YG"+r+".png"},tileSize:new google.maps.Size(256,256),maxZoom:15,name:"Polar Navy (Raster)",alt:"Polar Navy (Raster)"})});var h=a('<div>Map data &copy; <a href="http://www.polarnavy.com">Polar Navy</a></div>');var n=(wui.arrayContains(c.getMapTypeId(),g));wundermap.addHTMLControl({container:h,position:google.maps.ControlPosition.BOTTOM_RIGHT,styles:{display:(n)?"block":"none",margin:"5px",width:"auto"}});google.maps.event.addListener(c,"maptypeid_changed",function(){var o=c.getMapTypeId();if(wui.arrayContains(o,g)){h.show()}else{h.hide()}});for(var f=0;f<m.length;f++){c.mapTypes.set(m[f].id,m[f].mapType)}};wundermap.initialize=function(){if(this.options.debug==1){wui.log("wundermap.initialize")}if(this.options.customMapTypes){this.addMapTypes()}var g=wundermap.map.getMapTypeId();var s=wundermap.getMapTypes("google");var m=a.map(wundermap.mapTypes,function(C,B){return C.id});if(!wui.arrayContains(g,s)&&!wui.arrayContains(g,m)){if(wundermap.debug==1){wui.log('Notice: map type "'+g+'" does not exist. Setting to ROADMAP')}wundermap.map.setMapTypeId(google.maps.MapTypeId.ROADMAP)}if(this.options.timezone.useBrowserTime===true){var p=wundermap.utils.getBrowserTimezone();a.extend(true,this.options.timezone,p)}if(this.options.datepicker){this.timelord.initialize()}var d={name:"wundermap",sidebarPrefix:"wundermap"};var z={fn_getStaticURL:function(){return wundermap.options.iconsdomain+"/graphics/clear.gif"}};var q=new wundermap.ImageLayer(this.map,d,z,0);q.setMap(this.map);google.maps.event.trigger(this,"beforelayersinitialize");var o=0;for(var v=0;v<this.options.layers.length;v++){var x=false;var r=[];var k=this.options.layers[v].layers;if(k){x=true}else{k=[this.options.layers[v]]}var f=this.createDefaultUI(k,x,this.options.layers[v]);for(var u=0;u<k.length;u++){var c=a.extend(true,{},this.options.layerDefaults,k[u]);c.accordionHeader=f.header;c.accordionContent=f.content;var h=c.active||0;var A=this.layers[c.layer];if(!A){if(wundermap.debug>0){wui.log("Error: layer is undefined: "+c.layer)}continue}A.initialize(this.map,c);if(wundermap.utils.isCheckedValue(h)){if(!A.elt_radio[0]){A.toggle(true)}else{if(o<1){o++;A.toggle(true)}else{A.setRadioButton(false)}}}else{A.setCheckbox(false);A.setRadioButton(false)}if(x){r.push(A)}}if(x){var n=new wundermap.LayerGroup();n.initialize(r,this.options.layers[v])}}google.maps.event.trigger(this,"afterlayersinitialize");if(this.options.RadSatSync===true){this.RadSatSync.initialize()}if(this.options.accordion===true){this.setupAccordion();if(this.options.accordionStartExpanded=="activelayers"){for(var y in this.layers){var A=this.layers[y];if(A.active_){A.elt_titleBar.trigger("click")}}}}this.search.initialize("#mapSearchForm","#mapSearchBox","#mapFavorites");var t=this;google.maps.event.addListener(this,"infowindowopen",function(){t.locked_=true});google.maps.event.addListener(this,"infowindowclose",function(){t.locked_=false});google.maps.event.addListener(this.map,"idle",function(){wundermap.firstIdle=true;var B={eventname:"idle"};if(t.options.debug==1){wui.log("google Event: idle")}if(t.locked_===true){t.locked_=false}else{t.refresh(B);t.closeInfoBox()}});if(this.options.linkToThisPage){google.maps.event.addListener(this.map,"idle",function(){t.makeLinkToThisPage()});google.maps.event.addListener(this.map,"maptypeid_changed",function(){t.makeLinkToThisPage()});google.maps.event.addListener(wundermap,"layertoggled",function(C,B){t.makeLinkToThisPage()});google.maps.event.addListener(wundermap,"datepicker_changed",function(B,C){t.makeLinkToThisPage()});google.maps.event.addListener(wundermap,"settings_changed",function(B){t.makeLinkToThisPage()});t.makeLinkToThisPage();if(this.options.linkToThisPage.panel){this.setupLinkToThisPagePanel()}}if(this.options.linkToSavePrefs){a(this.options.linkToSavePrefs.button).click(function(B){B.preventDefault();t.savePreferences()})}if(this.options.linkToSettings){this.setupLinkToPanel(this.options.linkToSettings)}if(this.options.linkToTime){this.setupLinkToPanel(this.options.linkToTime)}if(this.options.logo!==false){this.addLogoControl(this.options.logo)}if(this.options.continentControls){this.addControlsZoomContinent(this.options.continentControls)}if(this.options.zoomQuickControls){this.addControlsZoomQuick(this.options.zoomQuickControls)}if(this.options.StreetsOverlay){this.StreetsOverlay.initialize()}if(this.options.fullScreen){wundermap.setupFullScreen()}if(this.options.top){google.maps.event.addListenerOnce(wundermap.map,"idle",function(B){wundermap.moveToTop(t.options.top)})}if(a("#map_panel_button")[0]){this.addHTMLControl({controlText:"",index:-1,position:google.maps.ControlPosition.TOP_RIGHT,styles:{width:"30px"}})}if(a.browser.msie&&b(a.browser.version.charAt(0))<7){this.imageFormat="gif"}this.showPin();this.hacksHacks();if(true){var l={};var e=google.maps.event.addListener(this,"loading_changed",function(D){var C=[];for(var B in l){if(l[B]===true){C.push(B)}}});var e=google.maps.event.addListener(this,"layerload",function(B,C,E){var F=(C=="loadstart");l[B]=F;var D=w();if(D!=t.loading_){t.loading_=D;google.maps.event.trigger(t,"loading_changed",t.loading_)}});function w(){var C=false;for(var B in l){if(l[B]===true){C=true;break}}return C}}google.maps.event.trigger(this,"load")};wundermap.hacksHacks=function(){a(".slider_bg .slider_knob").remove()};wundermap.refresh=function(e){this.imagemap_container.refresh(e);for(var c in this.layers){var d=this.layers[c];if(d.active_){d.refresh(e)}}};wundermap.resize=function(){google.maps.event.trigger(wundermap.map,"resize")};wundermap.getLinkToThisPage=function(d){var c="?"+this.toQueryString(d);return c};wundermap.makeLinkToThisPage=function(){var e=this.options.linkToThisPage;if(!e){return}var d=this.getLinkToThisPage();if(e.rawlink){a(e.rawlink).attr("href",d);if(e.rawlink_input){var c=(a(e.rawlink)[0])?a(e.rawlink)[0].href:"";a(e.rawlink_input).val(c)}}return d};wundermap.setupLinkToThisPagePanel=function(){var g=this.options.linkToThisPage;if(!g){return}var f=a(g.rawlink);var c=a(g.panel.shortlink);var e=a(g.panel.shortlink_input);var h=a(g.panel.button);var d=a(g.panel.panel);var l=a(g.panel.fb_share);var k=g.panel.buttonActiveClass;if(!f[0]||!c[0]||!h[0]||!d[0]){return}h.click(function(o){d.toggleClass("none");if(d.hasClass("none")){if(k){h.removeClass(k)}return}else{if(k){h.addClass(k)}}var n=f[0].href;if(!n||n.length<1){return}var m="/miniurl/api.php?url="+encodeURIComponent(n);c.attr("href","javascript:void(0)");e.val("");a.ajax({url:m,success:function(q,p){c.attr("href",q);e.val(q);l.attr("href","http://www.facebook.com/sharer.php?u="+encodeURIComponent(q)+"&t="+encodeURIComponent(document.title))},error:function(){if(wundermap.debug>0){wui.log("Ajax MiniURL failed")}}})})};wundermap.setupLinkToPanel=function(e){if(!e||!e.panel){return}var d=a(e.panel.button);var c=a(e.panel.panel);var f=e.panel.buttonActiveClass;if(!d[0]||!c[0]){return}d.click(function(g){c.toggleClass("none");if(c.hasClass("none")){if(f){d.removeClass(f)}}else{if(f){d.addClass(f)}}})};wundermap.setupFullScreen=function(){var c=this.options.fullScreen;if(!c){return}var d=a(c.button);var e=a(c.content);var g=c.buttonActiveClass;d.bind("click",function(h){if(!wui.fullscreen.supported){wui.log("Sorry, your browser does not support full screen mode")}else{if(wui.fullscreen.active){wui.fullscreen.exit()}else{wui.fullscreen.enter(e[0])}}});a(document).bind("fullscreenchange mozfullscreenchange webkitfullscreenchange",function(){f()});function f(){if(wui.fullscreen.active){if(g){d.addClass(g)}}else{if(g){d.removeClass(g)}}}};wundermap.getPrefs=function(c){var c=a.extend(true,{},{exclude:null,only:null,type:""},c);var g=false;var d=this.map;var h={lat:d.getCenter().lat().toFixed(5),lon:d.getCenter().lng().toFixed(5),zoom:d.getZoom(),type:d.getMapTypeId()};if(this.options.top){var f=this.getActiveLayers();for(var k=0;k<f.length;k++){if(f[k].name_==this.options.top){h.top=this.options.top;break}}}if(this.options.datepicker&&this.date_is_changed){var e=new Date();var m=new Date(e.getTime());m.setUTCMinutes(0);m.setUTCSeconds(0);m.setUTCMilliseconds(0);if(c.type=="prefscookie"){h.date="";h.time=""}else{if(wundermap.date&&wundermap.date.getTime()<=e.getTime()&&wundermap.date.getTime()>=m.getTime()){}else{h.date=a("#map_datepicker_date").val();h.time=a("#map_datepicker_time").val()}}}if(c.type!="prefscookie"){h.units=(this.options.units=="metric")?"metric":"english";if(this.search&&this.search.marker){var l=this.search.marker.getPosition();if(d.getBounds().contains(l)){h.pin=this.search.title;h.plat=l.lat().toFixed(5);h.plon=l.lng().toFixed(5);g=true}}if(!g&&this.options.pin&&this.options.pin.title){var l=new google.maps.LatLng(this.options.pin.lat,this.options.pin.lon);if(d.getBounds()&&d.getBounds().contains(l)){h.pin=this.options.pin.title;h.plat=this.options.pin.lat;h.plon=this.options.pin.lon;g=true}}}if(c.only&&a.isArray(c.only)){a.each(h,function(n,o){if(!wui.arrayContains(n,c.only)){delete h[n]}})}if(c.exclude&&a.isArray(c.exclude)){a.each(h,function(n,o){if(wui.arrayContains(n,c.exclude)){delete h[n]}})}return h};wundermap.toQueryString=function(g){var g=a.extend(true,{},{exclude:null,only:null,type:"querystring"},g);var k=this.getPrefs(g);var c=[];var h=true;if(g.only&&a.isArray(g.only)&&!wui.arrayContains("layers",g.only)){h=false}if(g.exclude&&a.isArray(g.exclude)&&wui.arrayContains("layers",g.exclude)){h=false}if(h){for(var e in this.layers){var f=this.layers[e];if(f.initialized_===true){c.push(f.toQueryString())}}}var d=a.param(k);if(c.length>0){d+="&"+c.join("&")}return d};wundermap.toPrefsObject=function(d){var d=a.extend(true,{},{exclude:null,only:null,prefix:"GMAP",type:"prefscookie"},d);var f={};var l=this.getPrefs(d);var c=true;if(d.only&&a.isArray(d.only)&&!wui.arrayContains("layers",d.only)){c=false}if(d.exclude&&a.isArray(d.exclude)&&wui.arrayContains("layers",d.exclude)){c=false}if(c){for(var h in this.layers){var g=this.layers[h];if(g.initialized_===true){a.extend(l,g.toPrefsObject())}}}for(var m in l){var k=m.toUpperCase().replace(".","");var e=l[m];if(e===true){e=1}if(e===false){e=0}if(e!==null){f[d.prefix+k]=e}}return f};wundermap.savePreferences=function(h){var f=this.options.linkToSavePrefs||{};var k=f.loadingClass||"ajax-loading";var g={};var d=this.toPrefsObject(h);var e=0;for(var c in d){g["setprefs."+e+".key"]=c;g["setprefs."+e+".val"]=d[c];e++}a(f.button).addClass(k);a.ajax({url:"/auto/wui/geo/PrefDump/index.html",type:"POST",data:g,dataType:"html",success:function(m,l,n){a(f.button).removeClass(k)},error:function(n,l,m){a(f.button).removeClass(k);wui.log("Error: failed to save wundermap preferences")}})};wundermap.showPin=function(){var e=this.options.pin;if(e&&e.title){var c=new google.maps.LatLng(e.lat,e.lon);var d=new google.maps.Marker({clickable:true,map:wundermap.map,position:c,title:e.title});google.maps.event.addListener(d,"click",function(h){var g=this.getPosition().lat().toFixed(4);var k=this.getPosition().lng().toFixed(4);var f=wundermap.getBalloonContentPin(e);wundermap.openInfoBox({content:f,marker:this})})}};wundermap.getBalloonContentPin=function(d){var c='<div class="PinBalloon">';if(d.type=="earthquake"){c+='<div class="infobox-title">Earthquake</div>'}else{c+='<div class="infobox-title">Information</div>'}c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">'+d.title+"</div>";c+='<div class="p10"><a href="/cgi-bin/findweather/hdfForecast?query='+d.lat+","+d.lon+'">View Conditions</a></div>';c+="</div>";return c};wundermap.showMapSize=function(){};wundermap.setupAccordion=function(){var c=this.options.accordionSpeed||"slow";var d=a(".accordion-header");d.click(function(k){var m=a(this);var h=m.next(".accordion-content");var f=wundermap.classNames.accordionSelected;var g=a(k.target).is("input[type=checkbox]");var l=(g&&k.target.checked);if(g&&l){m.addClass(f);h.slideDown(c)}else{if(g&&!l){m.removeClass(f);h.slideUp(c)}else{if(m.hasClass(f)){m.removeClass(f);h.slideUp(c)}else{m.addClass(f);h.slideDown(c)}}}});d.mouseenter(function(f){a(this).addClass(wundermap.classNames.accordionHover)}).mouseleave(function(f){a(this).removeClass(wundermap.classNames.accordionHover)})};wundermap.getActiveLayers=function(){var e=[];for(var c in this.layers){var d=this.layers[c];if(d.active_){e.push(d)}}return e};wundermap.isActiveLayer=function(c){return(this.layers[c]&&this.layers[c].active_)?true:false};wundermap.moveToTop=function(c){var e=this.getActiveLayers();for(var d=0;d<e.length;d++){if(e[d].name_==this.options.top){e[d].moveToTop();break}}};wundermap.createDefaultUI=function(g,f,e){var c={};var d=a("#accordion");if(f){var h=wundermap.Layer.prototype.createDefaultUI({prefix:"LayerGroup"+e.id,tagName:"div",title:e.title,wuForm:!!wundermap.options.wuForm});h.addClass("accordion-header");c.header=h;html='<div class="accordion-content"></div>';c.content=a(html);d.append(c.header).append(c.content)}return c};wundermap.handleAnimatingChanged=function(c){var h={eventname:"animating_changed"};wundermap.status.animating=!!c;google.maps.event.trigger(wundermap,"animating_changed",wundermap.status.animating);if(c===false){var k=wundermap.getActiveLayers();for(var f=0;f<k.length;f++){var e=k[f];for(var d=0;d<e.imagelayers_.length;d++){var g=e.imagelayers_[d];if(g.callbacks_.fn_getDataURL){g.refresh(h)}}}}};wundermap.timelord=function(){};wundermap.timelord.initialize=function(){wundermap.options.datepicker=a.extend(true,{hoverPrettyDate:true},wundermap.options.datepicker);this.elt_container=a("#map_datepicker");this.elt_slider=a("#map_datepicker_jog_control");this.elt_date=a("#map_datepicker_date");this.elt_time=a("#map_datepicker_time");this.elt_cal_btn=a("#map_datepicker_cal");this.elt_pretty=a("#map_datepicker_pretty, .map_datepicker_pretty");this.elt_inline_calendar=a("#map_inline_calendar");this.elt_incrementors_container=this.elt_container.find(".cal-incrementors");if(!this.elt_incrementors_container[0]){this.elt_incrementors_container=a("#map_timebar #map_cal_incrementors")}this.elt_incrementors=this.elt_incrementors_container.find("a");this.elt_incrementors_btn=this.elt_container;var f=a("#map_time_select");if(f[0]&&f.parent().hasClass("nolabels")){this.elt_cal_btn=f}var k={"cal-year-minus":function(m){m.setFullYear(m.getFullYear()-1)},"cal-month-minus":function(m){m.setMonth(m.getMonth()-1)},"cal-day-minus":function(m){m.setDate(m.getDate()-1)},"cal-hour-minus":function(m){m.setHours(m.getHours()-1)},"cal-now":function(m){m.setTime((new Date()).getTime())},"cal-hour-plus":function(m){m.setHours(m.getHours()+1)},"cal-day-plus":function(m){m.setDate(m.getDate()+1)},"cal-month-plus":function(m){m.setMonth(m.getMonth()+1)},"cal-year-plus":function(m){m.setFullYear(m.getFullYear()+1)}};var l=null;var e=1000;var c=wundermap.options.datepicker.date;var h=wundermap.options.datepicker.time;if(c&&!h){h="00:00:00"}else{if(!c){var d=new Date();c=wui.date.strftime("%Y-%m-%d",d,true);h=wui.date.strftime("%H:%M:00",d,true)}}if(h.length<=2){h+=":00:00"}var g=c.replace(/-/gi,"/")+" "+h+" GMT";wundermap.date=new Date(g);wundermap.date_prev=new Date(g);wundermap.userdate=this.getDateInUserTime(wundermap.date);this.displayDate(wundermap.date);if(wundermap.options.datepicker.is_changed=="1"){wundermap.date_is_changed=true}this.elt_incrementors.click(function(o){var m=a(this).attr("data-cal-increment");var p=new Date(wundermap.date.getTime());var n=k[m];if(n){n(p);wundermap.timelord.displayDate(p);wundermap.timelord.saveDate(p)}if(m=="cal-now"){wundermap.timelord.handleNow()}return false});if(wundermap.options.datepicker.hoverPrettyDate){this.elt_incrementors_btn.mouseenter(function(){wundermap.timelord.show()}).mouseleave(function(){wundermap.timelord.hide()});this.elt_incrementors_container.mouseenter(function(){wundermap.timelord.show()}).mouseleave(function(){wundermap.timelord.hide()})}if(this.elt_inline_calendar[0]){this.elt_calendar=this.elt_inline_calendar}else{this.elt_calendar=this.elt_date}this.elt_calendar.datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,onSelect:function(o,m){var n=a(this).datepicker("getDate");var p=new Date(wundermap.date.getTime());p.setUTCFullYear(n.getFullYear());p.setUTCMonth(n.getMonth());p.setUTCDate(n.getDate());wundermap.timelord.displayDate(p);wundermap.timelord.saveDate(p)}});this.elt_date.datepicker("hide");this.elt_cal_btn.click(function(m){wundermap.timelord.elt_date.datepicker("show")})};wundermap.timelord.getDateInUserTime=function(c){var e=new Date(c.getTime());e.setUTCHours(e.getUTCHours()+wundermap.options.timezone.offset.hours);return e};wundermap.timelord.saveDate=function(e,c){var f=this.getDateInUserTime(e);wundermap.date_prev.setTime(wundermap.date.getTime());wundermap.date.setTime(e.getTime());wundermap.userdate.setTime(f.getTime());wundermap.date_is_changed=true;this.elt_calendar.datepicker("setDate",e);if(c&&c.silent){}else{google.maps.event.trigger(wundermap,"datepicker_changed",wundermap.date,wundermap.userdate,c)}};wundermap.timelord.displayDate=function(h){var c=wui.date.strftime("%Y-%m-%d",h,true);var g=wui.date.strftime("%H:00",h,true);wundermap.timelord.elt_date.val(c);wundermap.timelord.elt_time.val(g);wundermap.timelord.elt_pretty.text(h.toUTCString());var k=this.getDateInUserTime(h);var e=wundermap.options.timezone["long"]+" (GMT"+wundermap.options.timezone.offset.text+")";var f=wui.date.strftime("%a, %d %b %Y, %H:%M ",k,true)+'<span title="'+e+'">'+wundermap.options.timezone["short"]+"</span>";wundermap.timelord.elt_pretty.attr("title",h.toUTCString());wundermap.timelord.elt_pretty.html(f)};wundermap.timelord.set=function(e,c){if(a.type(e)=="date"){var e=e}else{if(a.type(e)=="number"){var e=new Date(e*1000)}else{if(a.type(e)=="string"){var e=new Date(e)}else{if(wundermap.debug>0){wui.log("Error: invalid argument to timelord.set")}return}}}wundermap.timelord.displayDate(e);wundermap.timelord.saveDate(e,c)};wundermap.timelord.setStep=function(c){if(a.type(c)=="date"){var c=c}else{if(a.type(c)=="number"){var c=new Date(c*1000)}else{if(a.type(c)=="string"){var c=new Date(c)}else{if(wundermap.debug>0){wui.log("Error: invalid argument to timelord.setStep")}return}}}wundermap.timelord.displayDate(c);var e=this.getDateInUserTime(c);google.maps.event.trigger(wundermap,"datepicker_step",c,e)};wundermap.timelord.get=function(){return new Date(wundermap.date.getTime())};wundermap.timelord.handleNow=function(){wundermap.date_is_changed=false};wundermap.timelord.show=function(){this.elt_incrementors_container.stop().show().removeClass("none")};wundermap.timelord.hide=function(){this.elt_incrementors_container.delay(800).hide(0)};wundermap.timelord.showMe=function(){this.elt_incrementors_container.toggle()};wundermap.timelord.getTooltipButton=function(c){return a('<span class="hasTimelord"></span>')};wundermap.timelord.getTooltipContent=function(e,d){var c="<div>Time control is available for this layer.";if(e.text){c+="You can select a date in this range:<br />"+e.text}c+='<br /><a href="javascript:void(0);" onclick="wundermap.timelord.showMe();">show me</a>';c+="</div>";return c};wundermap.StreetsOverlay={imageMapType:null,initialize:function(){this.imageMapType=new google.maps.ImageMapType({getTileUrl:function(c,d){var e=c.x%(1<<d);return"http://mt0.google.com/vt/v=apt.116&x="+e+"&y="+c.y+"&z="+d+"&s=G&lyrs=h"},tileSize:new google.maps.Size(256,256),isPng:false,maxZoom:20,name:"lyrs=h"});this.imageMapType.set("zIndex",100);google.maps.event.addListener(wundermap.map,"maptypeid_changed",function(){wundermap.StreetsOverlay.refresh()});google.maps.event.addListener(wundermap,"imagelayer_moved",function(){wundermap.StreetsOverlay.refresh()});this.refresh()},hide:function(){wundermap.utils.overlayMapTypes.removeByName("lyrs=h")},show:function(){if(this.imageMapType){wundermap.utils.overlayMapTypes.add(this.imageMapType)}},refresh:function(){this.hide();var c=wundermap.map.getMapTypeId();if(c==google.maps.MapTypeId.HYBRID){this.show()}}};wundermap.presentationMode={enabled:false,tally:0,mapOptions:{mapTypeControl:null,overviewMapControl:null,panControl:null,rotateControl:null,scaleControl:null,scrollwheel:null,streetViewControl:null,zoomControl:null},selectors:{elt_wrapper:"#map_wrapper"},toggle:function(c){var c=(arguments.length>0)?arguments[0]:!this.enabled;if(c){this.enter()}else{this.exit()}},enter:function(){this.enabled=true;this.tally++;var c={};for(var d in this.mapOptions){this.mapOptions[d]=wundermap.map.get(d);c[d]=false}c.scrollwheel=true;wundermap.map.setOptions(c);a(this.selectors.elt_wrapper).addClass(wundermap.classNames.presentationMode);wundermap.resize()},exit:function(){if(this.tally<1){return}this.enabled=false;wundermap.map.setOptions(this.mapOptions);a(this.selectors.elt_wrapper).removeClass(wundermap.classNames.presentationMode);wundermap.resize()}};wundermap.setHighlight=function(c){if(!this.selmarker&&c){this.selmarker=new google.maps.Marker({clickable:false,flat:true,icon:new google.maps.MarkerImage(wundermap.options.stationicondomain+"/gmapselected.png",new google.maps.Size(64,64),null,new google.maps.Point(32,32)),map:wundermap.map,optimized:false,position:c})}else{if(c){this.selmarker.setPosition(c);this.selmarker.setVisible(true)}else{if(this.selmarker){this.selmarker.setVisible(false)}}}};wundermap.zoomIn=function(){var d=this.map.getZoom();if(wundermap.infobox){var c=wundermap.infobox.getPosition();this.closeInfoBox();this.map.setOptions({center:c,zoom:d+1})}else{this.map.setZoom(d+1)}};wundermap.zoomOut=function(){var d=this.map.getZoom();if(wundermap.infobox){var c=wundermap.infobox.getPosition();this.closeInfoBox();this.map.setOptions({center:c,zoom:d-1})}else{this.map.setZoom(d-1)}};wundermap.panBy=function(c,d){this.map.panBy(c,d)};wundermap.zoomTo=function(e,f,d){var c=new google.maps.LatLng(e,f);this.closeInfoBox();this.map.setOptions({center:c,zoom:d})};wundermap.addControlToMap=function(c){var d=c.controlPosition;if(!d){return}wundermap.map.controls[d].push(c.container)};wundermap.addHTMLControl=function(e){var d=e.container;if(!d||!d[0]){d=a("<div></div>")}if(e.controlClass){d.addClass(e.controlClass)}if(e.controlText){d.html(e.controlText)}if(e.printable===false){d.addClass("noPrint")}if(e.styles){d.css(e.styles)}if(e.controlId){d.attr("id",e.controlId)}if(e.image){var f=e.title||"";d.html('<img src="'+e.image+'" alt="" title="'+f+'" />')}if(e.eventType){d.bind(e.eventType,e.eventFunction)}if(wui.defined(e.index)){d[0].index=e.index}var c=e.position||google.maps.ControlPosition.LEFT_BOTTOM;this.addControlToMap({container:d[0],controlPosition:c})};wundermap.addControlsZoomContinent=function(d){var c=d.geoIp;d.eventType="click";d.controlClass="mapQuickJumpDefault";d.printable=false;if(c){d.controlText="Zoom to Home";d.eventFunction=function(){var e=new google.maps.LatLng(c.lat,c.lon);wundermap.map.setCenter(e);wundermap.map.setZoom(8)};this.addHTMLControl(d)}d.controlText="Zoom to U.S.";d.eventFunction=function(){var e=new google.maps.LatLng(39.2322531,-96.1523437);wundermap.map.setCenter(e);wundermap.map.setZoom(4)};this.addHTMLControl(d);d.controlText="Zoom to Europe";d.eventFunction=function(){var e=new google.maps.LatLng(51.8357775,12.65625);wundermap.map.setCenter(e);wundermap.map.setZoom(4)};this.addHTMLControl(d)};wundermap.addControlsZoomQuick=function(g){var g=a.extend({},{controlClass:null,controlId:"mapQuickJump",controlButtonClass:"mapQuickJumpDefault",controlButtonClassActive:"mapQuickJumpActive",eventType:null,index:1,position:google.maps.ControlPosition.TOP_LEFT,printable:false,styles:{marginTop:"5px"}},g);var f=a("<div></div>");var h=a("<div>Local</div>").addClass(g.controlButtonClass).bind("click",function(m){wundermap.map.setZoom(10)});var l=a("<div>Region</div>").addClass(g.controlButtonClass).bind("click",function(m){wundermap.map.setZoom(7)});var k=a("<div>Continent</div>").addClass(g.controlButtonClass).bind("click",function(m){wundermap.map.setZoom(4)});f.append(h,l,k);g.container=f;this.addHTMLControl(g);var e=function(){var m=wundermap.map.getZoom();h.removeClass(g.controlButtonClassActive);l.removeClass(g.controlButtonClassActive);k.removeClass(g.controlButtonClassActive);if(m==10){h.addClass(g.controlButtonClassActive)}else{if(m==7){l.addClass(g.controlButtonClassActive)}else{if(m==4){k.addClass(g.controlButtonClassActive)}}}};e();google.maps.event.addListener(wundermap.map,"zoom_changed",e);var c=null;var d=function(){if(c){f.removeClass("maptypeid_"+c)}c=wundermap.map.getMapTypeId();if(c){f.addClass("maptypeid_"+c)}};d();google.maps.event.addListener(wundermap.map,"maptypeid_changed",d)};wundermap.addLogoControl=function(c){var c=a.extend(true,{},{image:wundermap.options.iconsdomain+"/i/wu_small.gif",position:google.maps.ControlPosition.RIGHT_BOTTOM,styles:{margin:"0 4px -2px 0"},title:"Weather layers powered by Weather Underground, Inc.",eventType:"dblclick",eventFunction:function(d){window.location="http://www.wunderground.com/cgi-bin/findweather/hdfForecast?query="+wundermap.map.getCenter().toUrlValue()}},c);this.addHTMLControl(c)};wundermap.RadSatSync={};wundermap.RadSatSync.initialize=function(){var c=wundermap.layers.Radar;var e=wundermap.layers.Satellite;var d=c.className;var f=e.className;google.maps.event.addListener(wundermap,"layertoggled",function(h,g){if(h!=d&&h!=f){return}if(h==d&&e.active_){e.refresh()}else{if(h==f&&c.active_){c.refresh()}}wundermap.RadSatSync.checkSyncedSidebarContent()});google.maps.event.addListener(wundermap,"datepicker_changed",function(g,h){wundermap.RadSatSync.checkSyncedSidebarContent()});google.maps.event.addListener(e,"settings_changed",function(){if(wundermap.RadSatSync.isSynced()){c.refresh()}});wundermap.RadSatSync.checkSyncedSidebarContent()};wundermap.RadSatSync.isSynced=function(){var c=wundermap.layers.Radar;var d=wundermap.layers.Satellite;var h=false;var e=new Date();var g=new Date(e.getTime()-1800*1000);var f=new Date(e.getTime()+3600*1000);if((wundermap.options.RadSatSync===true)&&(!wundermap.date||(wundermap.date>g&&wundermap.date<f))&&(d&&d.active_&&!d.disabled_&&!d.disabled_by_timelord_)&&(c&&c.active_&&!c.disabled_&&!c.disabled_by_timelord_)){h=true}return h};wundermap.RadSatSync.checkSyncedSidebarContent=function(){var f=wundermap.RadSatSync.isSynced();var e=[wundermap.layers.Radar,wundermap.layers.Satellite];for(var d=0;d<e.length;d++){var c=e[d];if(f){c.findId("hideWhenSynced").addClass("none");c.findId("showWhenSynced").removeClass("none")}else{c.findId("hideWhenSynced").removeClass("none");c.findId("showWhenSynced").addClass("none")}}};wundermap.utils.deg2rad=function(c){return c*(Math.PI/180)};wundermap.utils.rad2deg=function(c){return c*(180/Math.PI)};wundermap.utils.limit=function(e,d,c){return Math.min(c,Math.max(d,e))};wundermap.utils.atoi=function(c){return parseInt(c,10)};var b=wundermap.utils.atoi;wundermap.utils.cleanDate=function(c){if(c.match(/\./)){return c.replace(/\./g,"-")}else{if(c.match(/\//g)){return c.replace(/\//g,"-")}}return c};wundermap.utils.splitDate=function(e,c){if(!c){c="-"}var f=e.split(c);f[0]=parseInt(f[0],10);f[1]=parseInt(f[1],10);if(f[2]){parseInt(f[2],10)}return f};wundermap.utils.isValidDate=function(c){return !isNaN(c.getTime())};wundermap.utils.createDate=function(d,c){return wui.date.increment(null,d,c)};wundermap.utils.createDateFunction=function(d,c){return function(){return wui.date.increment(null,d,c)}};wundermap.utils.getBrowserTimezone=function(){var c=new Date();var d={"short":wui.date.strftime("%Z",c,false),"long":"GMT"+wui.date.strftime("%z",c,false),offset:{text:wui.date.strftime("%z",c,false),hours:-c.getTimezoneOffset()/60}};if(d["short"]=="UTC"&&d.offset.hours!==0){if(wundermap.debug==1){console.log("impossible UTC offset hours: "+d.offset.hours+", should be 0")}return null}else{return d}};wundermap.utils.overlayMapTypes={max:100,add:function(d){var f=d.get("zIndex");var c=!!(f||f===0);var n=wundermap.map.overlayMapTypes;var h=0;for(var e=n.getLength();h<e;h++){var g=n.getAt(h);var k=g.get("zIndex");var m=!!(k||k===0);if(f===0){h=0;break}else{if(!c){if(m&&k>=this.max){break}else{continue}}else{if(m&&k>=this.max&&f<this.max){break}else{if(m&&k>f){break}}}}}n.insertAt(h,d)},removeByName:function(e){var h=[];var g=wundermap.map.overlayMapTypes;var d=g.getLength();for(var f=d-1;f>=0;f--){var c=g.getAt(f);if(c.name==e){h.push(g.removeAt(f))}}return h},getZIndices:function(){var f=[];var g=wundermap.map.overlayMapTypes;for(var e=0,d=g.getLength();e<d;e++){var c=g.getAt(e);var h=c.get("zIndex");f.push(h)}return f}};wundermap.utils.removeOverlayMapTypeByName=wundermap.utils.overlayMapTypes.removeByName;wundermap.utils.getNormalizedCoord=function(g,d){var f=g.y;var c=g.x;var e=1<<d;if(f<0||f>=e){return null}if(c<0||c>=e){c=(c%e+e)%e}return{x:c,y:f}};wundermap.utils.indexOfClosest=function(d,k){var c=d.length;if(c==0){return -1}if(c==1){return 0}var e=0;var g=Math.abs(d[0]-k);for(var f=1;f<c;f++){var h=Math.abs(d[f]-k);if(h<g){e=f;g=h}}return e};wundermap.utils.hasTimelordWarning=function(c){var d=!!(c.parents("."+wundermap.classNames.timelordWarning).length>0);return d};wundermap.utils.latLonDistKM=function(m,k){if(!m||!k){return 0}var h=6371;var f=(k.lat()-m.lat())*Math.PI/180;var g=(k.lng()-m.lng())*Math.PI/180;var e=Math.sin(f/2)*Math.sin(f/2)+Math.cos(m.lat()*Math.PI/180)*Math.cos(k.lat()*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2);var n=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));var l=h*n;return l};wundermap.utils.random=function(d,c){return Math.floor((Math.random()*c)+d)};wundermap.utils.isCheckedValue=function(c){return(c===true||c=="on"||c=="1"||c===1)};wundermap.utils.isValidMeasurement=function(c){if(c===null){return false}else{if(typeof(c)=="undefined"){return false}else{if(c==""){return false}else{if(c=="-999"){return false}else{if(c=="-9999"){return false}else{if(parseFloat(c)<=-999){return false}else{return true}}}}}}};wundermap.utils.lookupWindString=function(c){if(c>360){c=c%360}if(c>=0&&c<11.25){return"N"}if(c>=11.25&&c<33.75){return"NNE"}if(c>=33.75&&c<67.5){return"NE"}if(c>=67.5&&c<78.75){return"ENE"}if(c>=78.75&&c<101.25){return"E"}if(c>=101.25&&c<123.75){return"ESE"}if(c>=123.75&&c<146.25){return"SE"}if(c>=146.25&&c<168.75){return"SSE"}if(c>=168.75&&c<191.25){return"S"}if(c>=191.25&&c<213.75){return"SSW"}if(c>=213.75&&c<236.25){return"SW"}if(c>=236.25&&c<258.75){return"WSW"}if(c>=258.75&&c<281.25){return"W"}if(c>=281.25&&c<303.75){return"WNW"}if(c>=303.75&&c<326.25){return"NW"}if(c>=326.25&&c<348.75){return"NNW"}if(c>=348.75){return"N"}return"-"};wundermap.utils.convertMonthStringToInt=function(c){if(c=="Jan"){return 1}if(c=="Feb"){return 2}if(c=="Mar"){return 3}if(c=="Apr"){return 4}if(c=="May"){return 5}if(c=="Jun"){return 6}if(c=="Jul"){return 7}if(c=="Aug"){return 8}if(c=="Sep"){return 9}if(c=="Oct"){return 10}if(c=="Nov"){return 11}if(c=="Dec"){return 12}return 0};wundermap.utils.convertTempIntoUnits=function(e,d,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(d)){return"-"}if(e=="metric"){return((d-32)/1.8).toFixed(c)}else{return(d-0).toFixed(c)}};wundermap.utils.getTempUnits=function(c){if(c=="metric"){return"C"}else{return"F"}};wundermap.utils.convertHeightIntoUnits=function(e,c,d){if(!d){d=0}if(!wundermap.utils.isValidMeasurement(c)){return"-"}if(e=="metric"){return((c*12*2.54/100)).toFixed(d)}else{return parseFloat(c).toFixed(d)}};wundermap.utils.getHeightUnits=function(c){if(c=="metric"){return"m"}else{return"ft"}};wundermap.utils.convertWindIntoUnits=function(e,g,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(g)){return"-"}var d=g/2.237;var f=d*3.6;if(e=="metric"){return(f).toFixed(c)}else{return parseFloat(g).toFixed(c)}};wundermap.utils.getWindUnits=function(c){if(c=="metric"){return"km/h"}else{return"mph"}};wundermap.utils.knotsToMph=function(e,f,c){if(!c){c=0}var d=f*1.15078;return d.toFixed(c)};wundermap.utils.convertKnotsIntoWindString=function(e,g,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(g)){return"-"}if(e=="metric"){var f=g*1.852;return f.toFixed(c)+" km/h"}else{var d=g*1.15078;return d.toFixed(c)+" mph"}};wundermap.utils.convertPressureIntoUnits=function(e,c,d){if(!d){d=0}if(!wundermap.utils.isValidMeasurement(c)){return"-"}if(e=="metric"){return(c*33.86).toFixed(d)}else{return c}};wundermap.utils.getPressureUnits=function(c){if(c=="metric"){return"hPa"}else{return"in"}};wundermap.utils.convertVisibilityIntoUnits=function(d,e,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(e)){return"-"}if(d=="metric"){return(e*1.60934).toFixed(c)}else{return parseFloat(e).toFixed(c)}};wundermap.utils.getVisibilityUnits=function(c){if(c=="metric"){return"km"}else{return"mi"}};wundermap.utils.convertFlowRateIntoUnits=function(d,e,c){if(!c){c=0}if(d=="metric"){return(e*0.028316847).toFixed(c)}else{return e}};wundermap.utils.getFlowRateUnits=function(c){if(c=="metric"){return"m&sup3;/s"}else{return"cfs"}};wundermap.utils.convertRainIntoUnits=function(e,d,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(d)){return"-"}if(e=="metric"){return(d*2.54*10).toFixed(c)/10}else{return d}};wundermap.utils.getRainUnits=function(c){if(c=="metric"){return"cm"}else{return"in"}};wundermap.utils.convertRainIntoUnitsMM=function(e,d,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(d)){return"-"}if(e=="metric"){return(d*2.54*10).toFixed(c)}else{return d}};wundermap.utils.getRainUnitsMM=function(c){if(c=="metric"){return"mm"}else{return"in"}};wundermap.utils.convertWaveperiodIntoUnits=function(d,e,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(e)){return"-"}return parseFloat(e).toFixed(c)};wundermap.utils.convertWavedirIntoUnits=function(d,e,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(e)){return"-"}return parseFloat(e).toFixed(c)};wundermap.utils.fixHour=function(e){var c=parseInt(e,10);if(c<=24){return e}else{var d=e.indexOf("00");if(d>-1&&d==e.length-2){return e.substring(0,d)}return e}};wundermap.utils.getConvexHull=function(l,d,c){var g=0;var f=0;var e=0;var h=l.length;if(h<=1){return l}if(!d){d=function(n,k){return k-n}}if(!c){cross=function(o,n,k){return(n.x-o.x)*(k.y-o.y)-(n.y-o.y)*(k.x-o.x)}}else{cross=c}l.sort(d);var m=[];for(g=0;g<h;g++){while(e>=2&&cross(m[e-2],m[e-1],l[g])<=0){e--}m[e++]=l[g]}for(g=h-2,f=e+1;g>=0;g--){while(e>=f&&cross(m[e-2],m[e-1],l[g])<=0){e--}m[e++]=l[g]}m.pop();return m};wundermap.utils.drawCircleWedge=function(u,t,c,v,x,h,n,s,e,g,p,m){var q=[];var l=6;for(var r=x;r<=h;r+=l){var k=wundermap.utils.deg2rad(r);var d=c*Math.sin(k);var w=v*Math.cos(k);var o=new google.maps.LatLng(t.lat()+d,t.lng()+w,false);q.push(o)}if(x>0||h<360){q.push(t);q.push(q[0])}var f=new google.maps.Polygon({clickable:false,fillColor:g,fillOpacity:p,map:u,paths:q,strokeColor:n,strokeOpacity:e,strokeWeight:s,zIndex:m});return f};wundermap.utils.drawCircleWedgeMiles=function(d,c,l,g,h,t,k,n,e,q,p){var o=3963.19;var m=180/(o*Math.PI);var s=m/Math.cos(wundermap.utils.deg2rad(c.lat()));var r=l*m;var f=l*s;return wundermap.utils.drawCircleWedge(d,c,r,f,g,h,t,k,n,e,q,p)};wundermap.utils.drawCircleWedgeKM=function(d,c,l,g,h,t,k,n,e,q,p){var o=6378.137;var m=180/(o*Math.PI);var s=m/Math.cos(wundermap.utils.deg2rad(c.lat()));var r=l*m;var f=l*s;return wundermap.utils.drawCircleWedge(d,c,r,f,g,h,t,k,n,e,q,p)};wundermap.utils.strcasecmp=function(e,d){var c=(e+"").toLowerCase();var f=(d+"").toLowerCase();if(c>f){return 1}else{if(c==f){return 0}}return -1};wundermap.utils.strstr=function(d,e,c){var f=0;d+="";f=d.indexOf(e);if(f==-1){return false}else{if(c){return d.substr(0,f)}else{return d.slice(f)}}};wundermap.search={title:"",marker:null};wundermap.search.initialize=function(g,h,f){var k=new google.maps.Geocoder();var d=this.elt_searchForm=a(g);var c=this.elt_searchBox=a(h);var e=this.elt_favorites=a(f);d.bind("submit",function(l){k.geocode({address:c.val(),bounds:wundermap.map.getBounds()},wundermap.search.callback)});e.bind("change",function(o){var m=this.selectedIndex;if(m>0){var q=this.options[m].text;var s=this.options[m].value;var r=s.indexOf(",");var n=parseFloat(s.substring(0,r));var p=parseFloat(s.substring(r+1));var l=new google.maps.LatLng(n,p);wundermap.search.gotoLocation(l,q,10,null)}})};wundermap.search.callback=function(e,d){if(d!=google.maps.GeocoderStatus.OK){alert("Location not found. (error: "+d+")");return}var c=e[0].geometry.location;var g=e[0].formatted_address;var f=e[0].geometry.viewport;wundermap.search.gotoLocation(c,g,null,f)};wundermap.search.gotoLocation=function(c,f,e,d){this.title=f;if(!this.marker){this.marker=new google.maps.Marker({clickable:true,map:wundermap.map,position:c,title:f});google.maps.event.addListener(this.marker,"click",function(k){var m=this.getTitle();var h=this.getPosition().lat().toFixed(4);var l=this.getPosition().lng().toFixed(4);var g='<div class="p10">This is your search result. <a href="/cgi-bin/findweather/hdfForecast?query='+h+","+l+'">View Conditions</a></div>';wundermap.openInfoBox({title:m,content:g,marker:this})})}else{this.marker.setPosition(c);this.marker.setTitle(f)}if(d){wundermap.map.fitBounds(d)}else{wundermap.map.setCenter(c);if(e){wundermap.map.setZoom(e)}}google.maps.event.trigger(wundermap.search,"viewchange")};wundermap.search.useAutocomplete=function(f,r){if(r.type=="hurricanes"){var o=null;if(r.date){o=new Date(r.date)}if(r.start_epoch&&wundermap.timeline_master){var k=r.start_epoch*1000-3600*1000;var l=r.end_epoch*1000+3600*1000;var e=new Date(k);var n=new Date(l);var g=new Date(r.start_epoch*1000);if(wundermap.timeline_range){wundermap.timeline_master.setViewportNew(e,n,null);wundermap.timeline_range.setDate(g)}else{wundermap.timeline_master.setViewportNew(e,n,g)}}else{if(o&&wundermap.utils.isValidDate(o)){wundermap.timelord.set(o)}else{if(wundermap.debug>0){wui.log("Error: cannot set invalid date: "+r.date)}}}var c=null;if(r.ne_lat){var h=new google.maps.LatLng(r.ne_lat,r.ne_lon);var q=new google.maps.LatLng(r.sw_lat,r.sw_lon);c=new google.maps.LatLngBounds(q,h)}else{c=this.basinToBounds(r.basin)}if(c){wundermap.map.fitBounds(c)}var m=wundermap.layers.Hurricane;if(m&&!m.active_){m.toggle(true)}}else{if(r.type=="favorites"){var p=new google.maps.LatLng(r.lat,r.lon);this.gotoLocation(p,r.name,10,null)}else{this.elt_searchForm.submit()}}};wundermap.search.basinToBounds=function(e){var h={at:[67,-7,15,-100],ep:[45,0,-83,-145],wp:[55,0,180,90],ni:[35,3,100,50],si:[15,-40,135,30],na:[37,5,87,45],cp:[45,0,-130,170],sp:[0,-45,220,145]};if(e in h){var d=h[e];var c=new google.maps.LatLng(d[1],d[3],true);var g=new google.maps.LatLng(d[0],d[2],true);var f=new google.maps.LatLngBounds(c,g);return f}else{return null}};wundermap.closeInfoBox=function(){if(wundermap.infobox){if(wundermap.infobox.hide){wundermap.infobox.hide()}else{wundermap.infobox.close()}}google.maps.event.trigger(wundermap,"infowindowclose")};wundermap.openInfoBox=function(c){var q=c.useInfoBox||true;if(!wui.defined(window.InfoBox)){q=false}if(wundermap.infobox_container){wundermap.infobox_container.remove()}if(wundermap.infobox){wundermap.infobox.close()}var e=a("<div></div>");e.append('<div class="infobox-pointer"></div>');if(c.title){e.append('<div class="infobox-title">'+c.title+"</div>")}if(c.content){e.append(c.content)}if(c.tabs){var f="infobox-tabs";var d=a("<div></div>").attr("id",f);var n=a("<ul></ul>").appendTo(d);for(var k=0;k<c.tabs.length;k++){var h=f+"-"+k;n.append('<li><a href="#'+h+'">'+c.tabs[k].title+"</a></li>");d.append('<div id="'+h+'">'+c.tabs[k].content+"</div>")}var r=a.extend(true,{},c.tabsOptions);d.tabs(r);d.appendTo(e)}if(c.footer){e.append(c.footer)}var g=e.find("#infobox-tabs");if(g[0]){g.tabs()}var l=null;if(wundermap.options.infobox.position!==null){var m=wundermap.imagemap_container.getProjection();if(a.isArray(wundermap.options.infobox.position)){var p=wundermap.options.infobox.position[0];var o=wundermap.options.infobox.position[1];l=m.fromContainerPixelToLatLng(new google.maps.Point(p,o))}}else{if(c.position){l=c.position}}if(!wundermap.infobox){if(q){wundermap.infobox=new InfoBox({pixelOffset:new google.maps.Size(9,-29),closeBoxMargin:"0px 0px 0px 0px",closeBoxURL:wundermap.options.iconsdomain+"/i/wu/wmTitleClose.png",position:l,disableAutoPan:wundermap.options.infobox.disableAutoPan});google.maps.event.addListener(wundermap.infobox,"closeclick",function(){google.maps.event.trigger(wundermap,"infowindowclose")})}else{wundermap.infobox=new google.maps.InfoWindow({position:l,disableAutoPan:wundermap.options.infobox.disableAutoPan})}}if(l){wundermap.infobox.setPosition(l)}if(c.styles){wundermap.infobox.setOptions({boxStyle:c.styles})}wundermap.infobox_container=e;wundermap.infobox.setContent(e[0]);if(wundermap.infobox.show){wundermap.infobox.show()}if(wundermap.options.infobox.position!==null){wundermap.infobox.open(wundermap.map)}else{wundermap.infobox.open(wundermap.map,c.marker)}if(q){google.maps.event.trigger(wundermap,"infowindowopen")}return wundermap.infobox};wundermap.Layer=function(){this.initialized_=false};wundermap.Layer.prototype.constructor=wundermap.Layer;wundermap.Layer.prototype.initialize=function(c,r){this.initialized_=true;this.map_=c;this.options_=a.extend(true,{},{refreshTimeout:900,timelord:{showTooltip:false,text:"",triggerRefresh:true,min:wundermap.utils.createDateFunction(-5,"minute"),max:wundermap.utils.createDateFunction(1,"hour")}},r);this.name_=this.options_.name;this.sidebarPrefix_=this.options_.sidebarPrefix;this.debug_=wundermap.options.debug||0;this.streets_=this.options_.streets||null;this.imagelayers_=[];this.markerlayers_=[];this.tilelayers_=[];this.tilelayerpools_=[];this.listeners_=[];this.listenersSetupParams_=[];this.clusters_={};this.unclustered_={};this.key_="";this.sliders_={};this.slidersSetupParams_=[];this.active_=false;this.disabled_=false;this.disabled_by_timelord_=false;this.queryString="";this.dataTables_=[];this.shapes_=[];this.elt_options=this.findId("options");this.elt_legend=this.findId("legend");this.elt_displayAreaTab=this.findId("displayArea");this.elt_displayAreaTab2=this.findId("displayArea2");this.elt_displayAreaNoData=this.elt_displayAreaTab.find(".nodata");this.elt_printArea=this.findId("printArea");this.elt_moveToTop=null;this.elt_trayIcon=a(null);this.elt_accordionHeader=this.options_.accordionHeader;this.elt_accordionContent=this.options_.accordionContent;var e=this.elt_accordionContent||a("#accordion");if(this.options_.defaultUI==1){var q={};if(this.elt_options[0]&&!!this.options_.cogIcon){q.cog=true}if(!!wundermap.options.wuForm){q.wuForm=true;q.tagName="label"}var g=this.createDefaultUI(q);if(this.options_.optionsInfobox){g.appendTo(e);this.elt_options.insertAfter(g)}else{var d=this.elt_options.parent();if(d[0]){g.insertBefore(d)}else{g.appendTo(e)}}}var o=this;this.elt_titleBar=this.findId();this.elt_checkbox=this.findId("checkbox");var l=this.elt_titleBar.is("label");if(this.options_.optionsInfobox){this.elt_options.addClass(wundermap.classNames.optionsInfobox)}if(!(l&&this.elt_checkbox[0])){this.elt_titleBar.click(function(t){var s=a(t.target).is("input[type=checkbox]");if(!o.active_&&!s&&!l){o.toggle(true)}})}this.elt_checkbox.click(function(s){o.toggle(this.checked)});this.elt_radio=this.findId("radio");this.elt_radioParent=this.findId("parent");this.elt_radio.click(function(s){o.radioButtonClick()});this.elt_titleBar.mouseenter(function(s){a(this).addClass(wundermap.classNames.layerTitleHover)}).mouseleave(function(s){a(this).removeClass(wundermap.classNames.layerTitleHover)});this.elt_cog=this.findId("cog");this.elt_cog.bind("click",function(t){o.elt_options.toggleClass("none");var s=o.elt_options.is(":visible");a(this).toggleClass(wundermap.classNames.selected,s);if(o.options_.optionsInfobox&&s){o.repositionOptionsInfobox(o.options_.optionsInfobox)}t.preventDefault()});if(wundermap.options.tray&&this.elt_displayAreaTab[0]&&this.options_.trayIcon!==false){this.setupTray(wundermap.options.tray)}this.setupTabs();if(wundermap.options.datepicker){var n=(this.options_.timelord&&this.options_.timelord.triggerRefresh);var f=google.maps.event.addListener(wundermap,"datepicker_changed",function(u,w){var t=o.disabled_;o.timelord_check_dates(u);var v=o.disabled_by_timelord_;if(!t){o.setDisabledByTimelord(v)}if(o.custom_check_dates&&!v){var s=o.custom_check_dates(u)}if(o.active_&&(n||t||v)&&(s!==false)){o.refresh()}});f=google.maps.event.addListener(wundermap,"datepicker_step",function(s){})}if(o.custom_check_dates){f=google.maps.event.addListener(this,"layertoggled",function(s){if(s&&!o.disabled_by_timelord_){o.custom_check_dates(wundermap.date)}})}if(wundermap.options.datepicker){this.timelord_check_dates(wundermap.date);if(!this.disabled){this.setDisabledByTimelord(this.disabled_by_timelord_)}if(wui.tooltip&&this.options_.timelord&&this.options_.timelord.showTooltip!==false){var h=this.elt_titleBar.find(".hasTimelord");if(!h[0]){h=wundermap.timelord.getTooltipButton(this.className);h.appendTo(this.elt_titleBar)}var m="";var k=this.elt_titleBar.find(".hasTimelordTooltip");if(k[0]){m=k.html()}if(!m){m=wundermap.timelord.getTooltipContent(this.options_.timelord,this.className)}var p=new wui.tooltip({button:h,content:m,position:{collision:"fit none"}})}}};wundermap.Layer.prototype.clearRefreshTimer=function(){if(this.refreshTimer_){window.clearTimeout(this.refreshTimer_);this.refreshTimer_=null}};wundermap.Layer.prototype.setRefreshTimer=function(){this.clearRefreshTimer();if(!this.options_.refreshTimeout){return}if(this.loading_||this.disabled_||this.disabled_by_timelord_||!this.active_){return}var d=this.options_.refreshTimeout*1000;var c=this;this.refreshTimer_=window.setTimeout(function(){if(c.loading_||c.disabled_||c.disabled_by_timelord_||!c.active_){c.clearRefreshTimer();return}if(wundermap.debug==1){wui.log("setRefreshTimer (autoRefresh) for layer: "+c.className)}var e={tilelayers:true};c.refresh(e)},d)};wundermap.Layer.prototype.findId=function(d){var c="#"+this.sidebarPrefix_;if(d){c+="_"+d}return a(c)};wundermap.Layer.prototype.setCheckbox=function(c){this.elt_checkbox.filter("input[type=checkbox]").attr("checked",c);this.elt_titleBar.toggleClass(wundermap.classNames.layerTitleSelected,c)};wundermap.Layer.prototype.setRadioButton=function(c){this.elt_radio.filter("input[type=radio]").attr("checked",c);if(c){this.elt_radioParent.addClass("active").removeClass("inactive")}else{this.elt_radioParent.addClass("inactive").removeClass("active")}};wundermap.Layer.prototype.radioButtonClick=function(){for(var c in wundermap.layers){var d=wundermap.layers[c];if(d.initialized_===true){if(this.className==c){d.setRadioButton(true);d.toggle(true)}else{if(d.elt_radio[0]){d.setRadioButton(false);d.toggle(false)}}}}};wundermap.Layer.prototype.setLayerTimeout=function(){};wundermap.Layer.prototype.clearLayerTimeout=function(){};wundermap.Layer.prototype.toggle=function(c){this.setCheckbox(c);this.setRadioButton(c);if(c){this.active_=true;this.addComponents();if(this.streets_){this.streets_.attachTo(this.className)}if(!this.elt_cog[0]){this.elt_options.removeClass("none")}this.elt_legend.removeClass("none");this.elt_trayIcon.show();this.toggleTray(false);this.toggleMoveToTop(true);google.maps.event.trigger(this,"layertoggled",c)}else{this.active_=false;if(this.streets_){this.streets_.detachFrom(this.className)}google.maps.event.trigger(this,"loadend");this.removeComponents();this.elt_options.addClass("none");this.elt_legend.addClass("none");this.elt_trayIcon.hide();this.toggleTray(false);this.toggleMoveToTop(false);google.maps.event.trigger(this,"layertoggled",c);this.elt_printArea.empty();this.removeDataTables();wundermap.setHighlight(null);this.clearRefreshTimer();this.elt_cog.removeClass(wundermap.classNames.selected)}this.updateQueryString();google.maps.event.trigger(wundermap,"layertoggled",this.className,c)};wundermap.Layer.prototype.createDefaultUI=function(f){var f=a.extend({cog:false,prefix:this.sidebarPrefix_,tagName:"div",title:(this.options_)?(this.options_.title||this.className||this.options_.layer):"",wuForm:false},f);var c=(f.wuForm)?"layerTitle":"nobr accordion-header";var e="<"+f.tagName+' id="'+f.prefix+'" class="'+c+'">';e+='<input type="checkbox" id="'+f.prefix+'_checkbox" value="" /> ';if(f.wuForm){e+='<span class="wuCheckbox" id="'+f.prefix+'_wuCheckbox"></span>';e+='<span class="layerName">'+f.title+"</span>"}else{e+="<span>"+f.title+"</span>"}if(f.cog){e+='<a href="javascript:void(0);" id="'+f.prefix+'_cog" class="optionCog"></a>'}e+="</"+f.tagName+">";var d=a(e);return d};wundermap.Layer.prototype.setupTabs=function(){var f=this.elt_titleBar.next(".accordion-content");var e=f.find("ul.wundermapTabs");if(e[0]){var d=this;var c=false;e.show();f.tabs({show:function(h,g){if(c){f.slideDown("slow")}c=true;google.maps.event.trigger(d,"tabsshow",g);google.maps.event.trigger(wundermap,"tabsshow",d.name_,g)}})}};wundermap.Layer.prototype.setupTray=function(h){var h=a.extend(true,{selector:"#icon_tray",container:null,iconClass:"",trayClass:""},h);var e=a(h.selector);if(!e[0]){var k="missing tray container for icon";google.maps.event.trigger(this,"loaderror",k);return}var g=this.elt_displayAreaTab;var f=a('<a href="javascript:void(0);"></a>');if(h.iconClass){f.addClass(h.iconClass);f.addClass(this.sidebarPrefix_+"_"+h.iconClass)}f.attr("title",this.className).hide();f.appendTo(e);var d=this;f.bind("click",function(n){var l=g.is(":visible");var o=wundermap.getActiveLayers();for(var m=0;m<o.length;m++){o[m].toggleTray(false)}d.toggleTray(!l)});var c=a(h.container);if(c[0]){g.appendTo(c)}if(h.trayClass){g.addClass(h.trayClass)}if(h.pointerClass){g.prepend('<div class="'+h.pointerClass+'"></div>')}this.elt_trayIcon=f;this.toggleTray(false)};wundermap.Layer.prototype.toggleTray=function(e){var d=this.elt_displayAreaTab;var c=this.elt_trayIcon;if(!c[0]){return}if(e){c.addClass(wundermap.classNames.selected);d.show()}else{c.removeClass(wundermap.classNames.selected);d.hide()}};wundermap.Layer.prototype.repositionOptionsInfobox=function(d){var c=this;var e=this.elt_options.children("."+wundermap.classNames.infoboxPointerTop+", ."+wundermap.classNames.infoboxPointerBot).eq(0);if(!e[0]){e=a("<div></div>").prependTo(this.elt_options)}this.elt_options.appendTo(this.elt_options.parent());this.elt_options.position({my:"left top",at:"left bottom",of:this.elt_titleBar,offset:this.elt_options.css("margin-left")+" "+this.elt_options.css("margin-top"),collision:"none none",using:function(n){var f=c.elt_options.outerHeight(true);var k=c.elt_titleBar.offset().top;var h=k+c.elt_titleBar.height()+f;var g=(d.container)?a(d.container):a("#map_panel_content");var m=g.offset().top;var l=m+g.height();if(h>l&&k-f>m){n.top-=(h-k)+b(c.elt_options.css("margin-top"));a(this).css(n);e.removeClass(wundermap.classNames.infoboxPointerTop).addClass(wundermap.classNames.infoboxPointerBot)}else{a(this).css(n);e.removeClass(wundermap.classNames.infoboxPointerBot).addClass(wundermap.classNames.infoboxPointerTop)}}})};wundermap.Layer.prototype.addImageLayer=function(e){var c=this.imagelayers_.length;var d=new wundermap.ImageLayer(this.map_,this.options_,e,c);this.imagelayers_.push(d);if(this.disabled_){d.setDisabled(true)}if(this.disabled_by_timelord_){d.setDisabled(true)}return d};wundermap.Layer.prototype.addMarkerLayer=function(d){var c=this.markerlayers_.length;var e=new wundermap.MarkerLayer(this.map_,this.options_,d,c);this.markerlayers_.push(e);if(this.disabled_){e.setDisabled(true)}if(this.disabled_by_timelord_){e.setDisabled(true)}return e};wundermap.Layer.prototype.addTileLayer=function(e,g){var d=this.tilelayers_.length;var f=a.extend(true,{},g,this.options_);var c=new wundermap.TileLayer(this.map_,f,e,d);this.tilelayers_.push(c);if(this.disabled_){c.setDisabled(true)}if(this.disabled_by_timelord_){c.setDisabled(true)}return c};wundermap.Layer.prototype.addTileLayerPool=function(f){var d=this.tilelayerpools_.length;var e=a.extend({map:this.map_},f);if(this.disabled_){e.disabled=true}if(this.disabled_by_timelord_){e.disabled=true}var c=new wundermap.TileLayerPool(e);this.tilelayerpools_.push(c);return c};wundermap.Layer.prototype.refresh=function(g){var g=g||{};if(!wundermap.firstIdle){return}this.setRefreshTimer();for(var e=0;e<this.imagelayers_.length;e++){var f=this.imagelayers_[e];f.refresh(g)}for(var e=0;e<this.markerlayers_.length;e++){var h=this.markerlayers_[e];h.refresh(g)}if(g.tilelayers){for(var e=0;e<this.tilelayers_.length;e++){var d=this.tilelayers_[e];d.refresh(g)}for(var e=0;e<this.tilelayerpools_.length;e++){var c=this.tilelayerpools_[e];c.refresh(g)}}};wundermap.Layer.prototype.setDisabled=function(c){this.disabled_=(c)?true:false;this.setDisabledComponents(c)};wundermap.Layer.prototype.setDisabledByTimelord=function(c){this.disabled_by_timelord_=(c)?true:false;this.setDisabledComponents(c)};wundermap.Layer.prototype.setDisabledComponents=function(f){for(var e=0;e<this.imagelayers_.length;e++){var g=this.imagelayers_[e];g.setDisabled(f)}for(var e=0;e<this.markerlayers_.length;e++){var h=this.markerlayers_[e];h.setDisabled(f)}for(var e=0;e<this.tilelayers_.length;e++){var d=this.tilelayers_[e];d.setDisabled(f)}for(var e=0;e<this.tilelayerpools_.length;e++){var c=this.tilelayerpools_[e];c.setDisabled(f)}};wundermap.Layer.prototype.addComponents=function(){var s=this;for(var p=0;p<this.imagelayers_.length;p++){var k=this.imagelayers_[p];k.setMap(this.map_);var g=google.maps.event.addListener(k,"imageload",function(t,u){if(t=="loadstart"){google.maps.event.trigger(s,"loadstart")}else{if(t=="load"){google.maps.event.trigger(s,"loadend")}else{google.maps.event.trigger(s,"loaderror",u)}}});this.listeners_.push(g);var g=google.maps.event.addListener(k,"settings_changed",function(){google.maps.event.trigger(s,"settings_changed")});this.listeners_.push(g)}for(var p=0;p<this.markerlayers_.length;p++){var r=this.markerlayers_[p];if(this.map_.getBounds()){r.refresh()}var g=google.maps.event.addListener(r,"layerload",function(t,u){if(t=="loadstart"){google.maps.event.trigger(s,"loadstart")}else{if(t=="load"){google.maps.event.trigger(s,"loadend")}else{google.maps.event.trigger(s,"loaderror",u)}}});this.listeners_.push(g)}for(var p=0;p<this.tilelayers_.length;p++){var o=this.tilelayers_[p];var g=google.maps.event.addListener(o,"imageload",function(t,u){if(t=="loadstart"){google.maps.event.trigger(s,"loadstart")}else{if(t=="load"){google.maps.event.trigger(s,"loadend")}else{google.maps.event.trigger(s,"loaderror",u)}}});this.listeners_.push(g);if(o.options_.autoEnable){o.addTiles()}}for(var p=0;p<this.tilelayerpools_.length;p++){var h=this.tilelayerpools_[p];var g=google.maps.event.addListener(h,"imageload",function(t,u){if(t=="loadstart"){google.maps.event.trigger(s,"loadstart")}else{if(t=="load"){google.maps.event.trigger(s,"loadend")}else{google.maps.event.trigger(s,"loaderror",u)}}});this.listeners_.push(g);google.maps.event.addListener(wundermap,"animating_changed",function(t){if(t){h.playByHand()}else{h.stop()}});h.setOptions({date:wundermap.date});h.initialize()}for(var p=0;p<this.listenersSetupParams_.length;p++){var m=this.listenersSetupParams_[p];var e=m.id;var c=m.name;var f=m.eventname;if(e){var l=document.getElementById(this.sidebarPrefix_+"_"+e);if(l){var g=google.maps.event.addDomListener(l,f,function(){google.maps.event.trigger(s,"settings_changed");s.refresh({eventname:"settings_changed"})});this.listeners_.push(g)}}else{if(c){var q=document.getElementsByName(this.sidebarPrefix_+"_"+c);for(var n=0;n<q.length;n++){var l=q[n];var g=google.maps.event.addDomListener(l,f,function(){google.maps.event.trigger(s,"settings_changed");s.refresh({eventname:"settings_changed"})});this.listeners_.push(g)}}}}a.each(this.slidersSetupParams_,function(u,x){var y=x.id;if(!s.sliders_[y]){var v=s.findId(y+"_slider");var w=s.findId(y+"_value");var t=a.extend(true,{disabled:false,max:100,min:0,step:1,value:0,slide:function(z,A){w.text(A.value)},change:function(z,A){s.refresh();google.maps.event.trigger(s,"settings_changed")}},x.slider_opts);s.sliders_[y]=v.slider(t);w.text(t.value)}});for(var e in this.sliders_){this.sliders_[e].slider("enable")}var g;g=google.maps.event.addListener(this,"settings_changed",function(){s.updateQueryString();google.maps.event.trigger(wundermap,"settings_changed",this.className)});this.listeners_.push(g);var d="ajax-loading";g=google.maps.event.addListener(this,"loadstart",function(){this.elt_titleBar.addClass(d);google.maps.event.trigger(wundermap,"layerload",this.className,"loadstart",null)});this.listeners_.push(g);g=google.maps.event.addListener(this,"loadend",function(){this.elt_titleBar.removeClass(d);google.maps.event.trigger(wundermap,"layerload",this.className,"loadend",null)});this.listeners_.push(g);g=google.maps.event.addListener(this,"loaderror",function(t){this.elt_titleBar.removeClass(d);if(wundermap.debug>0){wui.log('Error while loading the "'+this.className+'" layer: \n'+(t?t:"(no details)"))}google.maps.event.trigger(wundermap,"layerload",this.className,"loaderror",t)});this.listeners_.push(g)};wundermap.Layer.prototype.removeComponents=function(){while(this.listeners_.length>0){var k=this.listeners_.pop();google.maps.event.removeListener(k)}for(var f=0;f<this.imagelayers_.length;f++){var g=this.imagelayers_[f];g.setMap(null)}for(var f=0;f<this.markerlayers_.length;f++){var h=this.markerlayers_[f];h.removeOverlays()}for(var f=0;f<this.tilelayers_.length;f++){var e=this.tilelayers_[f];e.removeTiles()}for(var f=0;f<this.tilelayerpools_.length;f++){var c=this.tilelayerpools_[f];c.destroy()}for(var l in this.sliders_){this.sliders_[l].slider("disable")}while(this.shapes_.length>0){var d=this.shapes_.pop();if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null)}}};wundermap.Layer.prototype.timelord_check_dates=function(g){var e=this.options_.timelord;var f=a.isFunction(e.min)?e.min():e.min;var c=a.isFunction(e.max)?e.max():e.max;if(e&&((f&&g<f)||(c&&g>c))){this.elt_titleBar.addClass(wundermap.classNames.timelordWarning);this.disabled_by_timelord_=true;return false}else{this.disabled_by_timelord_=false;this.elt_titleBar.removeClass(wundermap.classNames.timelordWarning);return true}};wundermap.Layer.prototype.getAjaxOptions=function(){var c=this.imagelayers_[0];if(c&&!c.getDisabled()){return c.callbacks_.ajaxOptions||{}}else{return{}}};wundermap.Layer.prototype.getPrefs=function(c){return{}};wundermap.Layer.prototype.updateQueryString=function(){var f=this.name_;var g={};if(this.active_){g[f]="1";var d=this.getPrefs({type:"querystring"});if(d){var e=0;for(var c in d){var h=d[c];if(h===true){h="1"}if(h===false){h="0"}if(h!==null){g[f+"."+c]=h}if(e>50){break}e++}}}else{g[f]="0"}this.queryString=a.param(g)};wundermap.Layer.prototype.toQueryString=function(){if(!this.queryString){this.updateQueryString()}return this.queryString};wundermap.Layer.prototype.toPrefsObject=function(){var g=this.name_.toUpperCase();var h={};if(this.active_){h[g]="1";var d=this.getPrefs({type:"prefscookie"});if(d){var f=0;for(var c in d){var e=c.toUpperCase().replace(".","");var k=d[c];if(k!==null){h[g+e]=k}if(f>50){break}f++}}}else{h[g]="0"}return h};wundermap.Layer.prototype.getBalloonContent=function(g){if(a.isArray(g)){var c={};for(var f=0;f<g.length;f++){a.extend(c,g[f])}var g=c}var e='<div class="'+this.className+'Balloon">';e+='<div class="infobox-title">'+g.name+"</div>";e+='<div class="grt p10">';e+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';for(var d in g){if(a.inArray(d,["name","rect"])>-1){continue}e+='<tr><td class="nobr">'+d+':</td><td class="full">'+g[d]+"</td></tr>"}e+="</table>";e+="</div>";e+="</div>";return e};wundermap.Layer.prototype.getBalloonContentAds=function(e){var f=this.getBalloonContentAdsTitle(e);var d='<div class="'+this.className+'Balloon">';if(e.url_click){d+='<div class="infobox-title"><a target="new" href="'+e.url_click+'">'+f+"</a></div>"}else{d+='<div class="infobox-title">'+f+"</div>"}d+='<div class="p10">';d+=e.name+"<br/>";d+=e.address1+"<br/>";if(e.address2){d+=e.address2+"<br/>"}d+=e.city+", ";d+=e.state+" ";d+=e.postal_code+"<br/>";d+=e.phone+"<br/>";d+="</div>";if(this.as5000image_){d+='<div class="taC bm10">';if(e.url_click){d+='<a target="new" href="'+e.url_click+'">'}d+='<img src="'+this.as5000image_+'" alt="advertisement" />';if(e.url_click){d+="</a>"}d+="</div>"}if(this.as5000_){var c="http://www.wunderground.com/cgi-bin/tally?node="+this.as5000_+"."+wundermap.options.source+"&value="+e.id;d+='<div class="none"><img src="'+c+'" alt="" /></div>'}if(e.url_view){d+='<div class="none"><img src="'+e.url_view+'" alt="" /></div>'}d+="</div>";return d};wundermap.Layer.prototype.getBalloonContentAdsTitle=function(c){return c.name||c.id||this.className};wundermap.Layer.prototype.getBalloonContentCluster=function(m){var h='<div class="'+this.className+'Balloon">';h+='<div class="infobox-title">'+this.getClusterTitle(m)+"</div>";h+="<ul>";var d=m.clusternodes;var l=m.clusterindex;for(var g=0;g<d.length;g++){var f=d[g];if(m.cluster_hasDetailedResults){var e="javascript:wundermap.layers."+this.className+".getDetailsCached("+l+","+g+",13)"}else{var e=this.getImagemapAreasHref(f,g,false,15)}h+='<li><a href="'+e+'">'+f.name+"</a></li>"}var k=(m.clustercount-m.clustercount_limited);if(k>0){h+="<li>and "+k+" more&hellip;</li>"}h+="</ul>";var e="javascript:wundermap.zoomIn()";h+='<div class="p10"><a href="'+e+'">Zoom in for a closer look</a></div>';if(this.as5000_){var c="http://www.wunderground.com/cgi-bin/tally?node="+this.as5000_+"."+wundermap.options.source+"&value=cluster";h+='<div class="none"><img src="'+c+'" alt="" /></div>'}h+="</div>";return h};wundermap.Layer.prototype.getBalloonPicture=function(d,m,g,k){var c=m[g];var h=m.length;var l=this.sidebarPrefix_+"_"+d+"_prevPhoto";var e=this.sidebarPrefix_+"_"+d+"_nextPhoto";var f='<div id="'+k+'">';f+=this.getBalloonPictureContent(c,g,h,l,e);f+="</div>";return f};wundermap.Layer.prototype.changeBalloonPicture=function(e,n,h,l){var c=n[h];var k=n.length;var m=this.sidebarPrefix_+"_"+e+"_prevPhoto";var f=this.sidebarPrefix_+"_"+e+"_nextPhoto";var g=this.getBalloonPictureContent(c,h,k,m,f);var d=a(l);if(d){d.setHTML(g)}else{google.maps.event.trigger(this,"loaderror","Could not changeBalloonPicture into: "+l)}};wundermap.Layer.prototype.getBalloonPictureContent=function(e,c,k,d,l){var f='<div class="balloonInfo sm">';f+='<div class="b">'+e.title+"</div>";var g=e.handle.substr(0,1).toLowerCase();f+='<div class="subG">By <a href="http://www.wunderground.com/wximage/imagesearch.html?handle='+e.handle+'&handlebox=1&submit=go" class="nu">'+e.handle+"</a>";if(e.dateimage){f+=" on "+e.dateimage}f+="</div>";f+="<div>"+(c+1)+" of "+k+"</div>";f+='<table cellspacing="0" cellpadding="5" class="center"><tr class="vaM">';if(k>1){f+='<td><a href="#" id="'+d+'" class="picArrow" title="Previous Photo">&laquo;</a></td>'}f+='<td><a href="http://www.wunderground.com/wximage/'+e.handle+"/"+e.number+'" target="new"><img style="height: 100px; border: 1px solid #CCC; padding: 2px;" src="http://www.wunderground.com/data/wximagenew/'+g+"/"+e.handle+"/"+e.number+"."+e.imagetype+'" ></a></td>';if(k>1){f+='<td><a href="#" id="'+l+'" class="picArrow" title="Next Photo">&raquo;</a></td>'}f+="</tr></table>";if(e.caption){f+="<div>"+e.caption+"</div>"}f+="</div>";return f};wundermap.Layer.prototype.addPhotoListeners=function(c,n,h,k){if(!n){return}var l=this.sidebarPrefix_+"_"+c+"_prevPhoto";var d=this.sidebarPrefix_+"_"+c+"_nextPhoto";var f=a(l);var g=a(d);if(!f||!g){return}var m=this;var e=null;e=google.maps.event.addDomListener(f,"click",function(o){o=new Event(o).stop();h--;if(h<0){h=n.length-1}m.changeBalloonPicture(c,n,h,k);m.addPhotoListeners(c,n,h,k)});this.listeners_.push(e);e=google.maps.event.addDomListener(g,"click",function(o){o=new Event(o).stop();h++;if(h>=n.length){h=0}m.changeBalloonPicture(c,n,h,k);m.addPhotoListeners(c,n,h,k)});this.listeners_.push(e)};wundermap.Layer.prototype.getElementValue=function(f,d,e){var c=a("#"+this.sidebarPrefix_+"_"+f);if(!c[0]){if(d=="checkbox"){return wundermap.utils.isCheckedValue(e)}else{return e}}switch(d){case"animate":return c.hasClass("none");case"checkbox":return c[0].checked;case"select":return(c[0].length)?c[0].value:e;case"input":return c[0].value;case"slider":return(c.hasClass("ui-slider"))?c.slider("value"):null;default:return e}};wundermap.Layer.prototype.setElementsValue=function(e,f,g){var h=document.getElementsByName(this.sidebarPrefix_+"_"+e);for(var d=0;d<h.length;d++){var c=h[d];if(f=="checkbox"){c.checked=wundermap.utils.isCheckedValue(g)}else{if(c.value==g){c.checked="checked"}else{c.checked=false}}}};wundermap.Layer.prototype.setElementValue=function(f,d,e){var c=a("#"+this.sidebarPrefix_+"_"+f);if(!c[0]){return}switch(d){case"checkbox":c[0].checked=wundermap.utils.isCheckedValue(e);break;case"input":case"select":c[0].value=e;break;default:break}};wundermap.Layer.prototype.getElementsValue=function(c,f,l){var g=document.getElementsByName(this.sidebarPrefix_+"_"+c);if(!g||g.length<=0){return l}var k=[];switch(f){case"radiogroup":var h=false;for(var e=0;e<g.length;e++){var d=g[e];if(d.checked){k.push(d.value);h=true}}if(!h){k.push(l)}break;case"checkboxgroup":for(var e=0;e<g.length;e++){var d=g[e];if(d.checked){k.push(d.value)}}break;default:break}var m=k.join(",");return m};wundermap.Layer.prototype.addElementListener=function(e,c){var d={id:e,name:null,eventname:c};this.listenersSetupParams_.push(d)};wundermap.Layer.prototype.addElementsListeners=function(c,d){var e={id:null,name:c,eventname:d};this.listenersSetupParams_.push(e)};wundermap.Layer.prototype.addSliderListener=function(e,d){var c={id:e,slider_opts:d};this.slidersSetupParams_.push(c)};wundermap.Layer.prototype.getNumFrames=function(f,d){var e=this.getElementValue(d+"_slider","slider",null);if(e===null){var c=this.getElementValue(f+"_start","animate",null);if(c===true){e=this.options_.animation.max}if(c===false){e=1}}if(e===null){e=this.options_.animation.num}return e};wundermap.Layer.prototype.setAnimateToggle=function(c){if(c){this.animateStart.addClass("none");this.animateStop.removeClass("none")}else{this.animateStart.removeClass("none");this.animateStop.addClass("none")}};wundermap.Layer.prototype.displayDataTable=function(u,k,p){var p=a.extend(true,{},{numRows:10,panel:this.elt_displayAreaTab,tableClass:"contentTable",containerClass:"",rowClass:"",headerClasses:{},start:0,rowHover:true,rowClick:true,sortable:true,headerTop:false,getTableExtraRows:this.getTableExtraRows},p);var m=p.panel;if(!m||!(m[0])){return}var o=a('<div class="w300" style="overflow: hidden;"></div>');if(p.containerClass){o.addClass(p.containerClass)}var z=a('<table cellspacing="0" cellpadding="0"></table>').appendTo(o).addClass(p.tableClass);var y=a("<thead></thead>").appendTo(z);var c=a("<tbody></tbody>").appendTo(z);var l=a("<tfoot></tfoot>").appendTo(z);var h=p.start;if(h<0){h=0}var f=h+p.numRows;var g=null;var x=false;if(a.isArray(u)){if(p.getTableExtraRows){var d=p.getTableExtraRows.call(this);if(d){a.merge(u,d)}p.getTableExtraRows=null}for(var w=h;w<u.length&&w<f;w++){var n=u[w];if(!g){g=n}var e=this.getTableRowContent(n,p);e.addClass(p.rowClass).appendTo(c);this.addTableRowListeners(e,n,p);x=true}var r=this;var q=this.getTableHeaderContent((h+1),w,u.length);if(q){if(p.headerClasses.div){q.addClass(p.headerClasses.div)}if(h>0){var s=a('<a href="javascript:void(0)" class="b"></a>');s.bind("click",function(A){p.start=h-p.numRows;r.displayDataTable(u,k,p)})}else{var s=a('<span class="grey"></span>')}if(p.headerClasses.prev){s.addClass(p.headerClasses.prev)}s.html("&laquo; Prev").prependTo(q);if(u.length>w){var t=a('<a href="javascript:void(0)" class="b"></a>');t.bind("click",function(A){p.start=w;r.displayDataTable(u,k,p)})}else{var t=a('<span class="grey"></span>')}if(p.headerClasses.next){t.addClass(p.headerClasses.next)}t.html("Next &raquo;").appendTo(q)}if(p.headerTop){q.prependTo(o)}else{q.appendTo(o)}}else{for(var w in u){var n=u[w];if(!g){g=n}var e=this.getTableRowContent(n,p);e.addClass(p.rowClass).appendTo(c);this.addTableRowListeners(e,n,p);x=true}}var e=this.getTableHeadContent(g,p);if(e){y.append(e)}var e=this.getTableFootContent(g,p);if(e){l.append(e)}if(p.sortable&&z.tablesorter){if(a.isPlainObject(p.sortable)){z.tablesorter(p.sortable)}else{z.tablesorter()}}this.removeDataTable(k);this.dataTables_[k]=o;if(x){this.elt_displayAreaNoData.hide()}else{this.elt_displayAreaNoData.show()}o.appendTo(m);if(z.tableScroll&&wundermap.options.tray){var v=m.is(":visible");this.toggleTray(true);z.tableScroll({height:500});if(!v){this.toggleTray(false)}}else{if(p.sortable&&z.tablesorter){if(a.isPlainObject(p.sortable)){z.tablesorter(p.sortable)}else{z.tablesorter()}}}};wundermap.Layer.prototype.removeDataTable=function(c){if(this.dataTables_[c]){this.dataTables_[c].empty().remove();this.dataTables_[c]=null}};wundermap.Layer.prototype.removeDataTables=function(){for(var c=0;c<this.dataTables_.length;c++){this.removeDataTable(c)}this.dataTables_=[];this.elt_displayAreaNoData.show()};wundermap.Layer.prototype.addTableRowListeners=function(d,e,c){if(c.rowHover){d.bind("mouseenter",function(m){var k=null;if(e.marker){k=e.marker.getPosition()}else{if(e.lat&&e.lon){k=new google.maps.LatLng(e.lat,e.lon)}else{if(e.rect){var h=wundermap.imagemap_container.getProjection();var l=e.rect;var g=l.split(",");var f=(b(g[0])+b(g[2]))/2;var n=(b(g[1])+b(g[3]))/2;k=h.fromContainerPixelToLatLng(new google.maps.Point(f,n))}}}wundermap.setHighlight(k)}).bind("mouseleave",function(f){wundermap.setHighlight(null)})}if(c.rowClick&&e.marker){d.bind("click",function(f){google.maps.event.trigger(e.marker,"click")})}};wundermap.Layer.prototype.getTableHeaderContent=function(f,c,d){var e=a('<div class="pageNum"></div>');e.html("&nbsp;&nbsp;"+f+"&ndash;"+c+" of "+d+"&nbsp;&nbsp;");return e};wundermap.Layer.prototype.getTableHeadContent=function(c,d){return null};wundermap.Layer.prototype.getTableRowContent=function(e,f){var d=a("<tr></tr>");var c=a("<td></td>").appendTo(d);c.html(e.id);return d};wundermap.Layer.prototype.getTableFootContent=function(c,d){return null};wundermap.Layer.prototype.addAnimateListener=function(h,e,g){var d=this;this.animateStart=this.findId(h+"_start");this.animateStop=this.findId(h+"_stop");var f=this.findId(e+"_slider");var c=this.findId(e+"_value");var g=a.extend(true,{change:function(k,l){d.setAnimateToggle((l.value>1));d.refresh();google.maps.event.trigger(d,"settings_changed")}},g);this.addSliderListener(e,g);this.animateStart.click(function(k){if(wundermap.utils.hasTimelordWarning(f)){return}d.setAnimateToggle(true);var l=f.slider("option","max");f.slider("value",l);c.text(l)});this.animateStop.click(function(k){if(wundermap.utils.hasTimelordWarning(f)){return}d.setAnimateToggle(false);var l=f.slider("option","min");f.slider("value",l);c.text(l)});if(!f[0]){this.addElementListener(h+"_start","click");this.addElementListener(h+"_stop","click")}};wundermap.Layer.prototype.addOpacityListener=function(e,g){var d=this;var e=e||[0];var g=g||[0];var k=a("#"+d.sidebarPrefix_+"_opacity_value");var h=a("#"+this.sidebarPrefix_+"_opacity_slider");var f=this.options_.opacity||100;h.slider({value:this.options_.opacity||100,min:0,max:100,slide:function(l,m){c(m.value)},change:function(l,m){google.maps.event.trigger(d,"settings_changed")}});c(f);function c(p){k.text(p);for(var n=0;n<e.length;n++){var o=d.imagelayers_[e[n]];if(o){o.setOpacity(p/100)}}for(var n=0;n<g.length;n++){var m=d.tilelayers_[g[n]];if(m){m.setTilesOpacity(p/100)}}for(var n=0;n<g.length;n++){var l=d.tilelayerpools_[g[n]];if(l){l.setOpacity(p)}}}};wundermap.Layer.prototype.addMarkerOpacityListener=function(g){var d=this;var g=g||[0];var h=a("#"+d.sidebarPrefix_+"_opacity2_value");var f=a("#"+this.sidebarPrefix_+"_opacity2_slider");var e=this.options_.fillopacity||40;f.slider({value:this.options_.fillopacity||40,min:0,max:100,slide:function(k,l){c(l.value)},change:function(k,l){google.maps.event.trigger(d,"settings_changed")}});c(e);function c(m){h.text(m);for(var k=0;k<g.length;k++){var l=d.markerlayers_[g[k]];if(l){l.setOpacity(m/100)}}}};wundermap.Layer.prototype.addTilesOpacityListener=function(f){var d=this;var f=f||[0];var h=a("#"+d.sidebarPrefix_+"_opacity3_value");var g=a("#"+this.sidebarPrefix_+"_opacity3_slider");var e=this.options_.fillopacity||40;g.slider({value:this.options_.fillopacity||40,min:0,max:100,slide:function(k,l){c(l.value)},change:function(k,l){google.maps.event.trigger(d,"settings_changed")}});c(e);function c(n){h.text(n);for(var m=0;m<f.length;m++){var l=d.tilelayers_[f[m]];if(l){l.setTilesOpacity(n/100)}}for(var m=0;m<f.length;m++){var k=d.tilelayerpools_[f[m]];if(k){k.setOpacity(n)}}}};wundermap.Layer.prototype.clearClusters=function(){this.clusters_={};this.unclustered_={}};wundermap.Layer.prototype.storeCluster=function(d,c){this.clusters_[d]=c};wundermap.Layer.prototype.recallCluster=function(c){return this.clusters_[c]};wundermap.Layer.prototype.storeUnclustered=function(c,d){this.unclustered_[c]=d};wundermap.Layer.prototype.recallUnclustered=function(c){return this.unclustered_[c]};wundermap.Layer.prototype.getCluster=function(f){var d=this.recallCluster(f);if(!d){google.maps.event.trigger(self,"loaderror","failed to load cluster for key: "+f);return}var e=this.getBalloonContentCluster(d);if(this.options_.infopane){this.options_.infopane.showHTML(e)}else{var c=d.cluster_point;wundermap.openInfoBox({content:e,position:c})}};wundermap.Layer.prototype.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.Layer.prototype.getDetails=function(g,f){var d=this;var e=this.getDetailsURL(g,f);if(this.debug_>0){wui.log("getDetailsURL: "+e)}var c=(this.getAjaxOptions)?this.getAjaxOptions():{};a.ajax(a.extend({url:e,dataType:"json",success:function(k,h){d.onClick(k,f)},error:function(){google.maps.event.trigger(d,"loaderror","failed to load details for id: "+g)}},c))};wundermap.Layer.prototype.getDetailsCached=function(e,d,g){if(e>=0){var c=this.recallCluster(e);if(!c){google.maps.event.trigger(this,"loaderror","failed to load cluster for key: "+e);return}var f=c.clusternodes[d];if(!f){google.maps.event.trigger(this,"loaderror","failed to load node for key: "+e+", index: "+d);return}}else{var f=this.recallUnclustered(d);if(!f){google.maps.event.trigger(this,"loaderror","failed to load unclustered node for index: "+d);return}}var h={};h.ICONS=[f];this.onClick(h,g)};wundermap.Layer.prototype.onClick=function(h,g){var f=h.ICONS[0];if(!f){google.maps.event.trigger(this,"loaderror","failed to load detailed click.");return}var e=this.getBalloonContent(f);if(this.options_.infopane){this.options_.infopane.showHTML(e)}else{var k=parseFloat(f.lat);var l=parseFloat(f.lon);var c=new google.maps.LatLng(k,l);if(g&&g>0){var d=this.map_.maxZoom;if(g>d){g=d}this.map_.setCenter(c);this.map_.setZoom(g)}wundermap.openInfoBox({content:e,position:c})}};wundermap.Layer.prototype.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,gmapzoom:this.map_.getZoom()};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.Layer.prototype.getDataURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:"js",key:this.key_,gmapzoom:this.map_.getZoom()};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.Layer.prototype.getURLMapgen=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:c.theme,proj:"automerc",format:"gif",alpha:"1",stdout:"1"};if(c.subdomain){var d="http://"+c.subdomain+".wunderground.com/cgi-bin/mapgen"}else{var d="/cgi-bin/mapgen"}d+="?"+a.param(g);return d};wundermap.Layer.prototype.getImagemapAreas=function(e,k){if(this.debug_==1){wui.log("wundermap.Layer::getImagemapAreas")}var c=[];var l=wundermap.imagemap_container.getProjection();var m=e.length;this.clearClusters();for(var h=m-1;h>=0;h--){var g=e[h];var f=document.createElement("area");f.setAttribute("shape","rect");f.setAttribute("coords",g.rect);if(typeof g.clusterindex!="undefined"){var p=this.getClusterTitle(g);if(p){f.setAttribute("title",p)}f.setAttribute("href","javascript:wundermap.layers."+this.className+".getCluster('"+g.clusterindex+"')");if(this.handleClusterMouseover){f.setAttribute("onmouseover","wundermap.layers."+this.className+".handleClusterMouseover('"+g.clusterindex+"')")}if(this.handleClusterMouseout){f.setAttribute("onmouseout","wundermap.layers."+this.className+".handleClusterMouseout('"+g.clusterindex+"')")}var o=g.cluster_x;var n=g.cluster_y;var q=l.fromContainerPixelToLatLng(new google.maps.Point(o,n));g.cluster_point=q;g.cluster_hasDetailedResults=k;this.storeCluster(g.clusterindex,g)}else{var p=this.getMarkerTitle(g);if(p){f.setAttribute("title",p)}if(k){this.storeUnclustered(h,g);f.setAttribute("href","javascript:wundermap.layers."+this.className+".getDetailsCached(-1,"+h+",0)")}else{var d=this.getImagemapAreasHref(g,h,k,0);f.setAttribute("href",d)}}c.push(f)}if(this.debug_==1){wui.log("wundermap.Layer::getImagemapAreas done, "+m+" points.")}return c};wundermap.Layer.prototype.getImagemapAreasHref=function(f,d,c,e){var e=e||0;return"javascript:wundermap.layers."+this.className+".getDetails('"+f.id+"',"+e+")"};wundermap.Layer.prototype.getMarkerTitle=function(c){return c.name||c.id||""};wundermap.Layer.prototype.getClusterTitle=function(c){return c.clustercount+" locations near here"};wundermap.Layer.prototype.setTimelord=function(c){wundermap.timelord.set(c)};wundermap.Layer.prototype.moveToTop=function(){for(var c=0;c<this.imagelayers_.length;c++){var d=this.imagelayers_[c];d.moveToTop()}};wundermap.Layer.prototype.canMoveToTop=function(){return(this.imagelayers_.length>0)?true:false};wundermap.Layer.prototype.toggleMoveToTop=function(c){if(wundermap.options.moveToTop&&this.canMoveToTop()&&this.elt_titleBar[0]){if(!this.elt_moveToTop||!this.elt_moveToTop[0]){this.elt_moveToTop=this.createMoveToTopButton();this.elt_moveToTop.appendTo(this.elt_titleBar)}if(c){this.elt_moveToTop.removeClass("none")}else{this.elt_moveToTop.addClass("none")}}};wundermap.Layer.prototype.createMoveToTopButton=function(){var d=this;var e=a("<small></small>");var c=a("<a>top</a>").attr("title","Make this the Top-most layer on the map").attr("href","javascript:void(0)").bind("click",function(f){wundermap.options.top=d.name_;d.moveToTop();return false});e.append(" (").append(c).append(")");return e};wundermap.ImageLayer=function(f,d,e,c){this.options_=d||{};this.name_=this.options_.name;this.sidebarPrefix_=this.options_.sidebarPrefix;this.debug_=wundermap.options.debug||0;this.extraImageLoadFactor_=this.options_.extraImageLoadFactor||1;this.retryMax_=this.options_.retryMax||2;this.callbacks_=e||{};this.index_=c||0;this.map_=f;this.bounds_=null;this.div_=null;this.div2_=null;this.img_=null;this.img2_=null;this.canvas_=null;this.canvas2_=null;this.div_active_=null;this.div_pending_=null;this.img_active_=null;this.img_pending_=null;this.canvas_active_=null;this.canvas_pending_=null;this.num_loads_=0;this.disabled_=!!(e.disabled===true);this.listeners_=[];this.opacity_=100};wundermap.ImageLayer.prototype=new google.maps.OverlayView();wundermap.ImageLayer.prototype.constructor=wundermap.ImageLayer;wundermap.ImageLayer.prototype.onAdd=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::onAdd")}this.bounds_=this.callbacks_.fixedBounds||this.map_.getBounds();this.num_loads_=0;var c=a("<div></div>").css({"border-style":"none","border-width":"0px",position:"absolute"});var l=a("<img/>").css({"border-style":"none","border-width":"0px",width:"100%",height:"100%"});var e=null;var d=null;var m=c.clone();var g=l.clone();c.append(l);m.append(g);if(e){}this.div_=c;this.div2_=m;this.img_=l;this.img2_=g;this.canvas_=e;this.canvas2_=d;this.moveToTop();var p=this;l.bind({load:function(){p.loaded("load",c,l,e,m,g,d)},abort:function(){p.loaded("abort",c,l,e,m,g,d)},error:function(){p.loaded("error",c,l,e,m,g,d)}});g.bind({load:function(){p.loaded("load",m,g,d,c,l,e)},abort:function(){p.loaded("abort",m,g,d,c,l,e)},error:function(){p.loaded("error",m,g,d,c,l,e)}});this.img_active_=g;this.img_pending_=l;this.canvas_active_=d;this.canvas_pending_=e;this.div_active_=c;this.div_pending_=m;this.setOpacity(this.opacity_);this.loading_=false;this.requestedAnother_=false;this.retryNum_=0;if(this.callbacks_.checkbox){var h=this.callbacks_.checkbox[0];var k=document.getElementById(this.sidebarPrefix_+"_"+h);if(k){if(!k.checked){this.setDisabled(true)}var f=google.maps.event.addDomListener(k,"click",function(){p.setDisabled(!this.checked);p.refresh();google.maps.event.trigger(p,"settings_changed")});this.listeners_.push(f)}else{var n=this.callbacks_.checkbox[1];var o=wundermap.utils.isCheckedValue(n);if(!o){this.setDisabled(true)}}}this.refresh();if(this.name_=="wundermap"){this.moveToPane(this.getPanes().overlayMouseTarget);wundermap.imagemap=this.createImagemap();wundermap.imagemap_container=this}if(this.callbacks_.fn_getClickURL){var f=google.maps.event.addListener(this.map_,"click",function(r){if(!p.disabled_){var q=p.callbacks_.fn_getClickURL(r.latLng);p.loadClickURL(q,r.latLng)}});this.listeners_.push(f)}if(this.callbacks_.fn_getClickURLs){var f=google.maps.event.addListener(this.map_,"click",function(r){if(!p.disabled_){var t=[];for(var s=0;s<p.callbacks_.fn_getClickURLs.length;s++){var q=p.callbacks_.fn_getClickURLs[s](r.latLng);t.push(q)}p.loadClickURLs(t,r.latLng)}});this.listeners_.push(f)}};wundermap.ImageLayer.prototype.loadClickURL=function(f,c){var e=this;var d=this.callbacks_.ajaxOptions||{};a.ajax(a.extend({url:f,dataType:"json",success:function(h,g){if(!h){return}if(a.isEmptyObject(h)){return}if(e.callbacks_.fn_customClickResponse){e.callbacks_.fn_customClickResponse(h,c)}else{if(e.callbacks_.fn_getClickBalloonContent){var k=e.callbacks_.fn_getClickBalloonContent(h)}else{if(e.callbacks_.fn_getBalloonContent){var k=e.callbacks_.fn_getBalloonContent(h)}else{var k=wundermap.Layer.prototype.getBalloonContent.call(e,h)}}wundermap.openInfoBox({content:k,position:c})}},error:function(k,g,h){if(wundermap.debug>0){wui.log(g)}}},d))};wundermap.ImageLayer.prototype.loadClickURLs=function(k,c){var e=this;var d=this.callbacks_.ajaxOptions||{};var l=[];for(var g=0;g<k.length;g++){var f=k[g];var h=a.ajax(a.extend({url:f,dataType:"json"},d));l.push(h)}a.when.apply(a,l).done(function(){var o=[];for(var n=0;n<arguments.length;n++){o.push(arguments[n][0])}if(e.callbacks_.fn_getClickBalloonContent){var m=e.callbacks_.fn_getClickBalloonContent(o)}else{if(e.callbacks_.fn_getBalloonContent){var m=e.callbacks_.fn_getBalloonContent(o)}else{var m=wundermap.Layer.prototype.getBalloonContent.call(e,o)}}wundermap.openInfoBox({content:m,position:c})})};wundermap.ImageLayer.prototype.reposition=function(v){var w=this.map_;var h=this.bounds_;var e=this.div_active_;var y=this.img_active_;var x=this.getProjection();var u=h.getSouthWest();var s=h.getNorthEast();var l=x.fromLatLngToDivPixel(u);var k=x.fromLatLngToDivPixel(s);var q=k.x-l.x;var g=l.y-k.y;var f=l.x;var n=k.y;if(q<=0){var r=x.getWorldWidth();q+=r;if(l.x>0){f-=r}}var p=Math.round(q*this.extraImageLoadFactor_);var o=Math.round(g*this.extraImageLoadFactor_);var d=(p-q)/2;var c=(o-g)/2;f-=d;n-=c;if(Math.abs(n)<0.001){n=0}if(Math.abs(f)<0.001){f=0}e.css({left:f,top:n,width:p,height:o});if(v){this.div_active_.css("display","block");this.div_pending_.css("display","none")}if(v&&this.callbacks_.fn_getDataURL){var m=y.width();var t=y.height();if(m<p||t<o){google.maps.event.trigger(this,"imageload","error","image ("+m+"x"+t+") is smaller than the bounds ("+p+"x"+o+"), therefore imagemap is not aligned properly")}}};wundermap.ImageLayer.prototype.onRemove=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::remove")}while(this.listeners_.length>0){var c=this.listeners_.pop();google.maps.event.removeListener(c)}this.img_.unbind();this.img2_.unbind();this.clearImagemap();this.hideWhenEmpty();this.div_.remove();this.div2_.remove();this.div_=null;this.div2_=null;this.img_=null;this.img2_=null;this.canvas_=null;this.canvas2_=null;if(this.canvas_){this.canvas_[0].width=0;this.canvas2_[0].width=0}if(this.debug_==1){wui.log("wundermap.ImageLayer::remove complete")}};wundermap.ImageLayer.prototype.draw=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::draw")}this.reposition(false)};wundermap.ImageLayer.prototype.refresh=function(c){if(this.debug_==1){wui.log("wundermap.ImageLayer::refresh layer:"+this.name_)}if(this.disabled_===true){this.hideImage();this.clearImagemap();return}if(!this.map_||!this.map_.getMapTypeId()){return}if(!this.div_active_){return}if(!wundermap.firstIdle){if(this.debug_==1){wui.log("wundermap.ImageLayer::refresh prevented because no firstIdle: "+this.name_)}return}this.bounds_=this.callbacks_.fixedBounds||this.map_.getBounds();if(this.callbacks_.fn_getStaticURL&&this.num_loads_>0){this.reposition(false)}else{this.loadImage()}};wundermap.ImageLayer.prototype.loadImage=function(){if(this.loading_){this.requestedAnother_=true;if(this.debug_==1){wui.log("wundermap.ImageLayer.loadImage:: another load is already in progress")}return}this.loading_=true;var z=this.map_;var f=this.bounds_;var A=this.getProjection();var w=f.getSouthWest();var u=f.getNorthEast();if(this.callbacks_.fixedBounds){var l=A.fromLatLngToDivPixel(w);var h=A.fromLatLngToDivPixel(u);var r=h.x-l.x;var e=l.y-h.y}else{var t=z.getDiv();var r=a(t).width();var e=a(t).height()}var p=Math.round(r*this.extraImageLoadFactor_);var o=Math.round(e*this.extraImageLoadFactor_);var g=u.lat();var d=u.lng();var v=w.lat();var s=w.lng();if(s>d){s-=360}var c=null;var m={isDataURL:false};if(this.callbacks_.getURL_opts){a.extend(m,this.callbacks_.getURL_opts)}if(f.toSpan().lng()>=360){c=null}else{if(this.callbacks_.fn_getStaticURL){c=this.callbacks_.fn_getStaticURL(g,d,v,s,p,o,m)}else{if(this.callbacks_.fn_getURL){c=this.callbacks_.fn_getURL(g,d,v,s,p,o,m)}}}if(!c||c.length<1){this.hideImage();this.clearImagemap();this.loading_=false;return}google.maps.event.trigger(this,"imageload","loadstart","");var B=this.img_pending_;var x=window.location.protocol+"//"+window.location.host+c;if((B.attr("src")==c||B.attr("src")==x)&&this.retryNum_==0){if(this.debug_>0){wui.log("(cached) "+c)}B.triggerHandler("load")}else{if(this.debug_>0){wui.log(c)}B.attr("src",c)}var k=!!(this.callbacks_.fn_getDataURL);if(wundermap.timeline_range&&wundermap.timeline_range.animating){k=false}if(k){var m={isDataURL:true};if(this.callbacks_.getURL_opts){a.extend(m,this.callbacks_.getURL_opts)}var q=this.callbacks_.fn_getDataURL(g,d,v,s,p,o,m);if(!q||q.length<1){this.clearImagemap();this.hideWhenEmpty();return}if(this.debug_>0){wui.log(q)}var n=this;var y=this.callbacks_.ajaxOptions||{};a.ajax(a.extend({url:q,dataType:"json",success:function(D,C){n.dataLoaded("load",D)},error:function(){n.dataLoaded("error",null)}},y))}this.num_loads_++};wundermap.ImageLayer.prototype.loaded=function(m,c,h,e,l,k,g){if(this.debug_==1){wui.log("wundermap.ImageLayer::loaded event: "+m)}if(m=="load"){this.div_active_=c;this.div_pending_=l;this.img_active_=h;this.img_pending_=k;this.canvas_active_=e;this.canvas_pending_=g;this.reposition(true);if(this.requestedAnother_){this.requestedAnother_=false;this.loading_=false;this.refresh()}else{this.retryNum_=0;this.requestedAnother_=false;this.loading_=false;google.maps.event.trigger(this,"imageload",m,"");if(!this.callbacks_.fn_getDataURL){this.hideWhenEmpty()}}h[0].onload=null;if(e){e[0].width=c.width();e[0].height=c.height();var d=e[0].getContext("2d");d.drawImage(h[0],0,0);this.context_=d}}else{if(this.retryNum_<this.retryMax_){this.retryNum_+=1;this.requestedAnother_=false;this.loading_=false;var n=this;window.setTimeout(function(){n.refresh()},5000)}else{this.requestedAnother_=false;this.loading_=false;var f="the image-load encountered an "+m+" signal after "+this.retryNum_+" retries.";if(this.debug_>0){}google.maps.event.trigger(this,"imageload",m,f);this.retryNum_=0;if(m=="abort"){h[0].onabort=null}else{if(m=="error"){h[0].onerror=null}}if(!this.callbacks_.fn_getDataURL){this.hideWhenEmpty()}}}};wundermap.ImageLayer.prototype.dataLoaded=function(n,m){if(this.debug_==1){wui.log("wundermap.ImageLayer::dataloaded event: "+n)}this.clearImagemap();if(n=="load"){if(!this.callbacks_.fn_getImagemapAreas){var g="the imagemap-load is missing a function callback: 'fn_getImagemapAreas'";google.maps.event.trigger(this,"imageload","error",g);return}var f=this.sidebarPrefix_+"_imagemap_"+this.index_;var o=this.getImagemap();if(!o){var g="missing an imagemap element";google.maps.event.trigger(this,"imageload","error",g);return}var p=a("<div></div>").attr("id",f);o.append(p);var e=m.ICONS;var d=this.callbacks_.getURL_opts;if(d&&d.hasDetailedResults){var c=this.callbacks_.fn_getImagemapAreas(e,d.hasDetailedResults)}else{var c=this.callbacks_.fn_getImagemapAreas(e,false)}var h=c.length;for(var k=0;k<h;k++){p[0].appendChild(c[k])}if(this.callbacks_.fn_useDataNodes){this.callbacks_.fn_useDataNodes(e,this.index_)}}else{var g="the imagemap-load encountered an "+n+" signal";if(this.debug_>0){g+=" URL is: "}google.maps.event.trigger(this,"imageload","error",g)}this.hideWhenEmpty()};wundermap.ImageLayer.prototype.moveToTop=function(){var c=this.getPanes();if(!c){return}if(this.callbacks_.fn_getDataURL){var d=c.overlayImage}else{var d=c.mapPane}this.moveToPane(d);google.maps.event.trigger(wundermap,"imagelayer_moved")};wundermap.ImageLayer.prototype.moveToPane=function(c){this.div_.appendTo(c);this.div2_.appendTo(c)};wundermap.ImageLayer.prototype.setOpacity=function(c){this.opacity_=c;if(this.div_active_){this.div_active_.css("opacity",c)}if(this.div_pending_){this.div_pending_.css("opacity",c)}};wundermap.ImageLayer.prototype.getURL=function(d,f,e,g,h,c,k){return""};wundermap.ImageLayer.prototype.hideImage=function(){if(this.div_){this.div_.css("display","none")}if(this.div2_){this.div2_.css("display","none")}};wundermap.ImageLayer.prototype.showImage=function(){if(this.div_active_){this.div_active_.css("display","block")}if(this.div_pending_){this.div_pending_.css("display","none")}};wundermap.ImageLayer.prototype.clearImagemap=function(){var d=this.sidebarPrefix_+"_imagemap_"+this.index_;var c=a("#"+d);c.remove()};wundermap.ImageLayer.prototype.getImagemap=function(){return wundermap.imagemap};wundermap.ImageLayer.prototype.getImagemapContainer=function(){return wundermap.imagemap_container};wundermap.ImageLayer.prototype.createImagemap=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::createImagemap")}var g=this.sidebarPrefix_+"_imagemap_"+this.index_;var d=a("#"+g);if(d){d.remove()}var c=a("<map></map>").attr("id",g);try{c.attr("name",g)}catch(f){}this.div_active_.parent().append(c);this.img_.attr("useMap","#"+g);this.img2_.attr("useMap","#"+g);return c};wundermap.ImageLayer.prototype.hideWhenEmpty=function(){var d=this.getImagemap();var c=this.getImagemapContainer();if(d&&c){var e=d.find("area");if(e.length>0){c.showImage()}else{c.hideImage()}}};wundermap.ImageLayer.prototype.getDisabled=function(){return this.disabled_};wundermap.ImageLayer.prototype.setDisabled=function(c){this.disabled_=(c)?true:false};wundermap.ImageLayer.prototype.getBounds=function(){return this.bounds_};wundermap.MarkerLayer=function(g,e,f,d){if(this.debug_==1){wui.log("wundermap.MarkerLayer::init")}var c=this;this.options_=e||{};this.name_=this.options_.name;this.sidebarPrefix_=this.options_.sidebarPrefix;this.debug_=wundermap.options.debug||0;this.map_=g;this.data_={};this.markerarray_={};this.nummarkers_=0;this.listeners_=[];this.infoWindows_=[];this.display_={iconcache:{}};this.callbacks_=f||{};this.index_=d||0;this.loading_=false;this.disabled_=!!(f.disabled===true);this.numLoads_=0;this.jsoncache_={};if(this.callbacks_.useJsonCache){a.extend(this.jsoncache_,{json:null,lastrefresh:new Date(),lasturl:"",timeout:this.callbacks_.useJsonCache})}};wundermap.MarkerLayer.prototype.refresh=function(c){if(this.debug_==1){wui.log("wundermap.MarkerLayer::refresh layer:"+this.className)}if(this.loading_){if(this.debug_==1){wui.log("wundermap.MarkerLayer:: another load is already in progress")}return}var c=c||{};var k=c.eventname||"";if(k){if(this.numLoads_==0){k="firstload"}if(this.callbacks_.ignoreEvents){if(a.inArray(k,this.callbacks_.ignoreEvents)>-1){return}}}this.loading_=true;if(!this.callbacks_.noRemoveOnRefresh){this.removeOverlays()}if(this.disabled_){this.removeOverlays();this.loading_=false;return}var g=new Date();var h=this.jsoncache_.lastrefresh;if(!this.jsoncache_.json||(g.getTime()-h.getTime())>this.jsoncache_.timeout*1000){if(this.debug_==1){wui.log("MarkerLayer::refresh via ajax")}var d=this.map_.getBounds();var q=d.getSouthWest();var r=d.getNorthEast();var n=r.lat();var p=r.lng();var l=q.lat();var o=q.lng();if(o>p){o-=360}var t=this.map_.getDiv();var u=a(t).width();var m=a(t).height();var f=Math.round(u*1);var s=Math.round(m*1);var e=null;a.extend(c,{isDataURL:false});if(this.callbacks_.getURL_opts){a.extend(c,this.callbacks_.getURL_opts)}if(this.callbacks_.fn_getURL){e=this.callbacks_.fn_getURL(n,p,l,o,f,s,c)}else{if(this.debug_==1){wui.log("MarkerLayer::layer "+this.className+" : this.callbacks_.fn_getURL == false")}this.loading_=false;return}if(!e||e.length<1){this.loading_=false;return}if(this.debug_>0){wui.log(e)}this.numLoads_++;if(this.callbacks_.fn_getURLDataCallback){this.loadURLData(e,this.callbacks_.fn_getURLDataCallback,this.callbacks_.ajaxOptions)}else{this.loading_=false}}else{if(this.debug_>0){wui.log("MarkerLayer::refresh via cache")}this.callbacks_.fn_getURLDataCallback.call(this,this.jsoncache_.json,this.callbacks_.ajaxOptions);this.loading_=false}};wundermap.MarkerLayer.prototype.setOpacity=function(d){if(this.disabled_||this.loading_){}for(var c in this.markerarray_){this.markerarray_[c].setOptions({fillOpacity:d})}};wundermap.MarkerLayer.prototype.isMarkerInArray=function(c){return !!(this.markerarray_[c])};wundermap.MarkerLayer.prototype.getMarker=function(c){if(!c){return null}if(this.isMarkerInArray(c)){return this.markerarray_[c]}else{return null}};wundermap.MarkerLayer.prototype.addMarker=function(c){this.addMarkerWithKey(c,this.nummarkers_+1,true)};wundermap.MarkerLayer.prototype.addMarkerWithKey=function(d,f,g){if(!d){return}if(f===0){}else{if(!f){if(wundermap.debug==1){wui.log("addMarkerWithKey requires key to set marker")}return}}var e=(g===true)?true:false;var c=this.getMarker(f);if(!c){if(d.getMap()==null){d.setMap(wundermap.map)}this.markerarray_[f]=d;this.nummarkers_++}else{if(c&&e){this.removeOverlay(f);if(d.getMap()==null){d.setMap(wundermap.map)}this.markerarray_[f]=d;this.nummarkers_++}else{this.destroyMarker(d)}}};wundermap.MarkerLayer.prototype.removeOverlays=function(){for(var c in this.markerarray_){this.removeOverlay(c)}this.markerarray_={};this.nummarkers_=0};wundermap.MarkerLayer.prototype.removeOverlay=function(c){this.destroyMarker(c)};wundermap.MarkerLayer.prototype.destroyMarker=function(c){if(!c){return}if(!this.isMarkerInArray(c)){return}this.markerarray_[c].setMap(null);google.maps.event.clearInstanceListeners(this.markerarray_[c]);this.markerarray_[c]=null;this.nummarkers_--};wundermap.MarkerLayer.prototype.makeIcon=function(c){var m=c.iconname||"clearCircle.gif";if(this.display_.iconcache[m]){return this.display_.iconcache[m]}else{var f=c.width||15;var n=c.height||15;var e=c.iconsdomain||wundermap.options.iconsdomain;var o=c.path||"/graphics/smash/";var d=e+o+m;if(this.debug_==1){wui.log("MarkerLayer::makeIcon : url = "+d)}var k=new google.maps.Size(f,n);var g=new google.maps.Point(f/2,n/2);var h=new google.maps.Point(f/2,n/2);var l={url:d,size:k,anchor:h};this.display_.iconcache[m]=l;return l}};wundermap.MarkerLayer.prototype.getDisabled=function(){return this.disabled_};wundermap.MarkerLayer.prototype.setDisabled=function(c){this.disabled_=(c)?true:false};wundermap.MarkerLayer.prototype.getURL=function(d,f,e,g,h,c,k){if(this.debug_==1){wui.log("In 'abstract' MarkerLayer.prototype.getURL() -- Define it in wundermap.js")}return""};wundermap.MarkerLayer.prototype.loadURLData=function(e,f,d){if(this.debug_==1){wui.log("wundermap.MarkerLayer::loadURLData")}google.maps.event.trigger(this,"layerload","loadstart","");var c=this;a.ajax(a.extend({url:e,dataType:"json",success:function(h,g){if(this.debug_==1){wui.log("MarkerLayer::loadURLData() response: "+h)}if(!h||a.isEmptyObject(h)){google.maps.event.trigger(c,"layerload","load","");return}google.maps.event.trigger(c,"layerload","load","");if(c.jsoncache_.lastrefresh){c.jsoncache_.json=h;c.jsoncache_.lasturl=e}f.call(c,h,d)},error:function(k,g,h){google.maps.event.trigger(c,"layerload","error","failed to load marker data: "+g)}},d));c.loading_=false};wundermap.MarkerLayer.prototype.getURLDataCallback=function(c){if(this.debug_==1){wui.log("In 'abstract' MarkerLayer.prototype.getURLDataCallback -- Define it in wundermap.js")}return};wundermap.TileLayer=function(c,r,d,m){this.name_=d;this.options_=r||{};this.sidebarPrefix_=this.options_.sidebarPrefix;this.opacity_fraction_=0.01*(("opacity" in this.options_)?this.options_.opacity:80);this.debug_=wundermap.options.debug||0;this.index_=m||0;this.zIndex_=this.options_.zIndex||null;var q=this;this.tiles_=[];this.tiles2_=[];this.active={name:d,tiles:this.tiles_};this.pending={name:d+"2",tiles:this.tiles2_};this.numSwapsRequested_=0;this.numSwapsCompleted_=0;this.loading_=false;this.timer_=null;this.timeout_=this.options_.timeout||3000;this.requestedAnother_=false;this.disabled_=!!(this.options_.disabled===true);this.visible_=false;this.options_.autoEnable=!!(this.options_.autoEnable);if(this.options_.getTileUrl){var e=this.options_.getTileUrl}else{var e=a.proxy(this.getTileUrl,this)}var o=this.options_.maxTileZoom||6;var g=new google.maps.ImageMapType({getTileUrl:function(t,s){if(q.disabled_){return null}if(s>o){return null}var l=e(t,s);if(wundermap.debug>0){wui.log(l)}return l},tileSize:new google.maps.Size(256,256),opacity:this.opacity_fraction_,minZoom:0,maxZoom:o,name:this.active.name,alt:this.active.name+" (0-"+o+")"});g.set("zIndex",this.zIndex_);this.tiles_.push(g);var g=new google.maps.ImageMapType({getTileUrl:function(t,s){if(q.disabled_){return null}if(s>o){return null}var l=e(t,s);if(wundermap.debug>0){wui.log(l)}return l},tileSize:new google.maps.Size(256,256),opacity:this.opacity_fraction_,minZoom:0,maxZoom:o,name:this.pending.name,alt:this.pending.name+" (0-"+o+")"});g.set("zIndex",this.zIndex_);this.tiles2_.push(g);var n=[];for(var k=o+1;k<=12;k++){n.push(k)}a.each(n,function(s,u){var t=u;var l=new google.maps.ImageMapType({getTileUrl:function(x,w){if(q.disabled_){return null}if(w!=t){return null}w=o;var v=e(x,w);if(wundermap.debug>0){wui.log(v)}return v},tileSize:new google.maps.Size(256*Math.pow(2,t-o),256*Math.pow(2,t-o)),opacity:q.opacity_fraction_,minZoom:t,maxZoom:t,name:q.active.name,alt:q.active.name+" ("+t+")"});l.set("zIndex",q.zIndex_);q.tiles_.push(l);var l=new google.maps.ImageMapType({getTileUrl:function(x,w){if(q.disabled_){return null}if(w!=t){return null}w=o;var v=e(x,w);if(wundermap.debug>0){wui.log(v)}return v},tileSize:new google.maps.Size(256*Math.pow(2,t-o),256*Math.pow(2,t-o)),opacity:q.opacity_fraction_,minZoom:t,maxZoom:t,name:q.pending.name,alt:q.pending.name+" ("+t+")"});l.set("zIndex",q.zIndex_);q.tiles2_.push(l)});var p=this.active.tiles.concat(this.pending.tiles);for(var k=0,f=p.length;k<f;k++){var h=p[k];google.maps.event.addListener(h,"tilesloaded",function(){var l=wundermap.map.getZoom();if(l>=this.minZoom&&l<=this.maxZoom){if(q.debug_==1){console.log("tilesloaded: "+this.alt)}google.maps.event.trigger(q,"imageload","load","");q.stopTimer();q.busy_=false}})}};wundermap.TileLayer.prototype.getTileUrl=function(k,g){var e=1<<g;var c=((k.x%e)+e)%e;var h=k.y;if(c<0||h<0){return null}else{if(wundermap.date===null){return null}else{var f=wui.date.strftime("%Y/%m/%d/%H",wundermap.date,true);var d="http://timelord.wunderground.com/timelord/"+this.name_+"/"+f+"/"+g+"/"+c+"/"+h+".png";return d}}};wundermap.TileLayer.prototype.getDisabled=function(){return this.disabled_};wundermap.TileLayer.prototype.setDisabled=function(c){this.disabled_=c};wundermap.TileLayer.prototype.isVisible=function(){return this.visible_===true};wundermap.TileLayer.prototype.addTiles=function(){this.requestedAnother_=false;this.visible_=true;this.addSpecifiedTiles(this.tiles_)};wundermap.TileLayer.prototype.addSpecifiedTiles=function(c){for(var d=0;d<c.length;d++){wundermap.utils.overlayMapTypes.add(c[d])}};wundermap.TileLayer.prototype.removeTiles=function(){wundermap.utils.overlayMapTypes.removeByName(this.active.name);wundermap.utils.overlayMapTypes.removeByName(this.pending.name);this.requestedAnother_=false;this.visible_=false;this.stopTimer();this.busy_=false};wundermap.TileLayer.prototype.swapTiles=function(){this.numSwapsRequested_++;if(this.busy_){this.requestedAnother_=true;return}this.busy_=true;var d=this;wundermap.utils.removeOverlayMapTypeByName(this.pending.name);this.setSpecifiedTilesOpacity(this.pending.tiles,0);this.visible_=true;this.addSpecifiedTiles(this.pending.tiles);for(var e=0,c=this.pending.tiles.length;e<c;e++){var f=this.pending.tiles[e];google.maps.event.addListenerOnce(f,"tilesloaded",function(){var h=wundermap.map.getZoom();if(h>=this.minZoom&&h<=this.maxZoom){wundermap.utils.removeOverlayMapTypeByName(d.active.name);d.setSpecifiedTilesOpacity(d.pending.tiles,d.opacity_fraction_);var g=d.pending;d.pending=d.active;d.active=g;d.numSwapsCompleted_++;if(d.requestedAnother_){d.requestedAnother_=false;d.swapTiles()}}})}google.maps.event.trigger(this,"imageload","loadstart","");if(this.numSwapsRequested_>1){this.startTimer()}};wundermap.TileLayer.prototype.refresh=function(c){if(wundermap.debug==1){wui.log("TileLayer::refresh")}if(this.disabled_!==true&&this.visible_===true){this.swapTiles()}else{this.removeTiles()}};wundermap.TileLayer.prototype.startTimer=function(){var c=this;this.timer_=window.setTimeout(function(){if(c.debug_==1){console.log("tilestimeout: "+c.pending.name)}google.maps.event.trigger(c,"imageload","load","");wundermap.utils.removeOverlayMapTypeByName(c.active.name);var d=c.pending;c.pending=c.active;c.active=d;c.busy_=false},this.timeout_)};wundermap.TileLayer.prototype.stopTimer=function(){window.clearTimeout(this.timer_)};wundermap.TileLayer.prototype.setTilesOpacity=function(c){this.setSpecifiedTilesOpacity(this.tiles_,c);this.setSpecifiedTilesOpacity(this.tiles2_,c);this.opacity_fraction_=c};wundermap.TileLayer.prototype.setSpecifiedTilesOpacity=function(c,e){for(var d=0;d<c.length;d++){c[d].setOpacity(e)}};wundermap.TileLayer.prototype.addListeners=function(){for(var d=0,c=this.tiles_.length;d<c;d++){var e=this.tiles_[d];google.maps.event.addListenerOnce(e,"tilesloaded",function(){var f=wundermap.map.getZoom();if(f>=this.minZoom&&f<=this.maxZoom){if(this.debug_==1){console.log("tilesloaded: "+this.alt)}}})}};wundermap.LayerGroup=function(){};wundermap.LayerGroup.prototype.initialize=function(f,d){this.selected=false;this.layers=f;this.elt_titleBar=a("#LayerGroup"+d.id);this.elt_checkbox=a("#LayerGroup"+d.id+"_checkbox");this.elt_wuCheckbox=a("#LayerGroup"+d.id+"_wuCheckbox");this.elt_header=this.elt_titleBar.filter(".accordion-header");this.elt_content=this.elt_header.next(".accordion-content");var c=this;var e=this.elt_checkbox.add(this.elt_wuCheckbox);e.bind("click",function(h){h.stopPropagation();var g=c.elt_checkbox[0].checked;if(!a(this).is(c.elt_checkbox)){g=!g}if(g){c.slide(true)}c.toggle(g)});this.elt_header.bind("click",function(h){var g=c.elt_content.is(":visible");c.slide(!g)});google.maps.event.addListener(wundermap,"layertoggled",function(h,g){c.checkSelected()});this.slide(true)};wundermap.LayerGroup.prototype.checkSelected=function(){var c=this.getNumActiveLayers();if(c>0){this.setSelected(true)}else{this.setSelected(false)}};wundermap.LayerGroup.prototype.setSelected=function(c){var c=!!c;this.selected=c;this.elt_checkbox.attr("checked",c);this.elt_titleBar.toggleClass(wundermap.classNames.layerTitleSelected,c)};wundermap.LayerGroup.prototype.toggle=function(c){this.setSelected(c);for(var d=0;d<this.layers.length;d++){this.layers[d].toggle(c)}};wundermap.LayerGroup.prototype.getNumActiveLayers=function(){var c=0;for(var d=0;d<this.layers.length;d++){if(this.layers[d].active_){c++}}return c};wundermap.LayerGroup.prototype.slide=function(c){var d="slow";if(c){this.elt_header.addClass(wundermap.classNames.accordionSelected);this.elt_content.slideDown(d)}else{this.elt_titleBar.removeClass(wundermap.classNames.accordionSelected);this.elt_content.slideUp(d)}};wundermap.layers.Radar=new wundermap.Layer();wundermap.layers.Radar.className="Radar";wundermap.layers.Radar.initialize=function(k,d){var h={name:"rad",title:"Radar",sidebarPrefix:"LayerRadarAnimGif",displayAreaTab:"displayArea",opacity:70,type:"N0R",type2:"",smooth:1,stormtracks:0,stormtracks_opts:{strokeColor:"#FF0000",strokeWeight:1,strokeOpacity:1,fillColor:"#CCCCCC",fillOpacity:0.4},animation:{num:1,max:15,delay:100},refreshTimeout:150,subdomain:"radblast",step:"1hour",useTiles:false,timelord:{showTooltip:true,text:"from 1994 to 6 hours in the future",min:new Date(Date.UTC(1994,1-1,1)),max:wundermap.utils.createDateFunction(6,"hour")}};d=a.extend(true,{},h,d);wundermap.Layer.prototype.initialize.call(this,k,d);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),getURL_opts:{CORS:true}});this.addImageLayer({disabled:true,fn_getURL:a.proxy(this.getURLFuture,this)});this.addImageLayer({disabled:true,fn_getURL:a.proxy(this.getURLArchive,this),fixedBounds:new google.maps.LatLngBounds(new google.maps.LatLng(21.12,-133),new google.maps.LatLng(52,-58))});this.addMarkerLayer({fn_getURL:a.proxy(this.getURLStorms,this),fn_getURLDataCallback:a.proxy(this.drawData,this)});if(this.options_.useTiles===true&&wundermap.hasOwnProperty("TileLayerPool")){if(wundermap.timeline_master){var g=this.getTileDates()}else{var g=[wundermap.date]}var l=g.length;var c=this;var e=this.addTileLayerPool({autoInitialize:false,dates:g,getTileUrl:a.proxy(this.getTileUrl,this),index:null,maxTileZoom:a.proxy(this.getTileMaxZoom,this),name:"YanivTestTiles",num:l,numFramesPerLane:12,opacity:this.options_.opacity,zIndex:10});google.maps.event.addListener(e,"status_changed",function(m){var n="idle";if(m.loading&&wundermap.status.animating){n="Loading&hellip; "+m.numLoaded+" of "+m.numFramesPerLane;if(m.numFrames!==m.numFramesPerLane){n+=" (of "+m.numFrames+")"}}if(m.index||m.index===0){n+="<br />Showing frame "+m.index}if(m.pending||m.pending===0){n+=" (pending frame "+m.pending+")"}if(m.date){n+="<br />"+m.date.toUTCString()}c.findId("log").html(n)});var f=".wundermap_layers_"+this.className;a(wundermap.timeline_master).bind("viewport_changed"+f,function(p,r,m){if(c.active_){var o=c.getTileDates();var n=e.compareDates(o);if(!n){if(wundermap.debug==1){wui.log("viewport_changed and dates are different")}e.destroy();var q=o.length;e.setOptions({date:wundermap.date,dates:o,num:q});e.initialize()}}});google.maps.event.addListener(this,"settings_changed",function(){if(c.active_){c.custom_check_dates_with_tile_pool(wundermap.date)}});google.maps.event.addListener(this.map_,"zoom_changed",function(){if(c.active_){c.custom_check_dates_with_tile_pool(wundermap.date)}})}else{if(this.options_.useTiles===true&&this.hasOwnProperty("getTileUrl")){this.addTileLayer("RadarCurrent",{maxTileZoom:8,zIndex:10,getTileUrl:a.proxy(this.getTileUrl,this)});this.addTileLayer("RadarFuture",{maxTileZoom:6,zIndex:10,getTileUrl:a.proxy(this.getTileUrlFuture,this)});var c=this;google.maps.event.addListener(this,"settings_changed",function(){if(c.active_){c.custom_check_tiles()}});google.maps.event.addListener(this.map_,"zoom_changed",function(){if(c.active_){c.custom_check_tiles()}})}}this.markerLayerStormTracks=0;this.addOpacityListener([0,1,2]);this.addElementListener("smooth","click");this.setElementValue("smooth","checkbox",this.options_.smooth);this.addElementListener("stormtracks","click");this.setElementValue("stormtracks","checkbox",this.options_.stormtracks);this.addElementListener("type","change");this.setElementValue("type","select",this.options_.type);this.addElementListener("type2","change");this.setElementValue("type2","select",this.options_.type2);this.addElementListener("delay","change");this.setElementValue("delay","select",this.options_.animation.delay);this.setElementValue("subdomain","input",this.options_.subdomain);this.addAnimateListener("animate","frames",{min:1,max:this.options_.animation.max,value:this.options_.animation.num})};wundermap.layers.Radar.custom_check_dates=function(g){if(this.options_.useTiles===true&&this.hasOwnProperty("custom_check_dates_with_tiles")){return this.custom_check_dates_with_tiles(g)}var e=new Date();var c=new Date(e.getTime()-1800*1000);var f=new Date(e.getTime()+3600*1000);if(g&&g>f){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(false);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(true)}else{if(g&&g<c){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(false);this.markerlayers_[0].setDisabled(true)}else{this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(false)}}this.removeDataTables()};wundermap.layers.Radar.custom_check_dates_with_tiles=function(f){var e=this.tilelayerpools_[0];if(e&&this.hasOwnProperty("custom_check_dates_with_tile_pool")){return this.custom_check_dates_with_tile_pool(f)}var c=this.getTimePeriod(f);if(c===1){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(true);this.tilelayers_[0].removeTiles();this.custom_check_tiles({timeperiod:1})}else{if(c===-1){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(false);this.markerlayers_[0].setDisabled(true);this.tilelayers_[0].removeTiles();this.tilelayers_[1].removeTiles()}else{if(c===-0.5){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(true);this.tilelayers_[1].removeTiles();this.custom_check_tiles({timeperiod:-0.5})}else{this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(false);this.tilelayers_[1].removeTiles();this.custom_check_tiles({timeperiod:0})}}}this.removeDataTables()};wundermap.layers.Radar.custom_check_dates_with_tile_pool=function(f){var c=this.getTimePeriod(f);if(this.imagelayers_[1]){this.imagelayers_[1].setDisabled(true)}if(this.tilelayers_[0]){this.tilelayers_[0].removeTiles()}if(this.tilelayers_[1]){this.tilelayers_[1].removeTiles()}if(c===1){this.imagelayers_[0].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(true);if(this.active_){this.tilelayerpools_[0].showDate(f)}}else{if(c===-1){this.imagelayers_[0].setDisabled(true);this.imagelayers_[2].setDisabled(false);this.markerlayers_[0].setDisabled(true);this.tilelayerpools_[0].hideAll()}else{if(c===-0.5){this.imagelayers_[0].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(true);if(this.active_){this.tilelayerpools_[0].setDisabled(false);this.tilelayerpools_[0].showDate(f)}}else{this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(false);var e=this.canUseTiles();if(e){this.imagelayers_[0].setDisabled(true);if(this.active_){this.tilelayerpools_[0].setDisabled(false);this.tilelayerpools_[0].showDate(f)}}else{this.imagelayers_[0].setDisabled(false);this.tilelayerpools_[0].setDisabled(true);this.tilelayerpools_[0].hideAll()}}}}this.removeDataTables()};wundermap.layers.Radar.custom_check_tiles=function(c){var f=!this.imagelayers_[0].getDisabled();var m=this.tilelayers_[0].isVisible();var l=!this.imagelayers_[2].getDisabled();var k=this.tilelayers_[1].isVisible();var e=this.tilelayers_[1].isVisible();var d=this.canUseTiles();var c=c||{};if(c&&c.hasOwnProperty("timeperiod")){var o=c.timeperiod}else{if(wundermap.date){var o=this.getTimePeriod(wundermap.date)}else{var o=0}}var g=(o===0)?true:false;var n=(o===-0.5)?true:false;var h=(o===1)?true:false;if(g&&d&&m){this.imagelayers_[0].setDisabled(true);if(this.active_){this.tilelayers_[0].swapTiles()}else{this.tilelayers_[0].removeTiles()}}else{if(g&&d){this.imagelayers_[0].setDisabled(true);if(this.active_){this.tilelayers_[0].swapTiles()}else{this.tilelayers_[0].removeTiles()}}else{if(g&&f){this.tilelayers_[0].removeTiles()}else{if(g){this.imagelayers_[0].setDisabled(false);this.tilelayers_[0].removeTiles()}else{if(n&&k){this.imagelayers_[2].setDisabled(true);if(this.active_){this.tilelayers_[0].swapTiles()}else{this.tilelayers_[0].removeTiles()}}else{if(n){this.imagelayers_[2].setDisabled(true);if(this.active_){this.tilelayers_[0].swapTiles()}else{this.tilelayers_[0].removeTiles()}}else{if(h&&e){if(this.active_){this.tilelayers_[1].swapTiles()}else{this.tilelayers_[1].removeTiles()}}else{if(h&&d){if(this.active_){this.tilelayers_[1].swapTiles()}else{this.tilelayers_[1].removeTiles()}}else{this.imagelayers_[0].setDisabled(true);this.tilelayers_[0].removeTiles();this.tilelayers_[1].removeTiles()}}}}}}}}};wundermap.layers.Radar.getTimePeriod=function(h){var e=new Date();var g=new Date(e.getTime()+600*1000);var c=new Date(e.getTime()-14400*1000);var f=new Date(e.getTime()-360*1000);if(h&&h>g){return 1}else{if(h&&h<c){return -1}else{if(h&&h<f){return -0.5}else{return 0}}}};wundermap.layers.Radar.canUseTiles=function(){var c=this.getPrefs();var d=this.map_.getZoom();return(c.smo=="1"&&c.type=="00Q"&&c.type2==""&&c.num=="1"&&d<=8)};wundermap.layers.Radar.getTileMaxZoom=function(e){var c=this.getTimePeriod(e);if(c===1){return 6}else{return 8}};wundermap.layers.Radar.getTileDates=function(){var c=[];var e=new Date(wundermap.timeline_range.date_start.getTime());var m=new Date(wundermap.timeline_range.date_end.getTime());var h=wui.date.create(-4,"hour");var l=wui.date.create(6,"hour");if(e<h){e.setTime(h.getTime());e=wui.date.roundUpTo(e,6,"minute")}else{var n=this.getTimePeriod(e);if(n===1){e=wui.date.roundDownTo(e,15,"minute")}else{e=wui.date.roundDownTo(e,6,"minute")}}if(m>l){m.setTime(l.getTime());m=wui.date.roundDownTo(e,15,"minute")}else{var n=this.getTimePeriod(m);if(n===1){m=wui.date.roundUpTo(m,15,"minute")}else{m=wui.date.roundUpTo(m,6,"minute")}}var k=wui.date.floor(e,"minute");var f=this.getTimePeriod(k);while(k<=m){c.push(new Date(k.getTime()));var n=this.getTimePeriod(k);if(n===1&&n!==f){var g=wui.date.roundTo(k,15,"minute");if(g<k||g.getTime()===k.getTime()){k=wui.date.increment(g,15,"minute")}else{k=g}}else{if(n===1){wui.date.increment(k,15,"minute")}else{wui.date.increment(k,6,"minute")}}}return c};wundermap.layers.Radar.getURL=function(k,g,s,q,p,o,n){var v={maxlat:k,maxlon:g,minlat:s,minlon:q,width:p,height:o,type:this.getElementValue("type","select",this.options_.type),frame:"0",num:this.getNumFrames("animate","frames"),delay:this.getElementValue("delay","select",this.options_.animation.delay),png:"0",smooth:(this.getElementValue("smooth","checkbox",this.options_.smooth))?"1":"0",min:"0",noclutter:"0",rainsnow:"1",nodebug:"0",theext:".gif",timelabel:"1","timelabel.x":p-160,"timelabel.y":41,brand:"wundermap",radar_bitmap:"1",noclutter_mask:"1",rand:Math.floor((new Date()).getTime()/60000)};if(this.map_.getZoom()<=7){v["reproj.automerc"]="1"}var t=this.getElementValue("type2","select","");if(t){v.type2=t}var r=this.getElementValue("lightning","checkbox",false);if(r){v.lightning="1"}var l=this.getElementValue("wumaps","checkbox",false);if(l){v.newmaps="1"}var h=this.getElementsValue("merge","radiogroup","");if(h=="0"){v.merge="elev"}if(h=="1"){v.merge="dBZ"}if(n.CORS===true){v.cors="1"}var d=this.getElementValue("extra","input","");if(wundermap.RadSatSync.isSynced()){var e=wundermap.layers.Satellite;var c=a.extend({},n,{returnParams:true});var m=e.getURL.call(e,k,g,s,q,p,o,c);var f=this.getURLRadSatSync(v,m);if(d){f+=d}return f}var u=this.getElementValue("subdomain","input",this.options_.subdomain);if(!u){u=this.options_.subdomain}var f="http://"+u+".wunderground.com/cgi-bin/radar/WUNIDS_composite?"+a.param(v);if(d){f+=d}return f};wundermap.layers.Radar.getURLRadSatSync=function(c,e){var g={interval:30,num:this.getNumFrames("animate","frames"),delay:this.getElementValue("delay","select","25")};for(var f in c){g["rad."+f]=c[f]}for(var f in e){g["sat."+f]=e[f]}var d="http://www.wunderground.com/cgi-bin/RadSatSync?"+a.param(g);return d};wundermap.layers.Radar.getURLFuture=function(h,l,f,k,e,m,c){var g={maxlat:h,maxlon:l,minlat:f,minlon:k,width:e,height:m,format:"png",field:"radar",epoch:wundermap.date.getTime()/1000};var d="http://modelmaps.wunderground.com/cgi-bin/get_grib";d+="?"+a.param(g);return d};wundermap.layers.Radar.getURLArchive=function(m,o,l,n,h,p,d){if(!wundermap.date){return null}var c=wui.date.strftime("%Y/%m/%d",wundermap.date,true);var f=wui.date.strftime("%Y%m%d%H",wundermap.date,true);if(this.options_.step=="6min"){var g=new Date();if(wundermap.date.getTime()<g.getTime()&&g-wundermap.date<=4*3600*1000){var k=wui.date.strftime("%M",wundermap.date,true);k=Math.round(k/6)*6;f+=wui.date.pad(k)}}var e="http://timelord.wunderground.com/timelord/nids/N0R/5120x2880/"+c+"/CONUS_5120x2880_"+f+".gif";return e};wundermap.layers.Radar.getTileUrl=function(k,g,f){if(f&&f.date){var h=f.date}else{var h=wundermap.date}var c=this.getTimePeriod(h);if(c===1){var e=this.getTileUrlFuture(k,g,f)}else{if(c===-1){var e=null}else{if(c===-0.5){var e=this.getTileUrlArchive(k,g,f)}else{var e=this.getTileUrlPresent(k,g,f)}}}return e};wundermap.layers.Radar.getTileUrlPresent=function(k,g,f){var e=1<<g;var c=((k.x%e)+e)%e;var h=k.y;if(c<0||h<0){return null}else{var d="http://radartiles-ak.wxug.com/tiles/"+g+"/"+c+"/"+h+".png";return d}};wundermap.layers.Radar.getTileUrlArchive=function(h,o,c){var n=1<<o;var m=((h.x%n)+n)%n;var l=h.y;if(m<0||l<0){return null}else{if(c&&c.date){var k=c.date}else{var k=new Date(wundermap.date.getTime())}var f=k.getUTCMinutes();f=6*Math.round(f/6);k.setUTCMinutes(f);var g=wui.date.strftime("%Y/%m/%d/%H/%M",k,true);var e="http://radartiles-ak.wxug.com/radartilearchive/"+g+"/"+o+"/"+m+"/"+l+".png";return e}};wundermap.layers.Radar.getTileUrlFuture=function(h,o,c){var n=1<<o;var m=((h.x%n)+n)%n;var l=h.y;if(m<0||l<0){return null}else{if(c&&c.date){var k=c.date}else{var k=new Date(wundermap.date.getTime())}var f=k.getUTCMinutes();f=15*Math.round(f/15);k.setUTCMinutes(f);var g=wui.date.strftime("%Y%m%d%H%M",k,true);var e="http://radartiles-ak.wxug.com/radar_ff/"+g+"/"+o+"/"+m+"/"+l+".png";return e}};wundermap.layers.Radar.getURLStorms=function(l,n,h,m,f,q,c){var p=this.findId("legend_stm");var o=this.getStormTracks();if(!o){p.addClass("none");return""}else{p.removeClass("none")}if(m>n){m-=360}var d="/cgi-bin/wundermap_storm_bins?maxlat="+l+"&maxlon="+n+"&minlat="+h+"&minlon="+m;var e=new Date();var g=e.getTime();var k=Math.floor(g/60000);d+="&rand="+k;return d};wundermap.layers.Radar.getURLStormsData=function(c,d){};wundermap.layers.Radar.getStormTracks=function(){try{return this.getElementValue("stormtracks","checkbox",this.options_.stormtracks)}catch(c){return false}};wundermap.layers.Radar.getBalloonContentStormTracks=function(c,p,l,g,m){var k=this.lookupStormType(l);var h='<div class="stormBalloon">';h+='<div class="infobox-title">Radar Detected Storms</div>';h+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr><td class="full">Location: <span>'+g.CITY+", "+g.STATE+'</span></td><td class="vaT nobr dtr">Lat: <span>'+parseFloat(g.slat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(g.slon).toFixed(2)+"</span></td></tr></table>";h+='<div class="grt p10">';h+='<table cellspacing="0" cellpadding="0" class="cleanTable full"><tr><td class="vaT nobr">Type:</td><td class="full"><span class="b">'+k+"</span> ("+g.ID+')</div><tr><td class="vaT nobr">Max Reflectivity:</td><td><span class="b">'+g.DBZM+'</span> dBZ</td></tr><tr><td class="vaT nobr">Severe Hail:</td><td><span class="b">'+g.POSH+'</span>% Chance </td></tr><tr><td class="vaT nobr">Hail:</td><td><span class="b">'+g.POH+'</span>% Chance</td></tr><tr><td class="vaT nobr">Max Hail Size:</td><td><span class="b">'+g.MXSIZE+'</span> in.</td></tr><tr><td class="vaT nobr">Echo Top:</td><td><span class="b">'+g.TOP.feet+'</span> ft.</td></tr><tr><td class="vaT nobr">Vert. Integrated Liquid:</td><td><span class="b">'+g.VIL+"</span> kg/m&sup2;</td></tr>";if(g.FCTSPD=="new"){var e="N/A</span>";var o="New Cell</span>"}else{var n=parseFloat(g.FCTSPD);var d=n*1.1507794;var f=d.toFixed(0)+"</span> mph ("+g.FCTSPD+" knots)";var o=g.FCTDIR.lang+"</span> ("+g.FCTDIR_VALUE+")"}h+='<tr><td class="vaT nobr">Speed:</td><td><span class="b">'+f+'</td></tr><tr><td class="vaT nobr">Direction (from):</td><td><span class="b">'+o+'</td></tr><tr><td class="vaT nobr">Radar Site:</td><td><span class="b">'+g.RADAR+"</span></td></tr></table>";h+="</div>";h+="</div>";return h};wundermap.layers.Radar.getDisplayAreaBox=function(d,l,h,g,e,k){var f="";if(k){var m=this.lookupStormIconPath(h);var c=wundermap.options.iconsdomain+m+k;f+='<img src="'+c+'" alt="'+g+'" title="'+g+'" align="left" />'}f+=d;if(l){f+=" ("+l+")"}return f};wundermap.layers.Radar.getTableRowContent=function(g,c){var l=a("<tr></tr>");var f=a("<td></td>").appendTo(l);var e=f.clone().appendTo(l);var d=g.marker.get("name");var o=g.marker.get("location");var m=g.marker.get("type");var n=g.marker.get("iconName");var k=this.lookupStormType(m);var h=d;if(o){h+=" &ndash; "+o}var p=this.lookupStormIconPath(m);f.html('<img src="'+wundermap.options.iconsdomain+p+n+'" alt="" /></a>');e.html(h);return l};wundermap.layers.Radar.drawData=function(v){var x=this;var p=this.markerLayerStormTracks;var l=true;if(this.map_.getZoom()<7){l=false}if(this.debug_==1){wui.log("Radar.drawData")}if(v){this.markerlayers_[0].data_=v}var J=this.markerlayers_[p].data_.STORMS;this.markerlayers_[p].removeOverlays();var B=[];var f=0;var o=0;for(var D in J){var d=J[D];var K=D;var q=parseFloat(d.slat);var h=parseFloat(d.slon);var A=new google.maps.LatLng(q,h);o++;if(f>=100){continue}f++;var c="near "+d.CITY+", ";if(d.COUNTY=="NONE"){c+=d.COUNTRY}else{c+=d.STATE+", "+d.COUNTRY;c+="<br /> ("+d.COUNTY+" County)"}var g="";if(d.TVS=="TVS"||d.TVS=="ETVS"){g="TVS"}else{if(d.MESO=="MESO"||d.MESO=="EMESO"){g="MESO"}else{if(d.MESO=="3DCO"){g="3DCO"}else{if(d.MESO=="UNCO"){g="UNCO"}else{if(d.POH&&b(d.POH)>=70){g="HAIL"}else{g=""}}}}}var F=this.lookupStormIconSize(g);var G=this.lookupStormIconPath(g);var n=this.lookupStormIcon(g);var z=this.lookupStormType(g);var E=this.markerlayers_[p].makeIcon({iconname:n,path:G,width:F[0],height:F[1]});var t=new google.maps.Marker({map:this.map_,position:A,icon:E,title:z});t.set("name",K);t.set("location",c);t.set("type",g);t.set("storm",d);t.set("iconName",n);var I=google.maps.event.addListener(t,"click",function(M){var L=x.getBalloonContentStormTracks(this.get("name"),this.get("location"),this.get("type"),this.get("storm"),this.get("iconName"));wundermap.openInfoBox({content:L,marker:this})});this.markerlayers_[p].addMarker(t);if(l){var C=0;var e=0;var u=d.FCTSPD;if(u!="new"){C=parseFloat(u);e=parseFloat(d.FCTDIR_VALUE);var m=270-e}var k=C*1.1507794;var H=k*(20/60);var s=k*(40/60);var r=k*(60/60);var w=this.options_.stormtracks_opts;var y;y=this.drawArcMiles(A,H,m-20,m+20,w.strokeColor,w.strokeWeight,w.strokeOpacity,w.fillColor,w.fillOpacity,{wedge:true});this.markerlayers_[p].addMarker(y);y=this.drawArcMiles(A,s,m-20,m+20,w.strokeColor,w.strokeWeight,w.strokeOpacity,w.fillColor,w.fillOpacity,{wedge:true});this.markerlayers_[p].addMarker(y);y=this.drawArcMiles(A,r,m-20,m+20,w.strokeColor,w.strokeWeight,w.strokeOpacity,w.fillColor,w.fillOpacity,{wedge:true});this.markerlayers_[p].addMarker(y)}if(this.options_.displayAreaTab){d.marker=t;B.push(d)}}if(this.options_.displayAreaTab){this.displayDataTable(B,22,{})}if(f<o){if(wundermap.debug>0){wui.log("Too many storms to display at once. Showing "+f+" of "+o+" in this area.")}}if(this.debug_==1){wui.log("Radar.drawData::numStorms = "+f)}return true;return false};wundermap.layers.Radar.drawArc=function(u,c,v,x,h,n,t,e,g,q,m){var r=[];var m=m||{};var l=m.degStep||6;var p=m.wedge||false;if(p){r.push(u)}for(var s=x;s<=h;s+=l){var k=wundermap.utils.deg2rad(s);var d=c*Math.sin(k);var w=v*Math.cos(k);var o=new google.maps.LatLng(u.lat()+d,u.lng()+w,true);r.push(o)}if(p){r.push(u)}var f;if(p){f=new google.maps.Polygon({map:this.map_,paths:r,strokeColor:n,strokeWeight:t,strokeOpacity:e,fillColor:g,fillOpacity:q})}else{f=new google.maps.Polyline({map:this.map_,paths:r,strokeColor:n,strokeWeight:t,strokeOpacity:e})}return f};wundermap.layers.Radar.drawArcMiles=function(d,l,g,h,s,k,n,e,p,c){var o=3963.19;var m=180/(o*Math.PI);var r=m/Math.cos(wundermap.utils.deg2rad(d.lat()));var q=l*m;var f=l*r;return this.drawArc(d,q,f,g,h,s,k,n,e,p,c)};wundermap.layers.Radar.drawArcKM=function(d,l,g,h,s,k,n,e,p,c){var o=6378.137;var m=180/(o*Math.PI);var r=m/Math.cos(wundermap.utils.deg2rad(d.lat()));var q=l*m;var f=l*r;return this.drawArc(d,q,f,g,h,s,k,n,e,p,c)};wundermap.layers.Radar.lookupStormType=function(c){if(c=="TVS"){return"Tornadic Thunderstorm"}else{if(c=="MESO"||c=="3DCO"||c=="UNCO"){return"Rotating Thunderstorm"}else{if(c=="HAIL"){return"Hail Storm"}else{return"Thunderstorm"}}}};wundermap.layers.Radar.lookupStormIconPath=function(c){return"/i/wm/"};wundermap.layers.Radar.lookupStormIcon=function(c){if(c=="TVS"){return"stormTracks_TornadoVortex.png"}else{if(c=="MESO"||c=="3DCO"||c=="UNCO"){return"stormTracks_Mesocyclone.png"}else{if(c=="HAIL"){return"stormTracks_Hail.png"}else{return"stormTracks_Storm.png"}}}};wundermap.layers.Radar.lookupStormIconSize=function(c){return[30,30]};wundermap.layers.Radar.refresh=function(c){wundermap.layers.ModelData.checkRequestConfig();wundermap.Layer.prototype.refresh.call(this,c);this.removeDataTables()};wundermap.layers.Radar.getPrefs=function(){return{num:this.getNumFrames("animate","frames"),spd:this.getElementValue("delay","select",this.options_.animation.delay),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity),type:this.getElementValue("type","select",this.options_.type),type2:this.getElementValue("type2","select",this.options_.type2),smo:(this.getElementValue("smooth","checkbox",this.options_.smooth))?"1":"0",stm:(this.getElementValue("stormtracks","checkbox",this.options_.stormtracks))?"1":"0"}};wundermap.layers.Satellite=new wundermap.Layer();wundermap.layers.Satellite.className="Satellite";wundermap.layers.Satellite.initialize=function(f,c){var e={name:"sat",sidebarPrefix:"LayerSatellite",source:"cpc",type:"IR4",opacity:70,gtt1:108,gtt2:108,animation:{num:1,max:8,delay:100},timelord:{showTooltip:true,text:"Historical data from Feb 2000, then current data, then 7 days of forecast into the future",min:new Date(Date.UTC(2000,2-1,8)),max:wundermap.utils.createDateFunction(6,"day")}};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);var h=this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.addImageLayer({disabled:true,fn_getURL:a.proxy(this.getURLFuture,this)});this.addTileLayer("satir",{zIndex:9});var d=[0,1];var g=d.length;this.addOpacityListener(d,[0]);this.addElementListener("delay","change");this.addAnimateListener("animate","frames",{min:1,max:this.options_.animation.max,value:this.options_.animation.num});this.addElementsListeners("type","click");this.setElementsValue("type","radiogroup",this.options_.type);this.addElementsListeners("source","click");this.setElementsValue("source","radiogroup",this.options_.source);this.addSliderListener("gtt",{min:0,max:255,value:this.options_.gtt1});this.addElementListener("png","click");if(this.initialize_dev){this.initialize_dev()}};wundermap.layers.Satellite.custom_check_dates=function(g){var f=new Date();var e=new Date(f.getTime()-3600*1000);var c=new Date(f.getTime()+3600*1000);if(g&&g>c){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(false);this.tilelayers_[0].removeTiles()}else{if(g&&g<e){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);if(this.active_){this.tilelayers_[0].swapTiles()}else{this.tilelayers_[0].removeTiles()}}else{this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.tilelayers_[0].removeTiles()}}this.check_timelord_aware()};wundermap.layers.Satellite.check_timelord_aware=function(){var c=!this.imagelayers_[0].getDisabled();var d=this.elt_options.find("."+wundermap.classNames.timelordAware);if(c){d.removeClass(wundermap.classNames.timelordWarning);d.find("input, select, textarea").attr("disabled",false);d.find(".slider_bg").slider("enable")}else{d.addClass(wundermap.classNames.timelordWarning);d.find("input, select, textarea").attr("disabled",true);d.find(".slider_bg").slider("disable")}};wundermap.layers.Satellite.getURL=function(h,l,f,k,e,m,c){var g={maxlat:h,maxlon:l,minlat:f,minlon:k,width:e,height:m,gtt:this.getElementValue("gtt_slider","slider",this.options_.gtt1),frame:"0",num:this.getNumFrames("animate","frames"),delay:this.getElementValue("delay","select","25"),key:"sat_"+this.getElementsValue("type","radiogroup",this.options_.type).toLowerCase(),proj:"me",rand:Math.floor((new Date()).getTime()/60000)};if(b(g.num)==1&&this.getElementValue("png","checkbox",false)){g.extension="png";g.gtt="0"}if(c.returnParams){return g}else{if(wundermap.RadSatSync.isSynced()){return null}}var d="http://wublast.wunderground.com/cgi-bin/WUBLAST";d+="?"+a.param(g);return d};wundermap.layers.Satellite.getURLFuture=function(g,f,t,p,o,m,l){var w=wundermap.layers.ModelData.config;var c=w.MODEL.ECMWF.modelrun;var x=null;for(var q in c){if(!x){x=c[q]}else{if(c[q].initialization.epoch>x.initialization.epoch){x=c[q]}}}var d=x.period;var r=null;var s=null;var h=0;var n=0;for(var q in d){if(!d[q].exists=="1"){continue}var k=Math.abs(b(d[q].valid)*1000-wundermap.date.getTime());if(!r||k<h){r=d[q];h=k}var v=d[q].valid;if(!s||v>n){s=d[q];n=v}}var u={maxlat:g,maxlon:f,minlat:t,minlon:p,width:o,height:m,model:"ECMWF",script:"totalcloud",modelrun:x.initialization.readable,hour:r.hour};if(wundermap.options.datepicker&&s){this.options_.timelord.max=new Date(s.valid*1000);this.timelord_check_dates(wundermap.date)}var e="http://modelmaps.wunderground.com/php/run.php";e+="?"+a.param(u);return e};wundermap.layers.Satellite.refresh=function(c){wundermap.layers.ModelData.checkRequestConfig();wundermap.Layer.prototype.refresh.call(this,c)};wundermap.layers.Satellite.getPrefs=function(){return{num:this.getNumFrames("animate","frames"),spd:this.getElementValue("delay","select",this.options_.animation.delay),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity),gtt1:this.getElementValue("gtt_slider","slider",this.options_.gtt1),gtt2:this.getElementValue("gtt_slider","slider",this.options_.gtt2),type:this.getElementsValue("type","radiogroup",this.options_.type),src:this.getElementsValue("source","radiogroup",null)}};wundermap.layers.StormReports=new wundermap.Layer();wundermap.layers.StormReports.className="StormReports";wundermap.layers.StormReports.initialize=function(e,c){var d={title:"U.S. Storm Reports",name:"stormreports",sidebarPrefix:"LayerStormReports",timelord:{showTooltip:true,text:"daily from June 1999 to present",min:new Date(Date.UTC(1999,6-1,1))},tor:1,hail:1,wind:1};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="stormreports";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.addElementsListeners("type","click");this.setElementValue("type_tor","checkbox",this.options_.tor);this.setElementValue("type_hail","checkbox",this.options_.hail);this.setElementValue("type_wind","checkbox",this.options_.wind)};wundermap.layers.StormReports.getURL=function(l,q,h,o,e,r,c){var p=new Date(wundermap.date.getTime()-3600);var g=new Date(wundermap.date.getTime()+3600);var f=wui.date.strftime("%Y-%m-%d %H:00:00,",p,true);var m=wui.date.strftime("%Y-%m-%d %H:59:59",g,true);var f=wui.date.strftime("%Y-%m-%d 00:00:00,",wundermap.userdate,true);var m=wui.date.strftime("%Y-%m-%d 23:59:59",wundermap.userdate,true);var k={minlat:h,minlon:o,maxlat:l,maxlon:q,width:e,height:r,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.DateTime.btw":f+m};this.findId("title").html(wui.date.strftime("%a, %d %b, %Y,",wundermap.userdate,true)+" 00:00 &ndash; 23:59 "+wundermap.options.timezone["short"]);var n=this.getElementsValue("type","checkboxgroup",null);if(n!=null){k["filter.Type.any"]=n}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(k);return d};wundermap.layers.StormReports.getMarkerTitle=function(c){return c.Type+": "+c.DateTime};wundermap.layers.StormReports.getBalloonContent=function(f){var e=f.Type;var d='<div class="StormReportsBalloon">';d+='<div class="infobox-title">Storm Report</div>';d+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';d+='<td class="full">Location: <span>'+f.Location+"</span></td>";d+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(f.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(f.lon).toFixed(2)+"</span></td></tr></table>";d+='<div class="grt p10">';d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';d+='<tr><td class="nobr">Type:</td><td class="full"><span class="b cap">'+e+"</span></td>";if(e=="hail"){if(f.Size=="UNK"){var c="Unknown"}else{var c=(b(f.Size)/100).toFixed(2)}if(c=="Unknown"){d+='<tr><td>Size:</td><td class="full"><span class="b">'+c+"</span></td></tr>"}else{d+='<tr><td>Size:</td><td class="full"><span class="b">'+c+"</span> in.</td></tr>"}}else{if(e=="wind"){var c=(f.Size=="UNK")?"Unknown":f.Size;if(c=="Unknown"){d+='<tr><td>Gusts:</td><td class="full"><span class="b">'+c+"</span></td></tr>"}else{d+='<tr><td>Gusts:</td><td class="full"><span class="b">'+c+"</span> mph</td></tr>"}}}if(f.State=="LA"){d+='<tr><td>Parish:</td><td class="full"><span class="b">'+f.County+"</span></td>"}else{d+='<tr><td>County:</td><td class="full"><span class="b">'+f.County+"</span></td>"}d+='<tr><td>State:</td><td class="full"><span class="b">'+f.State+"</span></td></tr>";d+='<tr><td colspan="2"><span>'+f.Comments+"</span></td></tr>";d+="</table>";d+="</div>";d+='<div class="contentFooterPad taC brBot5">Reported on: <span>'+f.DateTime+"</span> ET</div>";d+="</div>";return d};wundermap.layers.StormReports.getPrefs=function(c){return{"type.tor":this.getElementValue("type_tor","checkbox",this.options_.tor)?"1":"0","type.hail":this.getElementValue("type_hail","checkbox",this.options_.hail)?"1":"0","type.wind":this.getElementValue("type_wind","checkbox",this.options_.wind)?"1":"0"}};wundermap.layers.Severe=new wundermap.Layer();wundermap.layers.Severe.className="Severe";wundermap.layers.Severe.initialize=function(e,c){var d={name:"svr",theme:"severe_v3",sidebarPrefix:"LayerSevere",opacity:70,refreshTimeout:150};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_customClickResponse:a.proxy(this.customClickResponse,this),fn_getClickURL:a.proxy(this.getClickURL,this)});this.addOpacityListener();this.addElementsListeners("theme","click");this.setElementsValue("theme","radiogroup",this.options_.theme)};wundermap.layers.Severe.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:this.options_.theme,proj:"automerc",format:"gif",alpha:"1",stdout:"1",rand:Math.floor((new Date()).getTime()/60000)};var d="http://wumaps.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.Severe.getClickURL=function(c){var e={profile:"wmapv3_severe",lat:c.lat(),lon:c.lng()};var d="/cgi-bin/shapeclick";d+="?"+a.param(e);return d};wundermap.layers.Severe.customClickResponse=function(k,c){var h=k.Region;var l=k.ID;var d=l.substr(0,2);var g=l.substr(2);var f;if(h=="US"){f="/US/"+d+"/"+g+".html?view=USAlertTextBubble"}else{if(h=="CANADA"){f="/severe/canada/"+l+".html?view=USAlertTextBubble"}else{f="/EU/"+d+"/"+g+".html?view=EUAlertTextBubble"}}var e=this;a.ajax({url:f,success:function(o,n){var m=wundermap.openInfoBox({content:o,position:c,styles:{height:"200px"}});google.maps.event.addListenerOnce(m,"domready",function(){a("#infobox-tabs").tabs();m.setOptions({boxStyle:{}})})},error:function(o,m,n){if(wundermap.debug>0){wui.log(m)}}})};wundermap.layers.Severe.getPrefs=function(){return{opa:this.getElementValue("opacity_slider","slider",null)}};wundermap.layers.WunderPhotos=new wundermap.Layer();wundermap.layers.WunderPhotos.className="WunderPhotos";wundermap.layers.WunderPhotos.initialize=function(e,c){var d={name:"pix",sidebarPrefix:"LayerPhotos",timelord:{text:"from August 2002 to present",showTooltip:true,min:new Date(Date.UTC(2002,8-1,12))},category:"",handle:"",anyDay:0,anyDate:0};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.key_="wunderphotos";this.addElementListener("anyDay","click");this.setElementValue("anyDay","checkbox",this.options_.anyDay);this.addElementListener("anyDate","click");this.setElementValue("anyDate","checkbox",this.options_.anyDate);this.addElementListener("cat","change");this.setElementValue("cat","select",this.options_.category);this.setElementValue("handle","input",this.options_.handle)};wundermap.layers.WunderPhotos.getURL=function(l,r,h,q,f,s,c){var k={minlat:h,minlon:q,maxlat:l,maxlon:r,width:f,height:s,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var n=this.getElementValue("anyDay","checkbox",this.options_.anyDay);var m=this.getElementValue("anyDate","checkbox",this.options_.anyDate);if(n){var t=new Date(wundermap.userdate.getTime());t.setUTCMonth(t.getUTCMonth()+1);t.setUTCDate(0);var g=wui.date.strftime("%Y-%m-01 00:00:00",wundermap.userdate,true);var o=wui.date.strftime("%Y-%m-%d 23:59:59",t,true);k["filter.dateimage.btw"]=g+","+o}else{if(!m){k["filter.dateimage.btw"]=wui.date.strftime("%Y-%m-%d 00:00:00,%Y-%m-%d 23:59:59",wundermap.userdate,true)}else{}}var p=this.getElementValue("handle","input",this.options_.handle);if(p){k["filter.handle"]=p}var e=this.getElementValue("cat","input",this.options_.category);if(e){k["filter.category.like"]=e}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(k);return d};wundermap.layers.WunderPhotos.getDetailsURL=function(f,d){var e=f.split("-");var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.handle="+e[0]+"&id.number="+e[1];c+="&tzname="+wundermap.options.timezone["long"];return c};wundermap.layers.WunderPhotos.getBalloonContent=function(f){var c='<div class="WunderPhotosArchiveBalloon">';c+='<div class="infobox-title">WunderPhoto</div>';c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(f.city){c+='<td class="full">Location: <span>'+f.city+", "+f.state+"</span></td>"}else{c+='<td class="full">Location: <span>N/A</span></td>'}c+='<td class="nobr dtr">Lat: <span>'+parseFloat(f.lat).toFixed(2)+'</span></td><td class="nobr">Lon: <span>'+parseFloat(f.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt taC p10"><a href="/wximage/'+f.handle+"/"+f.number+'/" target="new"><img src="http://icons.wxug.com/data/wximagenew/'+f.thumb250+'" class="w250" /></a></div>';c+='<div class="borderTop p10"><a href="/wximage/'+f.handle+"/"+f.number+'/" class="b med newWin" target="new">'+f.name+"</a>";if(f.caption){c+="<div>"+f.caption+"</div>"}else{+"<div>No caption given.</div>"}c+='<div class="dataSource">Uploaded by <span class="b">'+f.handle+"</span></div></div>";if(true){var g=new Date(f.epoch*1000);var h=wundermap.timelord.getDateInUserTime(g);var e=wui.date.strftime("%a, %d %b %Y ",h,true)+wundermap.options.timezone["short"]}c+='<div class="contentFooterPad taC brBot5">Taken on: <span>'+e+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+f.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.WunderPhotos.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var d=document.getElementById(this.sidebarPrefix_+"_handle");var e=document.getElementById(this.sidebarPrefix_+"_handle_go");if(d&&e){var f=google.maps.event.addDomListener(e,"click",function(){google.maps.event.trigger(c,"settings_changed");c.refresh({eventname:"settings_changed"})});this.listeners_.push(f);var f=google.maps.event.addDomListener(d,"focus",function(){a(e).removeClass("none")});this.listeners_.push(f);var f=google.maps.event.addDomListener(d,"blur",function(){google.maps.event.trigger(e,"click");a(e).addClass("none")});this.listeners_.push(f)}};wundermap.layers.WunderPhotos.getMarkerTitle=function(c){return c.title||"untitled"};wundermap.layers.WunderPhotos.getTableRowContent=function(g){var f=a("<tr></tr>");var e=a("<td></td>").appendTo(f);var d=e.clone().appendTo(f);var c=this.getImagemapAreasHref(g,0,false);e.html('<a href="'+c+'"><img src="'+wundermap.options.iconsdomain+"/data/wximagenew/"+g.thumb+'" alt="" style="width:40px;height:30px;" /></a>');d.html('<a href="'+c+'" class="b">'+g.title+'</a><br /><span class="grey">By '+g.handle+" on "+g.dateimage+"</span>");return f};wundermap.layers.WunderPhotos.getPrefs=function(c){var d={anyd:this.getElementValue("anyDay","checkbox",this.options_.anyDay)?"1":"0",anyt:this.getElementValue("anyDate","checkbox",this.options_.anyDate)?"1":"0",usr:this.getElementValue("handle","input",this.options_.handle),cat:this.getElementValue("cat","input",this.options_.category)};return d};wundermap.layers.Webcams=new wundermap.Layer();wundermap.layers.Webcams.className="Webcams";wundermap.layers.Webcams.initialize=function(e,c){var d={name:"cams",sidebarPrefix:"LayerWebcams",timelord:{text:"from May 2007 to present",showTooltip:true,min:new Date(Date.UTC(2007,5-1,7))},refreshTimeout:150};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.key_="webcams"};wundermap.layers.Webcams.getURL=function(k,q,f,o,e,r,c){var h={minlat:f,minlon:o,maxlat:k,maxlon:q,width:e,height:r,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};if(!wundermap.date||(new Date()).getTime()-wundermap.date.getTime()<3600*1000){this.key_="webcams"}else{this.key_="webcamsarchive";var n=wui.date.strftime("%Y",wundermap.date,true);var l=wui.date.strftime("%m",wundermap.date,true);var p=wui.date.strftime("%d",wundermap.date,true);var g=wui.date.strftime("%H",wundermap.date,true);if(l.charAt(0)=="0"){l=l.substr(1)}if(p.charAt(0)=="0"){p=p.substr(1)}if(g.charAt(0)=="0"){g=g.substr(1)}var m=n+"_"+l+"_"+p+"_"+g;h.key=this.key_;h.year=n;h.date=m}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(h);return d};wundermap.layers.Webcams.getDetailsURL=function(d,m){var e={key:this.key_,id:d,tzname:wundermap.options.timezone["long"]};if(this.key_=="webcamsarchive"){var k=wui.date.strftime("%Y",wundermap.date,true);var g=wui.date.strftime("%m",wundermap.date,true);var l=wui.date.strftime("%d",wundermap.date,true);var f=wui.date.strftime("%H",wundermap.date,true);if(g.charAt(0)=="0"){g=g.substr(1)}if(l.charAt(0)=="0"){l=l.substr(1)}if(f.charAt(0)=="0"){f=f.substr(1)}var h=k+"_"+g+"_"+l+"_"+f;e.year=k;e.date=h}var c="/cgi-bin/ICONBLAST?"+a.param(e);return c};wundermap.layers.Webcams.getBalloonContent=function(f){var c='<div class="WebcamsArchiveBalloon">';c+='<div class="infobox-title">Webcam</div>';c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(f.city){c+='<td class="full">Location: <span>'+f.city+", "+f.state+"</span></td>"}else{c+='<td class="full">Location: <span>N/A</span></td>'}c+='<td class="nobr dtr">Lat: <span>'+parseFloat(f.lat).toFixed(2)+'</span></td><td class="nobr">Lon: <span>'+parseFloat(f.lon).toFixed(2)+"</span></td></tr></table>";c+='<table cellspacing="0" cellpadding="0" class="full grt"><tr>';c+='<td class="vaT p10"><a href="/webcams/'+f.handle+"/"+f.camindex+'/show.html" target="new"><img src="http://icons.wunderground.com'+f.image+'" class="w250" /></a></td>';c+='<td class="vaT p10 full">';c+='<div class="titleSubtleBG br3">Links</div>';c+='<div id="infoCamCal"><a href="/webcams/'+f.handle+"/"+f.camindex+'/show.html#cal" target="new">Date Lookup</a></div>';c+='<div id="infoCamVid"><a href="/webcams/'+f.handle+"/"+f.camindex+'/video.html?filename=current.mp4" target="new">Video Loop</a></div>';c+='<div id="infoCamNow"><a href="/webcams/'+f.handle+"/"+f.camindex+'/show.html" target="new">Current Image</a></div>';if(f.pwsid&&f.pwsid!="NODATA"){c+='<div id="infoCamPws"><a href="/weatherstation/WXDailyHistory.asp?ID='+f.pwsid+'" target="new">Weather Station</a></div>'}c+="</td></tr></table>";if(true){var g=new Date(f.epoch*1000);var h=wundermap.timelord.getDateInUserTime(g);var e=wui.date.strftime("%a, %d %b %Y, %H:%M ",h,true)+wundermap.options.timezone["short"]}c+='<div class="contentFooterPad taC brBot5">Last updated: <span>'+e+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+f.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.Tornado=new wundermap.Layer();wundermap.layers.Tornado.className="Tornado";wundermap.layers.Tornado.initialize=function(e,c){var d={name:"tor",sidebarPrefix:"LayerTornado",timelord:{text:"historical tornadoes from 1950, and storm reports from the past two years",showTooltip:true,min:new Date(Date.UTC(1950,0,1))},show:"now"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.key_="tornado";this.addElementsListeners("show","click");this.setElementsValue("show","radiogroup",this.options_.show)};wundermap.layers.Tornado.getURL=function(m,r,k,p,f,t,c){var l={minlat:k,minlon:p,maxlat:m,maxlon:r,width:f,height:t,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,rand:Math.floor((new Date()).getTime()/60000)};var s=this.getElementsValue("show","radiogroup",this.options_.show);if(s=="cur"){}else{if(s=="sig"){l["filter.Significant"]=1}else{var o=(wundermap.userdate)?wundermap.userdate:new Date();var q=new Date(o.getTime()-3600);var h=new Date(o.getTime()+3600);var g=wui.date.strftime("%Y-%m-%d 00:00:00",q,true);var n=wui.date.strftime("%Y-%m-%d 23:59:59",h,true);l["filter.DateTime.btw"]=g+","+n}}var e="/cgi-bin/ICONBLAST";e+="?"+a.param(l);return e};wundermap.layers.Tornado.getDetailsURL=function(g,e){var f=g.split("-");var d=wui.date.strftime("%Y_%m_%d",wundermap.date,true);var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.sid="+f[1]+"&id.tid="+f[0]+"&date="+d;return c};wundermap.layers.Tornado.getMarkerTitle=function(c){return c.DateTime};wundermap.layers.Tornado.getPrefs=function(){return{show:this.getElementsValue("show","radiogroup",this.options_.show)}};wundermap.layers.Tornado.getTableRowContent=function(f){var e=a("<tr></tr>");var d=a("<td></td>").appendTo(e);var c=this.getImagemapAreasHref(f,0,false);var g="Tornado";if(b(f.FScale)>0){g="F"+f.FScale+" Tornado"}if(f.sCounty){g+=" ("+f.sCounty+")"}d.html('<a href="'+c+'">'+g+"</a><br />"+f.DateTime+" EST");return e};wundermap.layers.Tornado.getBalloonContent=function(k){var d='<div class="TornadoBalloon">';if(k.tid>0){d+='<div class="infobox-title">Tornado</div>'}else{d+='<div class="infobox-title">Storm Report</div>'}d+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(k.Title){d+='<td class="full">Location: <span>'+k.Title+"</span></td>"}else{d+='<td class="full">Location: <span>'+k.sLocation+", "+k.sState+"</span></td>"}d+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(k.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(k.lon).toFixed(2)+"</span></td></tr></table>";d+='<div class="grt p10">';d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(k.tid>0){var f="Unknown";if(k.DateTime>"2006"){f="$"+k.Damage+" million"}else{var g=b(k.Damage);if(g==1){f="less than $50"}else{if(g==2){f="$50 to $500"}else{if(g==3){f="$500 to $5,000"}else{if(g==4){f="$5,000 to $50,000"}else{if(g==5){f="$50,000 to $500,000"}else{if(g==6){f="$500,000 to $5 million"}else{if(g==7){f="$5 million to $50 million"}else{if(g==8){f="$50 million to $500 million"}else{if(g==9){f="More than $500 million"}}}}}}}}}}var e=parseFloat(k.Length)/10;var h=parseFloat(k.Area).toFixed(2);var c=parseFloat(k.Width)*10;if(c>1320){c=(c/5280).toFixed(2)+" mi."}else{c+=" ft."}if(k.FScale=="UNK"){d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">Unknown</span></td></tr>'}else{d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">F'+k.FScale+" Tornado</span></td></tr>"}d+='<tr><td class="vaT nobr">Fatalities:</td><td class="full"><span class="b">'+k.Fatalities+"</span></td></tr>";d+='<tr><td class="vaT nobr">Injuries:</td><td class="full"><span class="b">'+k.Injuries+"</span></td></tr>";d+='<tr><td class="vaT nobr">Damage:</td><td class="full"><span class="b">'+f+"</span></td></tr>";d+='<tr><td class="vaT nobr">Path Length:</td><td class="full"><span class="b">'+e+" mi.</span></td></tr>";d+='<tr><td class="vaT nobr">Path Area:</td><td class="full"><span class="b">'+h+"</span></td></tr>";d+='<tr><td class="vaT nobr">Path Width:</td><td class="full"><span class="b">'+c+"</span></td></tr>"}if(k.sid>0){d+='<tr><td class="vaT nobr">Type:</td><td class="full"><span class="b cap">'+k.sType+"</span></td></tr>";if(k.sSize=="UNK"){d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">Unknown</span></td></tr>'}else{d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">'+k.sSize+"</span></td></tr>"}if(k.sState=="LA"){d+='<tr><td class="vaT nobr">Parish:</td><td class="full"><span class="b">'+k.sCounty+"</span></td></tr>"}else{d+='<tr><td class="vaT nobr">County:</td><td class="full"><span class="b">'+k.sCounty+"</span></td></tr>"}d+='<tr><td colspan="2">'+k.sComments+"</td></tr>"}d+="</table>";d+="</div>";d+='<div class="contentFooterPad taC brBot5">Reported on: <span>'+k.DateTime+'</span> (<a href="javascript:void(0);" onclick="wundermap.layers.Tornado.setTimelord('+k.epoch+')">Sync Layers to this Date</a>)</div>';d+="</div>";return d};wundermap.layers.Tornado.setTimelord=function(c){this.setElementsValue("show","radiogroup","now");wundermap.Layer.prototype.setTimelord.call(this,c)};wundermap.layers.USGSRiver=new wundermap.Layer();wundermap.layers.USGSRiver.className="USGSRiver";wundermap.layers.USGSRiver.initialize=function(e,c){var d={title:"USGS River",name:"riv",sidebarPrefix:"LayerUSGSRiver",iconmode:"percentile",onlyAlerts:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.key_="usgsriver";this.addElementsListeners("iconmode","click");this.setElementsValue("iconmode","radiogroup",this.options_.iconmode);this.addElementListener("alt","click");this.setElementValue("alt","checkbox",this.options_.onlyAlerts)};wundermap.layers.USGSRiver.getURL=function(h,l,f,k,e,n,c){var m=this.key_;if(this.getElementsValue("iconmode","radiogroup",null)=="temperature"){m="usgsrivertemp"}var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:m,date:wui.date.strftime("%Y_%m_%d",wundermap.date,true),"display.mode":this.getElementsValue("iconmode","radiogroup",null),units:wundermap.options.units};if(this.getElementValue("alt","checkbox",this.options_.onlyAlerts)){g.extend="flood"}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.USGSRiver.getDetailsURL=function(f,e){var d=wui.date.strftime("%Y_%m_%d",wundermap.date,true);var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+f+"&date="+d;return c};wundermap.layers.USGSRiver.getBalloonContent=function(h){var l=new Date(h.epoch*1000);var g=wui.date.strftime("%Y-%m-%d %H:00 UTC",l,true);var e=wundermap.utils;var c=wundermap.options.units;var k="";var f='<div class="USGSRiverBalloon">';f+='<div class="infobox-title">River Report</div>';f+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';f+='<td class="full"><span>'+h.name+"</span></td>";f+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(h.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(h.lon).toFixed(2)+"</span></td></tr></table>";f+='<div class="grt p10">';f+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(h.id){var m=h.id;if(m<10000000){m="0"+m}f+='<tr><td class="vaT nobr">Station ID:</td><td class="full"><a href="http://waterdata.usgs.gov/nwis/uv?'+m+'" class="newWin" target="new">'+m+"</a></td></tr>"}if(h.discharge>0){k='<span class="b">'+e.convertFlowRateIntoUnits(c,h.discharge,2)+"</span> "+e.getFlowRateUnits(c);f+='<tr><td class="vaT nobr">Flow Rate:</td><td class="full">'+k+"</td></tr>"}if(wui.defined(h.stage)){k='<span class="b">'+e.convertHeightIntoUnits(c,h.stage,2)+"</span> "+e.getHeightUnits(c);f+='<tr><td class="vaT nobr">Stage:</td><td class="full">'+k+"</td></tr>"}if(h.forecast>0){k='<span class="b">'+e.convertHeightIntoUnits(c,h.forecast,2)+"</span> "+e.getHeightUnits(c);f+='<tr><td class="vaT nobr">Forecast Stage:</td><td class="full">'+k+"</td></tr>"}if(h.flood_stage>0){k='<span class="b">'+e.convertHeightIntoUnits(c,h.flood_stage,2)+"</span> "+e.getHeightUnits(c);f+='<tr><td class="vaT nobr">Flood Stage:</td><td class="full">'+k+"</td></tr>"}if(h.percentile<=0){}else{if(h.percentile<10){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{if(h.percentile<=24){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{if(h.percentile<=75){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{if(h.percentile<=90){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}}}}}if(h.temperature>0){k='<span class="b">'+e.convertTempIntoUnits(c,h.temperature,2)+"</span> &deg;"+e.getTempUnits(c);f+='<tr><td class="vaT nobr">Temperature:</td><td class="full">'+k+"</td></tr>"}f+="</table>";if(h.noaa_graph){f+='<div class="tm10"><a href="'+h.noaa_graph+'" class="b med newWin" target="new">NOAA Flood Stage Graph</a></div>'}f+="</div>";f+='<div class="contentFooterPad taC brBot5">Last updated: <span>'+h.date+"</span></div>";f+="</div>";return f};wundermap.layers.WeatherStations=new wundermap.Layer();wundermap.layers.WeatherStations.className="WeatherStations";wundermap.layers.WeatherStations.initialize=function(f,d){var e={name:"wxsn",title:"Weather Stations",sidebarPrefix:"LayerWeatherStations",mode:"tw",showpws:1,bcdgtemp:0,tabsSelectedIndex:0,opacity:50,clickable:true,clickableCustom:null,rapidfire:0,timelord:{text:"historic data from 1972 until present, then 10 days of forecast into the future",showTooltip:true,min:new Date(Date.UTC(1972,1-1,1)),max:wundermap.utils.createDateFunction(10,"day")},icondraw:{canvasHeight:64,canvasWidth:64,radius:10}};d=a.extend(true,{},e,d);wundermap.Layer.prototype.initialize.call(this,f,d);this.addImageLayer({disabled:true,fn_getURL:a.proxy(this.getURLArchiveOrFuture,this),fn_getDataURL:a.proxy(this.getURLArchiveOrFuture,this),ajaxOptions:{dataType:"jsonp",cache:true},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.addImageLayer({disabled:true,fn_getURL:a.proxy(this.getURLArchiveOrFuture,this),fn_getDataURL:a.proxy(this.getURLArchiveOrFuture,this),ajaxOptions:{dataType:"jsonp",cache:true},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.addMarkerLayer({fn_getURL:a.proxy(this.getURL,this),ajaxOptions:{dataType:"jsonp"},fn_getURLDataCallback:a.proxy(this.drawData,this)});this.addElementsListeners("iconmode","click");this.setElementsValue("iconmode","radiogroup",this.options_.mode);this.addElementListener("ShowHidePWS","click");this.setElementValue("ShowHidePWS","checkbox",this.options_.showpws);this.setElementValue("rapidfire","checkbox",this.options_.rapidfire);var c=this;this.wxsn_timeperiod=null;google.maps.event.addListener(this,"layertoggled",function(g){if(g){var h=c.getElementValue("rapidfire","checkbox",c.options_.rapidfire);c.toggleRapidfire(h)}else{c.toggleRapidfire(false);c.wxsn_timeperiod=null}})};wundermap.layers.WeatherStations.custom_check_dates=function(g){var e=new Date();var f=wundermap.utils.createDate(-62,"minute");var c=wundermap.utils.createDate(1,"hour");if(g&&g>c){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(false);this.markerlayers_[0].setDisabled(true);this.key_="wundfcthourly";this.wxsn_timeperiod=1}else{if(g&&g<f){this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.markerlayers_[0].setDisabled(true);this.key_="wxsnhistory";this.wxsn_timeperiod=-1}else{this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.markerlayers_[0].setDisabled(false);if(this.wxsn_timeperiod===0){return false}this.wxsn_timeperiod=0}}this.removeDataTables()};wundermap.layers.WeatherStations.getAjaxOptions=function(){if(!this.imagelayers_[1].getDisabled()){return this.imagelayers_[1].callbacks_.ajaxOptions||{}}if(!this.imagelayers_[0].getDisabled()){return this.imagelayers_[0].callbacks_.ajaxOptions||{}}else{return{}}};wundermap.layers.WeatherStations.getURL=function(h,m,f,l,e,n,c){var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,iconsize:16,maxage:3600,format:"json",rf_filter:"1",maxstations:"100"};var k=(this.getElementValue("ShowHidePWS","checkbox",this.options_.showpws))?1:0;if(k==0){g.type="ICAO,BUOY,SYNOP"}var d="http://stationdata.wunderground.com/cgi-bin/stationdata";d+="?"+a.param(g);return d};wundermap.layers.WeatherStations.getURLArchiveOrFuture=function(h,m,f,l,e,n,c){var c=c||{};if(this.getElementsValue("iconmode","radiogroup",this.options_.mode)=="none"){return""}var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,date:wui.date.strftime("%Y%m%d%H",wundermap.date,true),year:wui.date.strftime("%Y",wundermap.date,true),month:wui.date.strftime("%m",wundermap.date,true),"display.mode":this.getElementsValue("iconmode","radiogroup",this.options_.mode),units:wundermap.options.units};var k=(this.getElementValue("ShowHidePWS","checkbox",this.options_.showpws))?1:0;if(k==0){g["filter.type.any"]="icao,buoy,synop"}var d="http://timelord.wunderground.com/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.WeatherStations.getURLBCDG=function(n,q,k,p,g,s,c){var f=(this.getElementValue("ShowHideBCDGTEMP","checkbox",this.options_.bcdgtemp))?1:0;if(f==0){return""}var l={maxlat:n,maxlon:q,minlat:k,minlon:p,width:g,height:s,num:"1",key:"bcdg_world",imagename:"bcdg-"+this.getElementsValue("var","radiogroup","TEMP")+".pgm",proj:"me"};var r=wundermap.date.getTime();var o=(new Date()).getTime();var e=(r-o)/(3600*1000);var h=parseInt(e,10);var m=h%3;if(m!=0){l.frame0=h-m;l.frame1=h+(3-m)}l.frame=h;var d="http://wublast.wunderground.com/cgi-bin/WUBLAST";d+="?"+a.param(l);return d};wundermap.layers.WeatherStations.getDetailsURL=function(f,e){var d=wui.date.strftime("%Y%m%d%H",wundermap.date,true);var c="http://timelord.wunderground.com/cgi-bin/ICONBLAST?key="+this.key_+"&id="+f+"&date="+d+"&year="+wui.date.strftime("%Y",wundermap.date,true)+"&month="+wui.date.strftime("%m",wundermap.date,true);return c};wundermap.layers.WeatherStations.drawData=function(h){var l=h.conds;var e=0;var k=this.getElementsValue("iconmode","radiogroup",this.options_.mode);if(k=="none"){return}var g=this.markerlayers_[0];g.removeOverlays();for(var d in l){e++;var f=l[d];var c=this.drawStation(f,g,k);if(c==-1){delete l[d]}}this.displayDataTable(l,22,{iconmode:k})};wundermap.layers.WeatherStations.createWindSpeedPath=function(x,D){var z;var y;var e=this.options_.icondraw.canvasHeight;var E=this.options_.icondraw.canvasWidth;var g=this.options_.icondraw.radius;var f=4;var I=20;var k=I/6;var J=k*0.8;var r=8;var s=I/5;var G=(D<0.01);var H=Math.floor(D);var l=Math.floor(H/50);H-=l*50;var d=Math.floor(H/10);H-=d*10;var h=H>4.99;var q=g*2;var n=q+4;var p;var c;if(G){p=n-2;c=n-2;z=p/2;y=c/2;x.arc(e/2,E/2,p/2,0,2*Math.PI,false)}else{p=n+I;c=n;z=E/2;y=e/2;var m=f/2;var A=Math.asin(m/g);var F=Math.sqrt((g*g)-(m*m));var C=F;var B=m;var v=(2*Math.PI)-A;var o=z+g+I;var t=y+B;x.arc(z,y,g,A,v,false);x.lineTo(o,y-B);x.lineTo(o,t);var w=o;var u=t;x.lineTo(w,u);if(h&&(d+l==0)){w=o-k;x.lineTo(w,u)}while(l>0){u+=r;w-=s/2;x.lineTo(w,u);u-=r;w-=s/2;x.lineTo(w,u);l--}while(d>0){u+=r;x.lineTo(w,u);w-=k;x.lineTo(w,u);u-=r;x.lineTo(w,u);d--}if(h){u+=r/2;x.lineTo(w,u);w-=J;x.lineTo(w,u);u-=r/2;x.lineTo(w,u)}x.lineTo(z+C,y+B);x.lineCap="round";x.lineJoin="bevel"}x.lineWidth=1};wundermap.layers.WeatherStations.drawWindSpeed=function(q,o,m,p,k){var g=this.options_.icondraw.canvasHeight;var c=this.options_.icondraw.canvasWidth;var l=this.options_.icondraw.radius;var f=wundermap.palettes.temperature;q.save();if(o>0){var e=m-90;e=(e<0)?e+360:e;var d=Math.PI*(e/180);q.translate(c/2,g/2);q.rotate(d);q.translate(-c/2,-g/2)}q.beginPath();this.createWindSpeedPath(q,o);q.strokeStyle="black";q.shadowColor="#999";q.shadowBlur=10;q.shadowOffsetX=5;q.shadowOffsetY=5;var n=0;var h=f.length;while(p>f[n+1][0]&&n<h){n++}if(p>-900&&p<900){q.fillStyle="rgb("+f[n][1]+","+f[n][2]+","+f[n][3]+")"}else{q.fillStyle="rgb(255,255,255)"}q.closePath();q.fill();q.stroke();q.restore();p=Math.round(p);if(p>-900){}else{p="N/A"}if(f[n].length>=7){q.fillStyle="rgb("+f[n][4]+","+f[n][5]+","+f[n][6]+")"}else{q.fillStyle="rgb(0,0,0)"}q.font="12px sans-serif";q.textAlign="center";q.textBaseline="middle";k=Math.round(k);q.fillText(k,c/2,g/2)};wundermap.layers.WeatherStations.drawTemperature=function(m,l,g){var f=this.options_.icondraw.canvasHeight;var d=this.options_.icondraw.canvasWidth;var e=wundermap.palettes.temperature;var k=0;var h=e.length;while(l>e[k+1][0]&&k<h){k++}m.textAlign="center";m.textBaseline="middle";m.save();m.font="bold 22px sans-serif";l=Math.round(l);if(l>-900){}else{l="N/A"}g=Math.round(g);var c=String.fromCharCode(176);m.fillStyle="#333";m.font="bold 22px sans-serif";m.fillText(g+c,d/2+1,f/2);m.fillText(g+c,d/2+1,f/2+1);m.fillText(g+c,d/2-1,f/2);m.fillText(g+c,d/2-1,f/2-1);m.fillText(g+c,d/2,f/2+1);m.fillText(g+c,d/2,f/2-1);m.restore();m.font="bold 22px sans-serif";if(l>-900&&l<900){m.fillStyle="rgb("+e[k][1]+","+e[k][2]+","+e[k][3]+")"}else{m.fillStyle="rgb(255,255,255)"}m.showdow;m.fillText(g+c,d/2,f/2)};wundermap.layers.WeatherStations.drawTemperatureHumidity=function(q,p,l,d){var h=this.options_.icondraw.canvasHeight;var f=this.options_.icondraw.canvasWidth;var m=this.options_.icondraw.radius;var g=wundermap.palettes.temperature;var n=0;var k=g.length;while(p>g[n+1][0]&&n<k){n++}q.save();if(p>-900&&p<900){q.fillStyle="rgb("+g[n][1]+","+g[n][2]+","+g[n][3]+")"}else{q.fillStyle="rgb(255,255,255)"}var o=m*2;var e=o+4;sizewidth=e-2;sizeheight=e-2;centerx=sizewidth/2;centery=sizeheight/2;q.arc(f/2,h/2,16,0,2*Math.PI,false);q.shadowColor="#999";q.shadowBlur=10;q.shadowOffsetX=5;q.shadowOffsetY=5;q.fill();q.stroke();q.restore();if(g[n].length>=7){q.strokeStyle="rgb("+g[n][4]+","+g[n][5]+","+g[n][6]+")"}else{q.strokeStyle="rgb(0,0,0)"}if(g[n].length>=7){q.fillStyle="rgb("+g[n][4]+","+g[n][5]+","+g[n][6]+")"}else{q.fillStyle="rgb(0,0,0)"}q.font="bold 12px sans-serif";q.lineWidth=2;q.textAlign="center";q.textBaseline="middle";p=Math.round(p);if(p>-900){}else{p="N/A"}l=Math.round(l);var c=String.fromCharCode(176);q.fillText(l+c,f/2,h/2-6);q.font="10px sans-serif";if(d>=0&&d<=100){q.fillText(d+"%",f/2,h/2+6)}else{q.fillText(d+"N/A",f/2,h/2+6)}};wundermap.layers.WeatherStations.drawRainGuage=function(n,c,f,m){var h=this.options_.icondraw.canvasHeight;var g=this.options_.icondraw.canvasWidth;var k=this.options_.icondraw.radius;n.fillStyle="rgb(200,200,255)";n.strokeStyle="rgb(0,0,0)";var l=k*2;var e=l+4;sizewidth=e-2;sizeheight=e-2;centerx=g/2;centery=h/2;n.save();n.arc(centerx,centery,16,0,2*Math.PI,false);n.shadowColor="#999";n.shadowBlur=10;n.shadowOffsetX=5;n.shadowOffsetY=5;n.fill();n.stroke();n.restore();n.save();var d=(c/m)*10;if(c>m){d=10}if(c<0){d=0}n.beginPath();n.fillStyle="rgb(100,100,255)";n.rect(centerx-5,centery-4,10,-d);n.fill();n.restore();n.save();n.beginPath();n.moveTo(centerx-6,centery-13);n.lineTo(centerx-6,centery-3);n.lineTo(centerx+6,centery-3);n.lineTo(centerx+6,centery-13);n.strokeStyle="rgb(0,0,0)";n.lineCap="round";n.lineJoin="bevel";n.stroke();n.restore();n.strokeStyle="rgb(0,0,0)";n.fillStyle="rgb(0,0,0)";n.font="bold 12px sans-serif";n.lineWidth=2;n.textAlign="center";n.textBaseline="middle";n.fillText(f,g/2,h/2+4)};wundermap.layers.WeatherStations.lookupIconNameFromConds=function(c){var f=wundermap.utils.strcasecmp;var e=wundermap.utils.strstr;var d="";if(!f(c,"partly cloudy")||!f(c,"broken clouds")||!f(c,"scattered clouds")){d="partlycloudy"}else{if(!f(c,"clear")){d="clear"}else{if(!f(c,"cloudy")){d="cloudy"}else{if(e(c,"freezing rain")){d="sleet"}else{if(e(c,"ice")){d="sleet"}else{if(e(c,"sleet")){d="sleet"}else{if(e(c,"snow")){d="snow"}else{if(!f(c,"rain")){d="rain"}else{if(!f(c,"chance of rain")){d="chancerain"}else{if(!f(c,"chance of snow")){d="chancesnow"}else{if(!f(c,"mostly cloudy")){d="mostlycloudy"}else{if(!f(c,"hazy")){d="hazy"}else{if(e(c,"thunderstorms")){d="tstorms"}else{if(!f(c,"overcast")){d="cloudy"}}}}}}}}}}}}}}return d};wundermap.layers.WeatherStations.makeIcon=function(o,n){var g=wundermap.utils;var k=wundermap.options.units;var h=o.weather;var p=null;var l=(o.type)?o.type.toUpperCase():"";if(n=="none"){return[]}var f=this.options_.icondraw.canvasWidth;var q=this.options_.icondraw.canvasHeight;var e=document.createElement("canvas");e.setAttribute("width",f);e.setAttribute("height",q);if(wui.status.canvasSupported){var r=e.getContext("2d");if(n=="tw"){this.drawWindSpeed(r,o.windspeedmph,o.winddir,o.tempf,g.convertTempIntoUnits(k,o.tempf))}else{if(n=="temp"){this.drawTemperature(r,o.tempf,g.convertTempIntoUnits(k,o.tempf))}else{if(n=="tdh"){this.drawTemperatureHumidity(r,o.dewptf,g.convertTempIntoUnits(k,o.dewptf),o.humidity)}else{if(n=="r"){this.drawRainGuage(r,o.dailyrainin,g.convertRainIntoUnits(k,o.dailyrainin),1)}}}}var c=e.toDataURL();var m=new google.maps.MarkerImage(c,new google.maps.Size(f,q),null,new google.maps.Point(f/2,q/2));return[m,p]}else{if(h&&h.length&&g.isValidMeasurement(h)&&n=="tw"&&l!="PWS"){var f=87;var q=64}else{h="";var f=64;var q=64;p=new google.maps.MarkerImage(wundermap.options.stationicondomain+"/gmapshadow.png",new google.maps.Size(f,q),null,new google.maps.Point(f/2,q/2))}var d=wundermap.options.stationicondomain+"/cgi-bin/gmapicon?"+a.param({mode:n,shemi:(o.lat<0)?1:0,tu:g.convertTempIntoUnits(k,o.tempf),t:o.tempf,wsu:g.convertWindIntoUnits(k,o.windspeedmph),ws:o.windspeedmph,wd:o.winddir,tdu:g.convertTempIntoUnits(k,o.dewptf),td:o.dewptf,h:o.humidity,ru:g.convertRainIntoUnits(k,o.dailyrainin),r:o.dailyrainin,wx:h,format:".png"});var m=new google.maps.MarkerImage(d,new google.maps.Size(f,q),null,new google.maps.Point(f/2,q/2));return[m,p]}};wundermap.layers.WeatherStations.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var d=this.findId("rapidfire");if(d[0]){var e=google.maps.event.addDomListener(d[0],"click",function(){google.maps.event.trigger(c,"settings_changed");c.toggleRapidfire(this.checked)});this.listeners_.push(e)}};wundermap.layers.WeatherStations.toggleRapidfire=function(c){if(!this.rapidfire){return}if(c){this.rapidfire.start()}else{this.rapidfire.stop()}};wundermap.layers.WeatherStations.drawStation=function(n,v,p,o){if(o){var r=o.marker.get("station");n=o.station;if(r){n=a.extend(true,{},r,n)}}var u=this.getElementValue("rapidfire","checkbox",this.options_.rapidfire);var s=n.id;var k=n.lat;var f=n.lon;var d=(n.type)?n.type.toUpperCase():"";var e=wundermap.utils;var x=this.options_.clickableCustom;var h=!!(this.options_.clickable);var t=!!(h||x);if(!o){if((k<0.2&&k>-0.2)&&(f<0.2&&f>-0.2)){return -1}}if(p=="tdh"&&!e.isValidMeasurement(n.dewptf)){return -1}else{if(p=="r"&&!e.isValidMeasurement(n.dailyrainin)){}else{if(!e.isValidMeasurement(n.tempf)){return -1}}}var y=n.neighborhood;if(s.indexOf("WMO")!=-1){s=s.substr(3)}if(y&&y.indexOf("The ")==0){y=y.substr(4)}if(s.indexOf("M")==0){}var B=y;if(d=="PWS"){if(y==""||y=="NULL"){B=n.adm1||s}}else{B=n.name||s}var c=(B)?B.substring(0,22):"";a.extend(true,n,{id:s,type:d,name:B,nameShort:c,neighborhood:y});var A=new google.maps.LatLng(k,f);if(wui.status.canvasSupported&&!o){var z=n.weather;if(z&&z.length&&e.isValidMeasurement(z)&&p=="tw"&&d!="PWS"){var g=this.lookupIconNameFromConds(z);if(g){var m=new google.maps.Marker({clickable:t,icon:new google.maps.MarkerImage(wundermap.options.iconsdomain+"/i/c/k2/"+this.lookupIconNameFromConds(z)+".png",new google.maps.Size(48,48),new google.maps.Point(0,0),new google.maps.Point(48+8,24),new google.maps.Size(48,48)),map:wundermap.map,position:A,title:B});if(t){google.maps.event.addListener(m,"click",function(C){google.maps.event.trigger(l,"click")})}v.addMarker(m)}}}var w=this.makeIcon(n,p);if(o){o.marker.setOptions({optimized:false});o.marker.setIcon(w[0])}else{var l=new google.maps.Marker({clickable:t,icon:w[0],map:wundermap.map,position:A,shadow:w[1],optimized:!u,title:B})}if(l){l.set("station",n)}else{if(o){o.marker.set("station",n)}}if(t&&!o){var q=this;google.maps.event.addListener(l,"click",function(D){var C=this.get("station");if(h){wundermap.openInfoBox({title:B,tabs:[{title:LANG["kLang.DateTime.Current"],content:q.getBalloonContent(C,p)},{title:LANG["kLang.Forecast.WeatherForecast"],content:q.getBalloonContentForecast(C,p)},{title:"Graph",content:q.getBalloonContentGraph(C,p)}],tabsOptions:{selected:q.options_.tabsSelectedIndex,select:function(E,F){q.options_.tabsSelectedIndex=F.index}},footer:q.getBalloonContentFooter(C,p),marker:this})}if(x){x(C,p)}});n.marker=l}if(!o){v.addMarkerWithKey(l,n.id,true)}};wundermap.layers.WeatherStations.appendMadis=function(c){return c+" (<a href='http://madis.noaa.gov/'>MADIS</a>)"};wundermap.layers.WeatherStations.getStationURL=function(m,l){var d=m.id;var g=(m.type)?m.type.toUpperCase():"";var c="";var e="";var k,h,f;if(!wundermap.date||(new Date()).getTime()<wundermap.date.getTime()){e=wui.date.strftime("%Y/%m/%d");k=wui.date.strftime("%d");h=wui.date.strftime("%Y");f=wui.date.strftime("%m")}else{e=wui.date.strftime("%Y/%m/%d",wundermap.date);k=wui.date.strftime("%d",wundermap.date);h=wui.date.strftime("%Y",wundermap.date);f=wui.date.strftime("%m",wundermap.date)}if(g=="ICAO"){c="/history/airport/"+d+"/"+e+"/DailyHistory.html"}else{if(g=="SYNOP"){c="/history/station/"+d+"/"+e+"/DailyHistory.html"}else{if(g=="BUOY"){var n=d.substr(4);c="/MAR/buoy/"+n+".html"}else{if(g=="PWS"||g=="MADIS"){c="/weatherstation/WXDailyHistory.asp?ID="+d+"&day="+k+"&month="+f+"&year="+h}else{c="/history/airport/"+d+"/"+e+"/DailyHistory.html"}}}}return c};wundermap.layers.WeatherStations.getBalloonContentTitle=function(h,l){var d=wundermap.utils;var c=wundermap.options.units;var k=d.convertHeightIntoUnits(c,h.elev)+" "+d.getHeightUnits(c);var g=(h.type)?h.type.toUpperCase():"";var e=this.getStationURL(h,l);var f='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(e){f+='<td class="full">Station ID: <a href="'+e+'" target="_blank">'+h.id+"</a></td>"}else{f+='<td class="full">Station ID: <span>'+h.id+"</span></td>"}f+='<td class="nobr dtr">Lat: <span>'+parseFloat(h.lat).toFixed(2)+'</span></td><td class="nobr dtr">Lon: <span>'+parseFloat(h.lon).toFixed(2)+"</span></td>";if(g=="BUOY"){f+='<td class="nobr">Elev: <span>0</span></td>'}else{f+='<td class="nobr">Elev: <span>'+k+"</span></td>"}f+="</tr></table>";return f};wundermap.layers.WeatherStations.getBalloonContent=function(s,r){var l="";var h=wundermap.utils;var o=wundermap.options.units;var p=(s.type)?s.type.toUpperCase():"";if(!r){l+='<div class="infobox-title">'+s.name+"</div>"}l+=this.getBalloonContentTitle(s,r);var e="";l+='<table cellspacing="0" cellpadding="0" class="infoTable borderTop grt"><tr><td class="vaT dtr"><div id="nowCond"><div class="titleSubtle bm10">Conditions</div>';if(typeof s.icon=="undefined"||s.icon=="-999"){s.icon="unknown"}if(!s.weather||s.weather=="-999"){s.weather="Sky conditions not available for this station."}l+='<div id="curIcon"><img src="'+wundermap.options.iconsdomain+"/i/c/k/"+s.icon+'.gif" class="condIcon" /></a></div><div id="curCond">'+s.weather+'</div><div class="clear"></div></div></td><td class="vaT dtr">  <div id="nowTemp">    <div class="titleSubtle bm10">'+LANG["kLang.Stats.Temp.Temperature"]+'</div>    <div id="tempActual">      <span class="pwsrt" pwsid="'+s.id+'" pwsvariable="tempf" pwsunit="'+o+'" value="'+h.convertTempIntoUnits(o,s.tempf)+'" english="" metric="">'+h.convertTempIntoUnits(o,s.tempf)+'</span>      <span class="tempUnit">&deg;'+h.getTempUnits(o)+"</span>    </div>";if(s.windchillf>-99){e=h.convertTempIntoUnits(o,s.windchillf)+" &deg;"+h.getTempUnits(o)+""}else{if(s.heatindexf>-99){e=h.convertTempIntoUnits(o,s.heatindexf)+" &deg;"+h.getTempUnits(o)+""}else{e=h.convertTempIntoUnits(o,s.tempf)+" &deg;"+h.getTempUnits(o)+""}}l+='    <div id="tempFeel">'+LANG["kLang.Conditions.Titles.FeelsLike"]+" "+e+"</div>  </div></td>";var c="0px top";if(h.isValidMeasurement(s.winddir)){var k=b(s.winddir);while(k>=360){k-=360}while(k<0){k+=360}var n=62;var c=(-1*k*n)+"px top"}l+='<td class="vaT">  <div id="nowWind">    <div class="titleSubtle">'+LANG["kLang.Stats.Wind.Wind"]+'</div>    <div id="windCompassContainer">      <span id="windCompass" class="pwsrt" pwsid="'+s.id+'" pwssetobject="winddir" pwsunit="'+o+'" pwsvariable="winddir" english="" metric="" value="'+s.winddir+'" style="background-position:'+c+'"></span>      <span id="windCompassSpeed">        <span class="b pwsrt" pwsid="'+s.id+'" pwsunit="'+o+'" pwsvariable="winddir" value="'+h.lookupWindString(s.winddir)+'" english="" metric="">'+h.lookupWindString(s.winddir)+'</span> at        <span class="b pwsrt" pwsid="'+s.id+'" pwsunit="'+o+'" pwsvariable="windspeedmph" value="'+h.convertWindIntoUnits(o,s.windspeedmph)+'" english="" metric="">'+h.convertWindIntoUnits(o,s.windspeedmph)+"</span> "+h.getWindUnits(o)+"      </span>    </div>  </div></td></tr></table>";if(p=="BUOY"){l+='<div class="grt p10">';l+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';e='<span class="b">'+h.convertPressureIntoUnits(o,s.baromin)+"</span> "+h.getPressureUnits(o);l+="<tr><td>"+LANG["kLang.Stats.Misc.Pressure"]+":</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertTempIntoUnits(o,s.sstf)+"</span> &deg;"+h.getTempUnits(o);l+="<tr><td>Sea Surface Temperature:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertHeightIntoUnits(o,s.domwaveheightft)+"</span> "+h.getHeightUnits(o);l+="<tr><td>Dom Wave Height:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertWaveperiodIntoUnits(o,s.domwaveperiods)+"</span> s";l+="<tr><td>Dom Wave Period:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertHeightIntoUnits(o,s.windwaveheightft)+"</span> "+h.getHeightUnits(o);l+="<tr><td>Wind Wave Height:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertWaveperiodIntoUnits(o,s.windwaveperiods)+"</span> s";l+="<tr><td>Wind Wave Period:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertHeightIntoUnits(o,s.swellwaveheightft)+"</span> "+h.getHeightUnits(o);l+="<tr><td>Swell Wave Height:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertWaveperiodIntoUnits(o,s.swellwaveperiods)+"</span> s";l+="<tr><td>Swell Wave Period:</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertWavedirIntoUnits(o,s.swellwavedir)+"</span> &deg;";l+="<tr><td>Swell Wave Dir:</td><td>"+e+"</td></tr>";l+="</table>";l+="</div>"}else{l+='<table cellspacing="0" cellpadding="0" class="full borderTop bm10">';l+="<tr>";l+='<td class="third vaT dtr">';l+='<table cellspacing="0" cellpadding="0" class="infoTable">';l+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Moisture</div></td></tr>';e='<span class="b pwsrt" pwsid="'+s.id+'" pwsvariable="dewptf" value="'+h.convertTempIntoUnits(o,s.dewptf)+'" pwsunit="'+o+'" english="" metric="">'+h.convertTempIntoUnits(o,s.dewptf)+"</span> &deg;"+h.getTempUnits(o);l+="<tr><td>"+LANG["kLang.Misc.DewPoint"]+":</td><td>"+e+"</td></tr>";e=s.humidity;if(!h.isValidMeasurement(e)||e=="N/A"){e="-"}e='<span class="b pwsrt" pwsid="'+s.id+'" pwsvariable="humidity" value="'+e+'" pwsunit="'+o+'" english="" metric="">'+e+"</span>%";l+="<tr><td>"+LANG["kLang.Stats.Misc.Humidity"]+":</td><td>"+e+"</td></tr>";l+="</table>";l+="</td>";l+='<td class="third vaT dtr">';l+='<table cellspacing="0" cellpadding="0" class="infoTable">';l+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Precipitation</div></td></tr>';e='<span class="b">'+h.convertRainIntoUnits(o,s.rainin)+"</span> "+h.getRainUnits(o);l+="<tr><td>"+LANG["kLang.Stats.Misc.Precipitation"]+":</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertRainIntoUnits(o,s.dailyrainin)+"</span> "+h.getRainUnits(o);l+="<tr><td>Daily Precip.:</td><td>"+e+"</td></tr>";l+="</table>";l+="</td>";l+='<td class="third vaT">';l+='<table cellspacing="0" cellpadding="0" class="infoTable">';l+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Conditions</div></td></tr>';e='<span class="b pwsrt" pwsid="'+s.id+'" pwsvariable="baromin" value="'+h.convertPressureIntoUnits(o,s.baromin)+'" pwsunit="'+o+'" english="" metric="">'+h.convertPressureIntoUnits(o,s.baromin)+"</span> "+h.getPressureUnits(o);l+="<tr><td>"+LANG["kLang.Stats.Misc.Pressure"]+":</td><td>"+e+"</td></tr>";e='<span class="b">'+h.convertVisibilityIntoUnits(o,s.visibilitysm)+"</span> "+h.getVisibilityUnits(o);l+="<tr><td>"+LANG["kLang.Stats.Misc.Visibility"]+":</td><td>"+e+"</td></tr>";l+="</table>";l+="</td>";l+="</tr>";l+="</table>"}if(this.rapidfire){var d=parseInt(s.updated,10)*1000;var t=new Date(d);var f=wundermap.timelord.getDateInUserTime(t);var m=wui.date.strftime("%H:%M ",f,true)+wundermap.options.timezone["short"];l+='<table cellspacing="0" cellpadding="0" class="full borderTop">';l+="<tr>";l+='<td><div class="titleSubtle p10">  '+LANG.kLangUpdate+'  <span class="pwsrt" pwsid="'+s.id+'" pwsvariable="lu" pwsunit="'+o+'" value="'+s.updated+'">'+m+"</span></div>";l+="</td>";l+="</tr>";l+="</table>"}if(wui.defined(s.Road1Tempf)){l+='<table cellspacing="0" cellpadding="0" class="infoTable bm10">';l+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Road Conditions</div></td></tr>';var q=h.getTempUnits(o);if(wui.defined(s.Road1Tempf)){e=h.convertTempIntoUnits(o,s.Road1Tempf)+" &deg;"+q+", "+s.Road1State;l+="<tr><td>Road1:</td><td>"+e+"</td></tr>"}if(wui.defined(s.Road2Tempf)){e=h.convertTempIntoUnits(o,s.Road2Tempf)+" &deg;"+q+", "+s.Road2State;l+="<tr><td>Road2:</td><td>"+e+"</td></tr>"}if(wui.defined(s.Road3Tempf)){e=h.convertTempIntoUnits(o,s.Road3Tempf)+" &deg;"+q+", "+s.Road3State;l+="<tr><td>Road3:</td><td>"+e+"</td></tr>"}l+="</table>"}if(s.roadtrip&&s.roadtrip.interesting){l+='<table cellspacing="0" cellpadding="0" class="full infoTable borderTop">';l+="<tr>";l+='<td class="vaT">';l+='<div class="titleSubtle bm10">Comments:</div>';l+="<ul>";var g=s.roadtrip.interesting;if(g.belowFreezing){l+="<li>below freezing</li>"}if(g.dropBelowFreezing){l+="<li>drop below freezing</li>"}if(g.strongWinds){l+="<li>strong winds</li>"}if(g.beginStrongWinds){l+="<li>begin strong winds</li>"}l+="</ul>";l+="</td>";l+="</tr>";l+="</table>"}return l};wundermap.layers.WeatherStations.getBalloonContentFooter=function(e,f){var c=e.adm1+", "+e.adm2;if(e.adm1===e.adm2){c=e.adm1}if(!c){c=e.id}var d='<div class="contentFooterPad taC brBot5"><a target="new" href="/cgi-bin/findweather/getForecast?query='+e.lat+","+e.lon+"&sp="+e.id+'">Visit local weather page for '+c+"</a></div>";return d};wundermap.layers.WeatherStations.getBalloonContentForecast=function(e,f){var d="";d+=this.getBalloonContentTitle(e,f);d+='<div class="borderTop grt">';var c="/stationmaps/gMapForecast.asp?query="+e.lat+","+e.lon;if(wundermap.options.brand){c+="&brand="+wundermap.options.brand}if(this.debug_==1){wui.log(c)}d+='<iframe src="'+c+'" height="200" width="100%" scrolling="auto" frameborder="0" class="tm5" />';d+="</div>";return d};wundermap.layers.WeatherStations.getBalloonContentGraph=function(h,l){var e="";var g=(h.type)?h.type.toUpperCase():"";e+=this.getBalloonContentTitle(h,l);e+='<div class="borderTop">';var d="http://www.wunderground.com";if(g=="ICAO"||g=="SYNOP"){var f=wui.date.strftime("%Y");var k=wui.date.strftime("%m");var c=wui.date.strftime("%d");d+="/cgi-bin/histGraphAll?day="+c+"&year="+f+"&month="+k+"&ID="+h.id}else{if(g=="PWS"){d+="/cgi-bin/wxStationGraphAll?ID="+h.id}else{d=""}}if(d){if(l=="tdh"){d+="&type=3&showtemp=1&showtitle=0&width=414"}else{if(l=="r"){d+="&type=3&showrain=1&showtitle=0&width=414"}else{d+="&type=3&showtemp=1&showtitle=0&width=414"}}if(this.debug_==1){wui.log(d)}e+='<div class="tm10 bm10"><img src="'+d+'" class="infoPaneGraph" /></div>'}e+="</div>";return e};wundermap.layers.WeatherStations.getTableHeadContent=function(f,k){var g=a("<tr></tr>");var e=a('<th title="Sort by Place" class="cPointer">'+LANG["kLang.Misc.Place"]+"</th>");var d=a('<th title="Sort by Station" class="cPointer">Station</th>');var c=a('<th class="cPointer"></th>');g.append(e).append(d).append(c);var h=k.iconmode;if(h=="r"){c.html("Daily Rainfall");c.attr("title","Sort by Daily Rainfall")}else{if(h=="tdh"){c.html(LANG["kLang.Misc.DewPoint"]);c.attr("title","Sort by Dew Point")}else{c.html(LANG["kLang.Stats.Temp.Temp"]);c.attr("title","Sort by Temperature")}}return g};wundermap.layers.WeatherStations.getTableRowContent=function(p,q){var m=a("<tr></tr>");var k=a("<td></td>");var g=k.clone();var f=k.clone().addClass("nobr");m.append(k).append(g).append(f);var n=(p.type)?p.type.toUpperCase():"";var o=q.iconmode;var d="";if(n=="PWS"){d=p.nameShort}if(!d){d=p.name}if(!d){d=p.id}k.html(d);if(p.name){k.attr("title",p.name)}var c=this.getStationURL(p,o);if(c){g.html('<a href="'+c+'" target="_blank">'+p.id+"</a>")}else{g.html(id)}var h=wundermap.utils;var l=wundermap.options.units;var e="";if(o=="r"){e='<span class="b">'+h.convertRainIntoUnits(l,p.dailyrainin)+"</span> "+h.getRainUnits(l);f.html(e)}else{if(o=="tdh"){e='<span class="b pwsrt" pwsid="'+p.id+'" pwsvariable="dewptf" value="'+h.convertTempIntoUnits(l,p.dewptf)+'" pwsunit="'+l+'" english="" metric="">'+h.convertTempIntoUnits(l,p.dewptf)+"</span> &deg;"+h.getTempUnits(l);f.html(e)}else{e='<span class="b pwsrt" pwsid="'+p.id+'" pwsvariable="tempf" value="'+h.convertTempIntoUnits(l,p.tempf)+'" pwsunit="'+l+'" english="" metric="">'+h.convertTempIntoUnits(l,p.tempf)+"</span> &deg;"+h.getTempUnits(l);f.html(e)}}if(!o&&p.id){var r=this;m.bind("click",function(){r.getDetails(p.id)})}return m};wundermap.layers.WeatherStations.getTableFootContent=function(d,f){var e=a("<tr></tr>");var c=a('<td colspan="3" class="darkFooter brBot10"><a href="/weatherstation/" target="new">About Personal Weather Stations</a></td>');e.append(c);return e};wundermap.layers.WeatherStations.getPrefs=function(c){return{mode:this.getElementsValue("iconmode","radiogroup",this.options_.mode),opa:this.getElementValue("opacity_slider","slider","50"),bcdgtemp:this.getElementValue("ShowHideBCDGTEMP","checkbox",this.options_.bcdgtemp),rf:this.getElementValue("rapidfire","checkbox",this.options_.rapidfire)}};wundermap.layers.WeatherStations.rapidfire={delay:5*1000,timer:null,repeat:false,initialized:false};wundermap.layers.WeatherStations.rapidfire.initialize=function(){this.initialized=true;wui.rapidfire.setOptions({repeat:false})};wundermap.layers.WeatherStations.rapidfire.getStations=function(){var d=wundermap.layers.WeatherStations;var c=d.markerlayers_[0].markerarray_;var f=[];for(var e in c){f.push(e);c[e].setOptions({optimized:false})}return f};wundermap.layers.WeatherStations.rapidfire.getURL=function(){var d={station:this.getStations().join(","),format:"js",maxage:10,rand:new Date().getTime()};var c="http://stationdata.wunderground.com/cgi-bin/stationlookup";c+="?"+a.param(d);return c};wundermap.layers.WeatherStations.rapidfire.start=function(){if(!this.initialized){this.initialize()}var c=this;this.stop();this.repeat=true;this.timer=window.setTimeout(function(){var d=wundermap.layers.WeatherStations.markerlayers_[0].getDisabled();if(d||wundermap.status.animating){c.start()}else{c.refresh()}},this.delay)};wundermap.layers.WeatherStations.rapidfire.stop=function(){if(this.timer){window.clearTimeout(this.timer)}this.repeat=false;this.timer=null};wundermap.layers.WeatherStations.rapidfire.refresh=function(){var c=this.getURL();a.getScript(c)};wundermap.layers.WeatherStations.rapidfire.drawData=function(f){var e=wundermap.layers.WeatherStations;var h=e.markerlayers_[0];var k=e.getElementsValue("iconmode","radiogroup",e.options_.mode);for(var l in f){var g=f[l];if(!g.type){continue}g.id=l;if("dewpointf" in g){g.dewptf=g.dewpointf;delete g.dewpointf}if("lu" in g){g.updated=g.lu}var c=e.markerlayers_[0].getMarker(l);var d={station:g,marker:c};e.drawStation(null,h,k,d)}wui.rapidfire.CondsLoaded(f);if(this.repeat){this.start()}};window.CondsLoaded=function(c){wundermap.layers.WeatherStations.rapidfire.drawData(c)};wundermap.layers.Ski=new wundermap.Layer();wundermap.layers.Ski.className="Ski";wundermap.layers.Ski.initialize=function(f,c){var e={name:"ski",sidebarPrefix:"LayerSki",hour:0,type:""};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);this.key_="ski";this.addImageLayer({fn_getURL:a.proxy(this.getURLPowder,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLPowderEU,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),getURL_opts:{hasDetailedResults:true},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.addOpacityListener([0,1]);var d=b(this.findId("epoch").text())*1000;this.addSliderListener("hour",{min:0,max:96,step:24,value:this.options_.hour});this.addElementsListeners("type","click");this.setElementsValue("type","radiogroup",this.options_.type)};wundermap.layers.Ski.getURLPowder=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,model:"SNLR",script:"SNLR"+this.getElementsValue("type","checkboxgroup",""),hour:this.getElementValue("hour_slider","slider","0"),modelrun:"0000000000"};var d="http://modelmaps.wunderground.com/php/run.php";d+="?"+a.param(g);return d};wundermap.layers.Ski.getURLPowderEU=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,model:"RPM_SNLR",script:"SNLR"+this.getElementsValue("type","checkboxgroup",""),hour:this.getElementValue("hour_slider","slider","0"),modelrun:"0000000000"};var d="http://modelmaps.wunderground.com/php/run.php";d+="?"+a.param(g);return d};wundermap.layers.Ski.getPrefs=function(){return{opa:this.getElementValue("opacity_slider","slider",null),hour:this.getElementValue("hour_slider","slider",null),mode:this.getElementsValue("type","radiogroup",null)}};wundermap.layers.Ski.getMarkerTitle=function(c){return c.name};wundermap.layers.Ski.getClusterTitle=function(c){return c.clustercount+" ski locations near here"};wundermap.layers.Ski.getBalloonContent=function(e){var d='<div class="'+this.className+'Balloon">';d+='<div class="infobox-title">'+e.name+"</div>";d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';for(var c in e){if(a.inArray(c,["name","rect"])>-1){continue}d+="<tr><td>"+c+":</td><td>"+e[c]+"</td></tr>"}d+="</table>";d+="</div>";return d};wundermap.layers.RideTheStorm=new wundermap.Layer();wundermap.layers.RideTheStorm.className="RideTheStorm";wundermap.layers.RideTheStorm.initialize=function(e,c){var d={name:"mitsubishi",sidebarPrefix:"LayerRideTheStorm"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="mitsubishi";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.RideTheStorm.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.DATEUTC.lt":wui.date.strftime("%Y-%m-%d %H:00:00",wundermap.date,true)};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.RideTheStorm.getMarkerTitle=function(c){return c.DATEUTC};wundermap.layers.RideTheStorm.getImagemapAreasHref=function(e,d,c){return"javascript:wundermap.layers."+this.className+".getDetails(['"+e.id+"','"+e.DATEUTC+"'],0)"};wundermap.layers.RideTheStorm.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.ID="+e[0]+"&id.DATEUTC="+e[1];return c};wundermap.layers.Traffic=new wundermap.Layer();wundermap.layers.Traffic.className="Traffic";wundermap.layers.Traffic.initialize=function(f,c){var e={name:"tfk",sidebarPrefix:"LayerTraffic"};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);var d=new google.maps.TrafficLayer();google.maps.event.addListener(this,"layertoggled",function(g){if(g){d.setMap(this.map_)}else{d.setMap(null)}})};wundermap.layers.ModelData=new wundermap.Layer();wundermap.layers.ModelData.className="ModelData";wundermap.layers.ModelData.initialize=function(f,d){var e={name:"mm",sidebarPrefix:"LayerModelData",timelord:{text:"from present until 378 hours in the future",showTooltip:true,triggerRefresh:false,max:wundermap.utils.createDateFunction(378,"hour")},title:"Model Data",opacity:70,maxClkObjects:10,subdomain:"",model:"GFS",maptype:"500",hour:"0",modelrun:"node_0",showTimestamp:true};d=a.extend(true,{},e,d);wundermap.Layer.prototype.initialize.call(this,f,d);var c=this;this.addSliderListener("hour",{min:0,max:0,value:this.options_.hour,slide:function(g,h){c.handleHourMoveChange(h.value)},change:function(g,h){c.handleHourMoveChange(h.value);c.handleHourMoveComplete(h.value)}});this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.setDisabled(true);this.addOpacityListener();this.periodEpochs=[];this.modelrunEpoch=0;this.hourEpoch=0;this.hourEpochSave=null;this.hourStringSave=null;this.config=null;this.requestConfigInterval=600*1000;this.requestConfigLastUpdate=null;this.clickBehavior="0";this.clkObjects=[];this.clkListeners=[];this.incompleteCrossSection=-1;this.isDraggingMarker=0;this.numClkObjects=0;this.elt_buttonProfile=this.findId("buttonProfile");this.elt_buttonCrossSection=this.findId("buttonCrossSection");this.hasClickButtons=!!(this.elt_buttonProfile[0]&&this.elt_buttonCrossSection[0]);if(this.options_.showTimestamp){wundermap.addHTMLControl({container:a('<div id="'+this.sidebarPrefix_+'_date" class="'+this.sidebarPrefix_+'_maptitle"></div>'),index:3,position:google.maps.ControlPosition.TOP_LEFT,styles:{display:"none",margin:"5px",width:"auto"}})}google.maps.event.addListener(this,"layertoggled",function(g){if(g){c.checkRequestConfig();a(document).bind("keydown."+c.sidebarPrefix_,function(k){c.handleKeystroke(k)});var h=(c.config==null);if(!h){c.handleConfigSuccess()}if(!c.disabled_&&!c.disabled_by_timelord_){c.findId("date").show()}}else{a(document).unbind("."+c.sidebarPrefix_);c.closePopouts();c.removeClkObjects();c.findId("date").hide();if(c.hasClickButtons){c.setClickBehavior("0")}}})};wundermap.layers.ModelData.custom_check_dates=function(g){if(!g){return}var e=this.findId("hour_slider");var f=g.getTime()/1000;var c=wundermap.utils.indexOfClosest(this.periodEpochs,f);if(c>=0){e.slider("value",c)}else{this.hourEpoch=f}};wundermap.layers.ModelData.getPrefs=function(c){var d={mdl:this.getModel(),type:this.getMaptype(),hour:this.getHour(),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)};return d};wundermap.layers.ModelData.getURL=function(k,m,f,l,e,n,c){var g={maxlat:k,maxlon:m,minlat:f,minlon:l,width:e,height:n,model:this.getModel(),script:this.getMaptype(),hour:this.getHour(),modelrun:this.getModelrunInitReadable()};this.findId("date").show().text(this.hourStringSave);var h=this.options_.subdomain||"modelmaps";var d="http://"+h+".wunderground.com/php/run.php?"+a.param(g);return d};wundermap.layers.ModelData.getURLConfig=function(){var c="/stationmaps/gmap_modeldata.asp";if(this.options_.subdomain){c+="?server="+this.options_.subdomain}return c};wundermap.layers.ModelData.requestConfig=function(){var d=this.getURLConfig();var c=this;a.ajax({url:d,dataType:"json",success:function(f,e){var g=(c.config==null);c.config=f;if(!f){google.maps.event.trigger(c,"loaderror","empty or invalid config file")}else{if(f.ERROR){google.maps.event.trigger(c,"loaderror","error reading config file: "+jsonObj.ERROR)}else{c.handleConfigSuccess({firstTime:g,refresh:true})}}},error:function(h,f,g){google.maps.event.trigger(c,"loaderror","failed to load config file")}});if(this.debug_>0){wui.log(d)}};wundermap.layers.ModelData.handleConfigSuccess=function(c){var c=c||{};this.requestConfigLastUpdate=new Date();this.setDisabled(true);if(c.firstTime){this.populateModelOptions();this.populateMaptypeOptions()}this.populateModelrunOptions();this.populateHourOptions({firstTime:c.firstTime});if(this.disabled_by_timelord_){this.disabled_=false}else{this.setDisabled(false)}if(c.refresh){this.refresh()}};wundermap.layers.ModelData.checkRequestConfig=function(){if(!this.initialized_){return}var c=new Date();if(!this.requestConfigLastUpdate||this.requestConfigLastUpdate.getTime()<c.getTime()-10*60*1000){this.requestConfig()}};wundermap.layers.ModelData.refresh=function(c){this.checkRequestConfig();wundermap.Layer.prototype.refresh.call(this,c)};wundermap.layers.ModelData.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var d=this.findId("model")[0];if(d){var f=google.maps.event.addDomListener(d,"change",function(){c.populateMaptypeOptions();c.populateModelrunOptions();c.populateHourOptions({useSaved:true})});this.listeners_.push(f)}var d=this.findId("maptype")[0];if(d){var f=google.maps.event.addDomListener(d,"change",function(){c.updateMaptypeDescription();google.maps.event.trigger(c,"settings_changed");c.refresh()});this.listeners_.push(f)}var d=this.findId("modelrun")[0];if(d){var f=google.maps.event.addDomListener(d,"change",function(){c.modelrunEpoch=c.getModelrunInitEpoch();c.populateHourOptions({useSaved:true})});this.listeners_.push(f)}this.animateStart=this.findId("animate_start");this.animateStop=this.findId("animate_stop");var e=this.findId("hour_slider");if(this.animateStart[0]&&this.animateStop[0]&&e[0]){var f=google.maps.event.addDomListener(this.animateStart[0],"click",function(){c.setAnimationLoopToggle(true)});this.listeners_.push(f);var f=google.maps.event.addDomListener(this.animateStop[0],"click",function(){c.setAnimationLoopToggle(false)});this.listeners_.push(f)}var f=google.maps.event.addListener(this.map_,"click",function(g){c.handleMapClick(g)});this.listeners_.push(f);var f=google.maps.event.addListener(this,"tabsshow",function(g){var h=g.panel.id;if(h==c.sidebarPrefix_+"_displayArea"){c.setClickBehavior("1")}else{if(h==c.sidebarPrefix_+"_displayArea2"){c.setClickBehavior("2")}else{c.setClickBehavior("0")}}});this.listeners_.push(f);if(this.hasClickButtons){var f=google.maps.event.addDomListener(this.elt_buttonProfile[0],"click",function(){if(a(this).hasClass(wundermap.classNames.selected)){c.setClickBehavior("0")}else{c.setClickBehavior("1")}});this.listeners_.push(f);var f=google.maps.event.addDomListener(this.elt_buttonCrossSection[0],"click",function(){if(a(this).hasClass(wundermap.classNames.selected)){c.setClickBehavior("0")}else{c.setClickBehavior("2")}});this.listeners_.push(f)}var f=google.maps.event.addListener(this.map_,"mousemove",function(h){if(this.disabled_||this.disabled_by_timelord_){return}if(c.clickBehavior=="2"&&c.incompleteCrossSection>=0&&!c.isDraggingMarker){var g=c.clkObjects[c.incompleteCrossSection];if(!g||!g.marker1){return}var k=g.marker1.getPosition();var l=h.latLng;c.adjustCrossSectionLine(g,k,l,1);if(!g.line){g.line=c.makeCrossSectionLine(g,l)}}});this.listeners_.push(f);var f=google.maps.event.addDomListener(window,"beforeunload",function(g){c.closePopouts()});this.listeners_.push(f)};wundermap.layers.ModelData.handleMapClick=function(h){var f=h.latLng;var g=this.clkObjects.length;var l=this.options_.maxClkObjects;var k=this.clickBehavior;var n=this;if(this.disabled_||this.disabled_by_timelord_){return}if(this.numClkObjects>=l){if(this.hasClickButtons){this.clickBehavior="0"}google.maps.event.trigger(this,"loaderror","Maximum of "+l+" profiles or cross sections at a time, please close some to continue.");return}else{if(k=="1"){this.numClkObjects++;var m="Skew-T: "+(g+1);var d={marker1:new google.maps.Marker({clickable:true,draggable:true,map:this.map_,position:f,raiseOnDrag:false,title:m}),index:g,container:a("<p></p>"),img:a("<img></img>"),isLoaded:false,popout:null,popoutUrl:"",popoutImg:null,type:"profile"};this.clkObjects[g]=d;google.maps.event.addListener(d.marker1,"dragend",function(o){n.profileRequest(d)});this.profileRequest(d);if(this.hasClickButtons){this.setClickBehavior("0")}}else{if(k=="2"&&this.incompleteCrossSection>=0){this.numClkObjects++;var c=this.clkObjects[this.incompleteCrossSection];var m="Cross Section: "+(c.index+1);c.marker2=new google.maps.Marker({clickable:true,draggable:true,map:this.map_,position:f,raiseOnDrag:false,title:m});this.snapToLine(c.marker1,c.marker2);if(!c.line){c.line=this.makeCrossSectionLine(c)}google.maps.event.addListener(c.marker1,"dragend",function(o){n.crossSectionDragEnd(c,1)});google.maps.event.addListener(c.marker2,"dragend",function(o){n.crossSectionDragEnd(c,2)});google.maps.event.addListener(c.marker1,"drag",function(o){var p=c.marker2.getPosition();n.adjustCrossSectionLine(c,p,o.latLng,0)});google.maps.event.addListener(c.marker2,"drag",function(o){var p=c.marker1.getPosition();n.adjustCrossSectionLine(c,p,o.latLng,1)});this.incompleteCrossSection=-1;this.isDraggingMarker=0;this.crossSectionRequest(c);if(this.hasClickButtons){this.setClickBehavior("0")}}else{if(k=="2"){var m="Cross Section: "+(g+1);var c={marker1:new google.maps.Marker({clickable:true,draggable:true,map:this.map_,position:f,raiseOnDrag:true,title:m}),marker2:null,line:null,index:g,container:a("<p></p>"),img:a("<img></img>"),isLoaded:false,popout:null,popoutUrl:"",popoutImg:null,type:"crossSection"};this.clkObjects[g]=c;this.incompleteCrossSection=g;google.maps.event.addListener(c.marker1,"dragstart",function(o){if(n.incompleteCrossSection==g){n.isDraggingMarker=1;if(c.line){c.line.setMap(null);c.line=null}}});google.maps.event.addListener(c.marker1,"dragend",function(o){n.isDraggingMarker=0})}}}}};wundermap.layers.ModelData.setAnimationLoopToggle=function(c){if(this.disabled_||this.disabled_by_timelord_){return}this.setAnimateToggle(c);var e=1000;if(this.animateTimer){window.clearTimeout(this.animateTimer);this.animateTimer=null}if(c){var d=this;var f=this.findId("hour_slider");this.animateTimer=window.setInterval(function(){if(d.loading_||d.disabled_||d.disabled_by_timelord_||!d.active_){window.clearTimeout(d.animateTimer);d.animateTimer=null;return}var h=f.slider("value");var g=f.slider("option","max");h=(h<g)?(h+1):0;f.slider("value",h)},e)}};wundermap.layers.ModelData.populateModelOptions=function(){var h=this.findId("model");for(var e in this.config.MODEL){var d=e;var g=d;var f=(d==this.options_.model)?true:false;var c=new Option(g,d,f,f);h[0].options[h[0].length]=c}};wundermap.layers.ModelData.populateMaptypeOptions=function(){var e=this.findId("maptype");var h=this.getModel();var f=this.getMaptype();var c=this.config.MODEL[h].MAP;e[0].length=0;this.maptypeKeyLookup={};for(var g in c){var m=c[g].key;var l=c[g].abbreviation||m;var k=(m==f)?true:false;var d=new Option(l,m,k,k);e[0].options[e[0].length]=d;this.maptypeKeyLookup[m]=g}this.updateMaptypeDescription()};wundermap.layers.ModelData.populateModelrunOptions=function(){var e=this.findId("modelrun");var g=this.getModel();var d=this.config.MODEL[g].modelrun;var v=this.modelrunEpoch;var k=-1;var o=false;var p=0;var r=[];for(var l in d){var w=d[l];if(w.initialization&&w.initialization.epoch){r.push({key:l,value:w})}else{var f="Missing initialization.epoch for "+g+" modelrun: "+l;google.maps.event.trigger(this,"loaderror",f)}}r.sort(function(z,y){return b(z.value.initialization.epoch)-b(y.value.initialization.epoch)});r.reverse();if(v){var n=[];for(var q=0;q<r.length;q++){n.push(b(r[q].value.initialization.epoch,10))}k=wundermap.utils.indexOfClosest(n,v)}e[0].length=0;for(var q=0;q<r.length;q++){var t=r[q].value.initialization.epoch;var h=r[q].value.finished;if(h!="1"){o=true;p+=1}var s=false;if(k>=0){if(q==k){s=true}}else{if(q==p){s=true}}var u=wui.date.strftime("%a, %d %b, %H:%M GMT",new Date(t*1000),true);var x=u;var c=new Option(x,r[q].key,s,s);e[0].options[e[0].length]=c}this.modelrunEpoch=this.getModelrunInitEpoch();var m=this.findId("unfinished");if(o){m.html("unfinished modelrun available")}else{m.empty()}};wundermap.layers.ModelData.populateHourOptions=function(d){var d=d||{};var s=d.useSaved||false;var c=d.firstTime||false;var n=this.getModel();var f=this.getModelrun();var m=this.config.MODEL[n].modelrun[f];if(!m){google.maps.event.trigger(this,"loaderror","invalid modelrun name: "+f);return}var r=this.hourEpoch;var k=this.hourEpochSave;var o=0;this.periods=[];for(var h in m.period){var p=m.period[h];if(p.exists=="1"){this.periods.push(p)}}this.periods.sort(function(u,t){return b(u.period)-b(t.period)});this.periodEpochs=[];for(var h in this.periods){var p=this.periods[h];this.periodEpochs.push(parseInt(p.valid,10))}if(s&&this.hourEpochSave){o=wundermap.utils.indexOfClosest(this.periodEpochs,this.hourEpochSave)}else{if(r){o=wundermap.utils.indexOfClosest(this.periodEpochs,r)}else{if(c){var q=this.options_.hour;q=parseInt(q,10);if(q>0){for(var l=0;l<this.periods.length;l++){if(this.periods[l].hour==q){o=l;break}}}}}}var e=this.findId("hour_slider");var g=this.getElementValue("hour_slider","slider",this.options_.hour);e.slider("option","max",this.periods.length-1);e.slider("value",o);if(o==g){}if(s){if(k){this.hourEpochSave=k}else{this.hourEpochSave=r}}};wundermap.layers.ModelData.calculateHour=function(c){try{this.hour=parseInt(this.periods[c].hour,10)}catch(d){this.hour=0}};wundermap.layers.ModelData.getHourString=function(g,f){try{this.hourEpoch=parseInt(this.periods[g].valid,10);var h=this.hourEpoch;var f=f||{};var c=(f.local!==true);var d=wui.date.strftime("%a, %d %b, %H:%M GMT",new Date(h*1000),c);return d}catch(k){return"unknown"}};wundermap.layers.ModelData.getModelrunInitReadable=function(){try{var c=this.getModel();var g=this.getModelrun();var d=this.config.MODEL[c].modelrun[g];return d.initialization.readable}catch(f){return"0"}};wundermap.layers.ModelData.getModelrunInitEpoch=function(){try{var c=this.getModel();var g=this.getModelrun();var d=this.config.MODEL[c].modelrun[g];return parseInt(d.initialization.epoch,10)}catch(f){return 0}};wundermap.layers.ModelData.handleHourMoveChange=function(d){this.calculateHour(d);var c=this.getHour();this.findId("hour_value").text(c)};wundermap.layers.ModelData.handleHourMoveComplete=function(d){var c=this.getHourString(d,{local:false});this.hourStringSave=c;this.hourEpochSave=null;if(this.active_){if(!this.disabled_&&!this.disabled_by_timelord_){this.findId("date").show().text(c)}google.maps.event.trigger(this,"settings_changed");this.refresh()}};wundermap.layers.ModelData.updateMaptypeDescription=function(){var h=this.findId("title");if(h[0]){var d=this.getModel();var c=this.getMaptype();var g=this.maptypeKeyLookup[c];var f=this.config.MODEL[d].MAP[g];var e=f.description||"no description available";h.text(e)}};wundermap.layers.ModelData.getModel=function(){return this.getElementValue("model","select",this.options_.model)};wundermap.layers.ModelData.getMaptype=function(){return this.getElementValue("maptype","select",this.options_.maptype)};wundermap.layers.ModelData.getModelrun=function(){return this.getElementValue("modelrun","select",this.options_.modelrun)};wundermap.layers.ModelData.getHour=function(){if(this.hour||this.hour===0){return b(this.hour)}else{return 0}};wundermap.layers.ModelData.handleKeystroke=function(x){try{var l=74;var m=76;var s=65;var f=68;var w=73;var u=75;var h=87;var p=83;var k=82;var o=70;var c=x.target.nodeName.toLowerCase();if(c=="input"||c=="textarea"){return}if(x.altKey||x.ctrlKey||x.metaKey||x.shiftKey){return}var t=this.findId("hour_slider");if(x.which==l){var y=t.slider("value");t.slider("value",y-1)}else{if(x.which==m){var y=t.slider("value");t.slider("value",y+1)}else{if(x.which==s){var v=this.hourEpoch-86400;var r=wundermap.utils.indexOfClosest(this.periodEpochs,v);t.slider("value",r)}else{if(x.which==f){var v=this.hourEpoch+86400;var r=wundermap.utils.indexOfClosest(this.periodEpochs,v);t.slider("value",r)}else{if(a.inArray(x.which,[w,u,h,p,k,o])>-1){var d=null;if(a.inArray(x.which,[k,o])>-1){d=this.findId("model")}else{if(a.inArray(x.which,[w,u])>-1){d=this.findId("maptype")}else{if(a.inArray(x.which,[h,p])>-1){d=this.findId("modelrun")}}}var n=d[0].selectedIndex;var g=0;if(a.inArray(x.which,[k,w,h])>-1){g=wundermap.utils.limit(n-1,0,d[0].length-1)}else{g=wundermap.utils.limit(n+1,0,d[0].length-1)}if(n!=g){d[0].selectedIndex=g;google.maps.event.trigger(d[0],"change")}}}}}}}catch(q){google.maps.event.trigger(this,"loaderror",'error capturing keystroke: "'+x.key+'" ('+q.message+")")}};wundermap.layers.ModelData.determinePositionsLayout=function(e,c){var d=google.maps.geometry.spherical.computeHeading(e,c);if((d>45&&d<135)||(d>225&&d<315)||(d<-45&&d>-135)){return 1}else{return -1}};wundermap.layers.ModelData.adjustCrossSectionLine=function(d,f,g,c){var e=this.determinePositionsLayout(f,g);if(e>0){g=new google.maps.LatLng(f.lat(),g.lng())}else{g=new google.maps.LatLng(g.lat(),f.lng())}if(d.line){d.line.getPath().removeAt(c);d.line.getPath().insertAt(c,g)}};wundermap.layers.ModelData.profileDragEnd=function(c){this.profileRequest(c)};wundermap.layers.ModelData.crossSectionDragEnd=function(d,c){if(c==1){this.snapToLine(d.marker2,d.marker1)}else{if(c==2){this.snapToLine(d.marker1,d.marker2)}}d.line.setMap(null);d.line=null;d.line=this.makeCrossSectionLine(d);this.crossSectionRequest(d)};wundermap.layers.ModelData.snapToLine=function(e,d){var g=e.getPosition();var h=d.getPosition();var f=this.determinePositionsLayout(g,h);if(f>0){var c=new google.maps.LatLng(g.lat(),h.lng())}else{var c=new google.maps.LatLng(h.lat(),g.lng())}d.setPosition(c)};wundermap.layers.ModelData.profileRequest=function(g){google.maps.event.trigger(this,"loadstart");var f=850/4;var d=1100/4;var c=600;var h=800;g.img.css("width",f);g.img.css("height",d);var k="http://modelmaps.wunderground.com/php/skewt.php";var l={model:this.getModel(),script:"plotskew",hour:this.getHour(),modelrun:this.getModelrunInitReadable(),maxlat:g.marker1.getPosition().lat(),maxlon:g.marker1.getPosition().lng()};g.popoutUrl=k+"?"+a.param(l)+"&width="+c+"&height="+h;var e=k+"?"+a.param(l)+"&width="+f+"&height="+d;if(this.debug_>0){wui.log(e)}this.showDisplayAreaImage(e,c,h,g);google.maps.event.trigger(this,"loadend")};wundermap.layers.ModelData.crossSectionRequest=function(f){google.maps.event.trigger(this,"loadstart");var g=200;var d=150;var c=800;var h=600;f.img.css("width",g);f.img.css("height",d);var k="http://modelmaps.wunderground.com/php/cross.php";var l={model:this.getModel(),script:"cross",hour:this.getHour(),modelrun:this.getModelrunInitReadable(),maxlat:Math.max(f.marker1.getPosition().lat(),f.marker2.getPosition().lat()),maxlon:Math.max(f.marker1.getPosition().lng(),f.marker2.getPosition().lng()),minlat:Math.min(f.marker1.getPosition().lat(),f.marker2.getPosition().lat()),minlon:Math.min(f.marker1.getPosition().lng(),f.marker2.getPosition().lng())};f.popoutUrl=k+"?"+a.param(l)+"&width="+c+"&height="+h;var e=k+"?"+a.param(l)+"&width="+g+"&height="+d;if(this.debug_>0){wui.log(e)}this.showDisplayAreaImage(e,c,h,f);google.maps.event.trigger(this,"loadend")};wundermap.layers.ModelData.showDisplayAreaImage=function(d,k,f,m){var c=this.elt_displayAreaTab;if(m.type=="crossSection"){if(this.elt_displayAreaTab2[0]){c=this.elt_displayAreaTab2}}var g=!!(c&&c[0]);if(g&&!m.isLoaded){var n=this;var h=m.index;var l=m.index+1;var e=a('<a href="javascript:void(0);">(close)</a>');e.bind("click",function(p){n.closePopout(h);n.removeClkObject(h);google.maps.event.trigger(n,"loadend")});var o=a('<a href="javascript:void(0);">(pop out)</a>');o.bind("click",function(p){if(m.popout){if(window.focus){m.popout.focus()}}else{m.popout=n.popoutImage(k,f,m.index,m.type)}});m.img.bind("click",function(p){o.triggerHandler("click")});m.container.append(l+" ");m.container.append(e);m.container.append(" ");m.container.append(o);m.container.append("<br />");m.container.append(m.img);m.container.addClass(this.sidebarPrefix_+"_thumbContainer");m.container.css("width",m.img.css("width"));c.append(m.container)}if(!m.isLoaded){m.popout=this.popoutImage(k,f,m.index,m.type)}m.isLoaded=true;if(m.popout){if(m.popout.closed||!m.popout.location){m.popout=this.popoutImage(k,f,m.index,m.type)}else{if(m.popoutImg){m.popoutImg.src=m.popoutUrl;if(window.focus){m.popout.focus()}}}}if(g){var n=this;m.img.bind("load",function(){google.maps.event.trigger(n,"loadend")});m.img[0].src=d}};wundermap.layers.ModelData.popoutImage=function(g,c,e,f){var h=this.clkObjects[e];h.popout=window.open("/stationmaps/gmap_popout.asp?index="+e+"&type="+f,e,"width="+g+",height="+c+",resizable=yes,scrollbars=yes");var d=h.popout;if(window.focus){d.focus()}return d};wundermap.layers.ModelData.popoutLoaded=function(d){var f=this.clkObjects[d];google.maps.event.trigger(this,"loadend");var c=f.popout.document.getElementById("canvas");var e=f.popout.document.createElement("img");e.src=f.popoutUrl;c.appendChild(e);f.popoutImg=e};wundermap.layers.ModelData.popoutClosed=function(c){if(this.clkObjects&&this.clkObjects[c]){if(this.elt_displayAreaTab[0]){this.clkObjects[c].popout=null}else{this.removeClkObject(c)}}};wundermap.layers.ModelData.makeCrossSectionLine=function(d,e){var c=[];if(d.marker1){c.push(d.marker1.getPosition())}if(d.marker2){c.push(d.marker2.getPosition())}if(e){c.push(e)}return new google.maps.Polyline({clickable:false,map:this.map_,path:c})};wundermap.layers.ModelData.closePopouts=function(){for(var c=this.clkObjects.length-1;c>=0;c--){this.closePopout(c)}};wundermap.layers.ModelData.closePopout=function(d){if(this.clkObjects[d]){var c=this.clkObjects[d].popout;if(c&&(!c.closed)){c.close();this.clkObjects[d].popout=null}}};wundermap.layers.ModelData.removeClkObjects=function(){for(var c=this.clkObjects.length-1;c>=0;c--){this.removeClkObject(c)}this.incompleteCrossSection=-1;this.isDraggingMarker=0;this.numClkObjects=0};wundermap.layers.ModelData.removeClkObject=function(c){if(this.clkObjects[c]){var d=this.clkObjects[c].marker1;if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null);this.clkObjects[c].marker1=null}var d=this.clkObjects[c].marker2;if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null);this.clkObjects[c].marker2=null}var d=this.clkObjects[c].line;if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null);this.clkObjects[c].line=null}var d=this.clkObjects[c].container;if(d&&d[0]){this.clkObjects[c].container.empty();this.clkObjects[c].container.remove();this.clkObjects[c].container=null}this.clkObjects[c]=null;this.numClkObjects--}};wundermap.layers.ModelData.setClickBehavior=function(c){this.clickBehavior=""+c;this.elt_buttonProfile.toggleClass(wundermap.classNames.selected,c==="1");this.elt_buttonCrossSection.toggleClass(wundermap.classNames.selected,c==="2")};wundermap.layers.NDFD=new wundermap.Layer();wundermap.layers.NDFD.className="NDFD";wundermap.layers.NDFD.initialize=function(f,d){var e={name:"ndfd",sidebarPrefix:"LayerNDFD",title:"U.S. Forecast",opacity:70,hour:"0",variable:"temp"};d=a.extend(true,{},e,d);wundermap.Layer.prototype.initialize.call(this,f,d);var c=this;this.addOpacityListener();this.addSliderListener("hour",{min:0,max:0,value:this.options_.hour,slide:function(g,h){c.handleHourMoveChange(h.value)},change:function(g,h){c.handleHourMoveChange(h.value);c.handleHourMoveComplete(h.value)}});this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.setDisabled(true);this.periodEpochs=[];this.modelrunEpoch=0;this.hourEpoch=0;this.hourEpochSave=null;this.config=null;this.requestConfigInterval=600*1000;this.requestConfigLastUpdate=null;google.maps.event.addListener(this,"layertoggled",function(g){if(g){c.checkRequestConfig();a(document).bind("keydown."+c.sidebarPrefix_,function(h){c.handleKeystroke(h)})}else{a(document).unbind("."+c.sidebarPrefix_)}})};wundermap.layers.NDFD.getPrefs=function(c){var d={"var":this.getVariable(),hour:this.getHour(),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)};return d};wundermap.layers.NDFD.getURL=function(l,o,f,m,e,r,c){var h=this.getHour();var g=this.getVariable();var q=this.config.ndfdimagery[g].info.changeperiod-1;var p=this.config.ndfdimagery[g].info.changefactor;h++;var n=h;if(h>=q){n=(q+(h-q)*p)}if(g=="wx"){var d="http://modelmaps.wunderground.com/cgi-bin/mapgen?"+a.param({minlat:f,minlon:m,maxlat:l,maxlon:o,size:e+"x"+r,theme:"wx",proj:"automerc",format:"gif",alpha:"1",stdout:"1",data:"TPR_exp_wx"+b(h+1),rand:Math.floor((new Date()).getTime()/60000)})}else{var k=this.options_.subdomain||"modelmaps";var d="http://"+k+".wunderground.com/php/ndfd.php?"+a.param({maxlat:l,maxlon:o,minlat:f,minlon:m,width:e,height:r,script:"NDFD_"+g,model:"NDFD",hour:n,rand:Math.floor((new Date()).getTime()/60000)})}return d};wundermap.layers.NDFD.getURLConfig=function(){var c="/stationmaps/gmap_NDFD.asp";return c};wundermap.layers.NDFD.requestConfig=function(){var d=this.getURLConfig();var c=this;a.ajax({url:d,dataType:"json",success:function(f,e){var g=(c.config==null);c.config=f;if(!f){google.maps.event.trigger(c,"loaderror","empty or invalid config file")}else{if(f.ERROR){google.maps.event.trigger(c,"loaderror","error reading config file: "+jsonObj.ERROR)}else{c.requestConfigLastUpdate=new Date();c.populateHourOptions({firstTime:g});c.setDisabled(false);c.refresh()}}},error:function(h,f,g){google.maps.event.trigger(c,"loaderror","failed to load config file")}})};wundermap.layers.NDFD.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var f=document.getElementsByName(this.sidebarPrefix_+"_var");for(var d=0;d<f.length;d++){var e=google.maps.event.addDomListener(f[d],"click",function(){c.populateHourOptions()});this.listeners_.push(e)}};wundermap.layers.NDFD.getVariable=function(){return this.getElementsValue("var","radiogroup",this.options_.variable)};wundermap.layers.NDFD.handleKeystroke=function(h){try{var c=74;var g=76;var l=h.target.nodeName.toLowerCase();if(l=="input"||l=="textarea"){return}var d=this.findId("hour_slider");if(h.which==c){var k=d.slider("value");d.slider("value",k-1)}else{if(h.which==g){var k=d.slider("value");d.slider("value",k+1)}}}catch(f){google.maps.event.trigger(this,"loaderror",'error capturing keystroke: "'+h.key+'" ('+f.message+")")}};wundermap.layers.NDFD.populateHourOptions=function(){var e=this.getVariable();if(!e){google.maps.event.trigger(this,"loaderror","missing variable name from getVariable()");return}var d=0;var k=this.config.ndfdimagery[e].periods;var h=0;for(var c in k){h++}var g=this.findId("hour_slider");var f=this.getElementValue("hour_slider","slider",this.options_.hour);g.slider("option","max",h-1);g.slider("value",d);if(d==f){this.handleHourMoveChange(d);this.handleHourMoveComplete(d)}};wundermap.layers.NDFD.getHourString=function(f,c){try{var g=this.getVariable();var l=this.config.ndfdimagery;var h=f+1;this.hourEpoch=parseInt(l[g].periods["node_"+h].us.epochvalid,10);var d=this.hourEpoch;var c=c||{};var n=(c.local!==true);var m=wui.date.strftime("%a, %d %b, %H:%M GMT",new Date(d*1000),n);return m}catch(k){return"unknown"}};wundermap.layers.NDFD.handleHourMoveChange=function(d){this.hour=d;var c=this.getHourString(d,{local:false});this.findId("hour_value").text(c)};wundermap.layers.NDFD.handleHourMoveComplete=wundermap.layers.ModelData.handleHourMoveComplete;wundermap.layers.NDFD.checkRequestConfig=wundermap.layers.ModelData.checkRequestConfig;wundermap.layers.NDFD.refresh=wundermap.layers.ModelData.refresh;wundermap.layers.NDFD.getHour=wundermap.layers.ModelData.getHour;wundermap.layers.Fire=new wundermap.Layer();wundermap.layers.Fire.className="Fire";wundermap.layers.Fire.initialize=function(g,d){var f={name:"fire",sidebarPrefix:"LayerFire",title:"Fire",timelord:{text:"from 7 days ago until present",showTooltip:true,min:wundermap.utils.createDateFunction(-7,"day")},clickable:true,opacity:100,sat:"1",smk:"1",perim:"1",mode:"0"};d=a.extend(true,{},f,d);wundermap.Layer.prototype.initialize.call(this,g,d);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLPerimeters,this)});this.addMarkerLayer({fn_getURL:a.proxy(this.getURLSmoke,this),ajaxOptions:{},ignoreEvents:["idle"],fn_getURLDataCallback:a.proxy(this.drawSmoke,this)});this.addMarkerLayer({fn_getURL:a.proxy(this.getURLPerimetersCenters,this),ajaxOptions:{},ignoreEvents:["idle"],fn_getURLDataCallback:a.proxy(this.drawPerimeters,this)});this.setElementValue("sat","checkbox",this.options_.sat);this.setElementValue("smk","checkbox",this.options_.smk);this.setElementValue("perim","checkbox",this.options_.perim);this.setElementsValue("mode","radiogroup",this.options_.mode);this.addElementsListeners("mode","click");this.addOpacityListener([1]);var c=this.getPrefs();var e=wundermap.utils.isCheckedValue(c.sat);this.imagelayers_[0].setDisabled(!e);var e=wundermap.utils.isCheckedValue(c.smk);this.markerlayers_[0].setDisabled(!e);var e=wundermap.utils.isCheckedValue(c.perim);this.imagelayers_[1].setDisabled(!e);this.markerlayers_[1].setDisabled(!e)};wundermap.layers.Fire.getPrefs=function(c){var d={sat:this.getElementValue("sat","checkbox",this.options_.sat)?"1":"0",smk:this.getElementValue("smk","checkbox",this.options_.smk)?"1":"0",perim:this.getElementValue("perim","checkbox",this.options_.perim)?"1":"0",mode:this.getElementsValue("mode","radiogroup",this.options_.mode),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)};return d};wundermap.layers.Fire.getURL=function(h,m,f,l,e,n,c){var k=this.getElementsValue("mode","radiogroup",this.options_.mode);this.key_=(k=="0")?"firenorthamerica":"fireglobal";var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.date.btw":wui.date.strftime("%Y-%m-%d 00:00:00,%Y-%m-%d 23:59:59",wundermap.date,true)};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.Fire.getURLPerimeters=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"fire",proj:"automerc",format:"gif",alpha:"1",stdout:"1",rand:(new Date()).getUTCDate()};var d="http://wumaps.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.Fire.getURLPerimetersCenters=function(d,g,f,h,k,c,l){var e="/stationmaps/gmap_fire.asp";return e};wundermap.layers.Fire.getURLSmoke=function(g,m,f,k,e,n,c){var h=new Date(wundermap.date.getTime());h.setDate(h.getDate()-1);var l=wui.date.strftime("%Y%m%d",h,true);var d="/stationmaps/gmap_smoke.asp?date="+l;return d};wundermap.layers.Fire.getMarkerTitle=function(c){return"Fire detected by "+c.satellite};wundermap.layers.Fire.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var n=this;var f=document.getElementById(this.sidebarPrefix_+"_sat");var l=document.getElementById(this.sidebarPrefix_+"_sat_mode");var m=this.imagelayers_[0];if(f){var d=google.maps.event.addDomListener(f,"click",function(){if(l){if(f.checked){a(l).removeClass("none")}else{a(l).addClass("none")}}if(m){m.setDisabled(!f.checked);m.refresh();n.removeDataTable(0)}google.maps.event.trigger(n,"settings_changed")});this.listeners_.push(d)}var k=document.getElementById(this.sidebarPrefix_+"_perim");var g=this.imagelayers_[1];var h=this.markerlayers_[1];if(k){var d=google.maps.event.addDomListener(k,"click",function(){if(g){g.setDisabled(!k.checked);g.refresh()}if(h){h.setDisabled(!k.checked);h.refresh();n.removeDataTable(1)}google.maps.event.trigger(n,"settings_changed")});this.listeners_.push(d)}var e=document.getElementById(this.sidebarPrefix_+"_smk");var c=this.markerlayers_[0];if(e&&c){var d=google.maps.event.addDomListener(e,"click",function(){c.setDisabled(!e.checked);c.refresh();google.maps.event.trigger(n,"settings_changed")});this.listeners_.push(d)}};wundermap.layers.Fire.drawSmoke=function(k){var r=this.markerlayers_[0];r.removeOverlays();if(!k||!k.SHAPEFILE){google.maps.event.trigger(self,"loaderror","Current smoke data unavailable");return}for(var o in k.SHAPEFILE.POLYGON){var t=k.SHAPEFILE.POLYGON[o];var m=b(t.VERTICIES);var s=b(t.Density);var f=b(t.Start);var g=b(t.End);var e=parseFloat(t.Area);f/=100;g/=100;if(g<f){g+=24}var d=[];var h=0;for(var p in t.node_1){if(h==m){break}var l=t.node_1[p];var n=parseFloat(l.LAT);var c=parseFloat(l.LON);d.push(new google.maps.LatLng(n,c));h++}var q=new google.maps.Polygon({clickable:false,fillColor:"#000000",fillOpacity:(s/100)*2,map:this.map_,paths:d,strokeColor:"#000000",strokeOpacity:0,strokeWeight:1});r.addMarker(q)}};wundermap.layers.Fire.drawPerimeters=function(g){var f=this.markerlayers_[1];f.removeOverlays();if(!g||!g.SHAPEFILE){google.maps.event.trigger(self,"loaderror","Current smoke data unavailable");return}var d=g.SHAPEFILE.POINT;for(var c in d){var e=d[c];this.drawPerimeter(e,f)}this.displayDataTable(d,1,{})};wundermap.layers.Fire.drawPerimeter=function(e,o){var l=!!(this.options_.clickable);var p=new google.maps.MarkerImage(wundermap.options.iconsdomain+"/graphics/wu2/active_fire.png",new google.maps.Size(28,26),null,new google.maps.Point(14,11));var d=e.FIRE_NAME;var n=e.AGENCY;var f=e.DATE;var g=parseFloat(e.ACRES);if(g<100){return}var m=parseFloat(e.node_1.node_0.LAT);var c=parseFloat(e.node_1.node_0.LON);var k=new google.maps.LatLng(m,c);var h=new google.maps.Marker({clickable:l,flat:true,icon:p,map:wundermap.map,position:k,title:d});if(l){var q=this;a.extend(true,e,{name:d,lat:m,lon:c,date:e.DATE});google.maps.event.addListener(h,"click",function(r){wundermap.openInfoBox({content:q.getBalloonContent(e),marker:this})});e.marker=h}o.addMarker(h)};wundermap.layers.Fire.getTableRowContent=function(h){var g=a("<tr></tr>");var f=a("<td></td>").appendTo(g);var e=f.clone().appendTo(g);var d=f.clone().appendTo(g);if(wui.defined(h.ACRES)){f.html('<a href="javascript:void(0);">'+h.FIRE_NAME+"</a>");e.html(parseFloat(h.ACRES));d.html(h.AGENCY)}else{var c=this.getImagemapAreasHref(h,0,false);f.html('<a href="'+c+'">'+h.city+"</a>");e.html(parseFloat(h.lat).toFixed(3));d.html(parseFloat(h.lon).toFixed(3))}return g};wundermap.layers.Fire.getTableHeadContent=function(g,h){var f=a("<tr></tr>");var e=a("<th></th>").appendTo(f);var d=e.clone().appendTo(f);var c=e.clone().appendTo(f);if(g&&wui.defined(g.ACRES)){e.html("Complex Name").attr("title","Sort by Name");d.html("Acres").attr("title","Sort by Acres");c.html("Agency").attr("title","Sort by Agency")}else{e.html("Nearest City").attr("title","Sort by City");d.html("Latitude").attr("title","Sort by Latitude");c.html("Longitude").attr("title","Sort by Longitude")}return f};wundermap.layers.Fire.getTableFootContent=function(d,f){var e=a("<tr></tr>");var c=a('<td colspan="3" class="darkFooter brBot10"><a href="/fire/" target="new">Fire Weather Forecast and Incidents</a></td>');e.append(c);return e};wundermap.layers.Fire.getBalloonContent=function(d){var c='<div class="FireBalloon">';if(d&&wui.defined(d.ACRES)){c+='<div class="infobox-title">Active Fire Perimeter</div>'}else{c+='<div class="infobox-title">Satellite Detected Fire</div>'}c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Location: <span>'+d.name+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(d&&wui.defined(d.ACRES)){c+='<tr><td class="vaT nobr">Acres:</td><td class="full"><span class="b">'+parseFloat(d.ACRES).toFixed(2)+"</span></td></tr>";c+='<tr><td class="vaT nobr">Agency:</td><td class="full"><span class="b">'+d.AGENCY+"</span></td></tr>"}else{c+='<tr><td class="vaT nobr">Fire ID:</td><td class="full"><span class="b">'+d.id+"</span></td></tr>";c+='<tr><td class="vaT nobr">Ecosystem ID:</td><td class="full"><span class="b">'+d.ecosys+"</span></td></tr>";c+='<tr><td class="vaT nobr">Satellite:</td><td class="full"><span class="b">'+d.satellite+"</span></td></tr>";c+='<tr><td class="vaT nobr">Method:</td><td class="full"><span class="b">'+d.method+"</span></td></tr>"}c+="</table>";c+='<div class="tm10"><a href="javascript:wundermap.zoomTo('+parseFloat(d.lat).toFixed(2)+","+parseFloat(d.lon).toFixed(2)+',12)">Zoom in for detailed fire perimeter</a></div>';c+="</div>";c+='<div class="contentFooterPad taC brBot5">Last updated: <span>'+d.date+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+d.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.FireWFAS=new wundermap.Layer();wundermap.layers.FireWFAS.className="FireWFAS";wundermap.layers.FireWFAS.initialize=function(e,c){var d={name:"firewfas",title:"Fire (risk)",sidebarPrefix:"LayerFireWFAS",timelord:{showTooltip:true,text:"from January 2000 until present",min:new Date(Date.UTC(2000,0,3))},mode:"adj"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),ajaxOptions:{dataType:"jsonp"},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.key_="firewfas";this.addElementsListeners("iconmode","click");this.setElementsValue("iconmode","radiogroup",this.options_.mode);this.addLegendListeners("iconmode","radiogroup",this.options_.mode)};wundermap.layers.FireWFAS.getPrefs=function(c){var d={mode:this.getElementsValue("iconmode","radiogroup",this.options_.mode)};return d};wundermap.layers.FireWFAS.addLegendListeners=function(d,e,g){var c=a();var h=a();var f=this.sidebarPrefix_;if(e=="radiogroup"){h=this.elt_options.find("input[name="+f+"_"+d+"]");c=h.map(function(){return document.getElementById(f+"_legend_"+this.value)})}h.click(function(k){c.addClass("none");a("#"+f+"_legend_"+this.value).removeClass("none")});a("#"+f+"_legend_"+g).removeClass("none")};wundermap.layers.FireWFAS.getURL=function(h,m,f,l,e,n,c){var k="obs";var o=new Date();if(o.getFullYear()==wundermap.userdate.getFullYear()&&o.getMonth()==wundermap.userdate.getMonth()&&o.getDate()==wundermap.userdate.getDate()){k="fct"}var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,type:k,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,date:wui.date.strftime("%Y_%m_%d",wundermap.userdate,true),"display.mode":this.getElementsValue("iconmode","radiogroup",this.options_.mode)};var d="http://timelord.wunderground.com/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.FireWFAS.getDetailsURL=function(h,g){var e="obs";var d=new Date();if(d.getFullYear()==wundermap.userdate.getFullYear()&&d.getMonth()==wundermap.userdate.getMonth()&&d.getDate()==wundermap.userdate.getDate()){e="fct"}var f=wui.date.strftime("%Y_%m_%d",wundermap.userdate,true);var c="http://timelord.wunderground.com/cgi-bin/ICONBLAST?key="+this.key_+"&id="+h+"&date="+f+"&type="+e;return c};wundermap.layers.FireWFAS.ucFirstAllWords=function(f){f=f.toLowerCase();var e=f.split(" ");for(var d=0;d<e.length;d++){var c=e[d].charAt(0).toUpperCase();e[d]=c+e[d].substr(1)}return e.join(" ")};wundermap.layers.FireWFAS.getBalloonContent=function(h){var g="N/A";var f="Not Available";switch(h.adj){case"L":g="Low";f="Fuels do not ignite readily from small firebrands although a more intense heat source, such as lightning, may start fires in duff or punky wood. Fires in open cured grasslands may bum freely a few hours after rain, but woods fires spread slowly by creeping or smoldering, and burn in irregular fingers. There is little danger of spotting.";break;case"M":g="Moderate";f="Fires can start from most accidental causes, but with the exception of lightning fires in some areas, the number of starts is generally low. Fires in open cured grasslands will burn briskly and spread rapidly on windy days. Timber fires spread slowly to moderately fast. The average fire is of moderate intensity, although heavy concentrations of fuel, especially draped fuel, may burn hot. Short-distance spotting may occur, but is not persistent. Fires are not likely to become serious and control is relatively easy.";break;case"H":g="High";f="All fine dead fuels ignite readily and fires start easily from most causes. Unattended brush and campfires are likely to escape. Fires spread rapidly and short-distance spotting is common. High-intensity burning may develop on slopes or in concentrations of fine fuels. Fires may become serious and their control difficult unless they are attacked successfully while small.";break;case"V":g="Very High";f="Fires start easily from all causes and, immediately after ignition, spread rapidly and increase quickly in intensity. Spot fires are a constant danger. Fires burning in light fuels may quickly develop high intensity characteristics such as long-distance spotting and fire whirlwinds when they burn into heavier fuels.";break;case"E":g="Extreme";f="Fires start quickly, spread furiously, and burn intensely. All fires are potentially serious. Development into high intensity burning will usually be faster and occur from smaller fires than in the very high fire danger class. Direct attack is rarely possible and may be dangerous except immediately after ignition. Fires that develop headway in heavy slash or in conifer stands may be unmanageable while the extreme burning condition lasts. Under these conditions the only effective and safe control action is on the flanks until the weather changes or the fuel supply lessens.";break}var c="N/A";if(h.kbdi<=200){c="Soil moisture and large class fuel moistures are high and do not contribute much to fire intensity. Typical of spring dormant season following winter precipitation."}else{if(h.kbdi>200&&h.kbdi<=400){c="Typical of late spring, early growing season. Lower litter and duff layers are drying and beginning to contribute to fire intensity."}else{if(h.kbdi>400&&h.kbdi<=600){c="Typical of late summer, early fall. Lower litter and duff layers actively contribute to fire intensity and will burn actively."}else{if(h.kbdi>600&&h.kbdi<=800){c="Often associated with more severe drought with increased wildfire occurrence. Intense, deep burning fires with significant downwind spotting can be expected. Live fuels can also be expected to burn actively at these levels."}}}}var k="N/A";switch(h.stl){case"1":break;case"2":case"3":k="Very Low Potential (Moist Stable Lower Atmosphere)";break;case"4":k="Low Potential";break;case"5":k="Moderate Potential";break;case"6":k="High Potential (Dry Unstable Lower Atmosphere)";break}var e=h.Type;var d='<div class="FireWFASBalloon">';d+='<div class="infobox-title">'+wundermap.layers.FireWFAS.ucFirstAllWords(h.name)+", "+h.state+"</div>";d+='<div class="grt p10">';d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';d+='<tr><td class="nobr">Fire Danger Rating:</td><td>'+g+"<br/>"+f+"</td></tr>";d+='<tr><td class="nobr">Lower Atmosphere Stability:<br />(Haines Index)</td><td>'+h.stl+"<br/>"+k+"</td></tr>";d+='<tr><td class="nobr">Keetch-Byram<br />Drought Index:</td><td>'+h.kbdi+"<br/>"+c+"</td></tr>";d+='<tr><td class="nobr">10-hr Dead Fuel Moisture:</td><td>'+h.ten+"%</td></tr>";d+='<tr><td class="nobr">100-hr Dead Fuel Moisture:</td><td>'+h.hun+"%</td></tr>";d+='<tr><td class="nobr">1000-hr Dead Fuel Moisture:</td><td>'+h.thou+"%</td></tr>";d+="</table>";d+="</div>";d+="</div>";return d};wundermap.layers.InterstateBatteries=new wundermap.Layer();wundermap.layers.InterstateBatteries.className="InterstateBatteries";wundermap.layers.InterstateBatteries.initialize=function(e,c){var d={name:"ib",sidebarPrefix:"LayerInterstateBatteries",title:"Interstate Batteries",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="ib";this.as5000_="FIRE-00107";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.InterstateBatteries.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.InterstateBatteries.getBalloonContentAdsTitle=function(c){return"Interstate Batteries"};wundermap.layers.DunkinDonuts=new wundermap.Layer();wundermap.layers.DunkinDonuts.className="DunkinDonuts";wundermap.layers.DunkinDonuts.initialize=function(e,c){var d={name:"dd",sidebarPrefix:"LayerDunkinDonuts",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="dunkindonuts";this.as5000_="HILL-00091";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.DunkinDonuts.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.DunkinDonuts.getMarkerTitle=function(c){return"Dunkin Donuts in "+c.name};wundermap.layers.DunkinDonuts.getClusterTitle=function(c){return c.clustercount+" Dunkin Donuts locations near here"};wundermap.layers.DunkinDonuts.getBalloonContentAdsTitle=function(c){return"Dunkin Donuts"};wundermap.layers.Mitsubishi=new wundermap.Layer();wundermap.layers.Mitsubishi.className="Mitsubishi";wundermap.layers.Mitsubishi.initialize=function(e,c){var d={name:"mits",sidebarPrefix:"LayerMitsubishi",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="mitsubishidealers";this.as5000_="PHDN-00027";this.as5000image_=wundermap.options.iconsdomain+"/ads/images/mitsubishi_350x190.jpg";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.Mitsubishi.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.Mitsubishi.getMarkerTitle=function(c){return"Mitsubishi Dealership in "+c.name};wundermap.layers.Mitsubishi.getBalloonContentAdsTitle=function(c){return"Mitsubishi Dealership"};wundermap.layers.PepBoys=new wundermap.Layer();wundermap.layers.PepBoys.className="PepBoys";wundermap.layers.PepBoys.initialize=function(e,c){var d={name:"pep",sidebarPrefix:"LayerPepBoys",title:"Pep Boys Auto",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="pepboys";this.as5000_="ICRS-00086";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.PepBoys.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.PepBoys.getMarkerTitle=function(c){return"Pep Boys Auto in "+c.name};wundermap.layers.PepBoys.getBalloonContentAdsTitle=function(c){return"Pep Boys Auto"};wundermap.layers.Extremes=new wundermap.Layer();wundermap.layers.Extremes.className="Extremes";wundermap.layers.Extremes.initialize=function(h,e){var g={name:"extremes",sidebarPrefix:"LayerExtremes",addListeners:1,dateDisplayFormat:"yy-mm-dd",drawTableOpts:null,station_id:"94732",startenddatediff:1,refreshTimeout:360000,sqllimit:500,usedatanodes:1,db:"ncdc",alldates:0,maxt:0,mint:0,lomx:0,himn:0,prcp:0,snow:0,alltime:0,yearly:0,monthly:0,daily:0,storm:0};e=a.extend(true,{},g,e);wundermap.Layer.prototype.initialize.call(this,h,e);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});var d=this;this.key_=this.options_.db;this.station_id_=this.options_.station_id;this.changeBurtOptionsOnFirstDisplay_=1;this.setupDatepickers();var c=wundermap.utils;this.setElementValue("db","radio",this.options_.db);this.setElementValue("alldates","checkbox",this.options_.alldates);this.setElementValue("maxt","checkbox",this.options_.maxt);this.setElementValue("mint","checkbox",this.options_.mint);this.setElementValue("lomx","checkbox",this.options_.lomx);this.setElementValue("himn","checkbox",this.options_.himn);this.setElementValue("prcp","checkbox",this.options_.prcp);this.setElementValue("snow","checkbox",this.options_.snow);this.setElementValue("alltime","checkbox",this.options_.alltime);this.setElementValue("yearly","checkbox",this.options_.yearly);this.setElementValue("monthly","checkbox",this.options_.monthly);this.setElementValue("daily","checkbox",this.options_.daily);this.setElementValue("storm","checkbox",this.options_.storm);this.setWxvarsDefaults();this.setTypesDefaults();this.lastClickedWxvar_=this.options_.wxvars.split(",")[0];this.onChangeDB();this.onChangeAllDates();this.drawTableAjaxRequest();if(this.options_.addListeners){this.addElementsListeners("type","click");this.addElementsListeners("wxvar","click");this.addElementListener("startdate","change");this.addElementListener("enddate","change");this.addElementsListeners("db","change");this.addElementListener("alldates","change");a('input[name="'+this.sidebarPrefix_+'_db"]').bind("change",function(){d.onChangeDB()});a('input[name="'+this.sidebarPrefix_+'_wxvar"]').bind("click",function(){var k=a(this);d.lastClickedWxvar_=k.val();d.onChangeWxvar()});a("#"+this.sidebarPrefix_+"_alldates").bind("click",function(){d.onChangeAllDates()});var f=google.maps.event.addListener(this,"loadstart",function(){a("#"+d.sidebarPrefix_+"_ajax-spinner").removeClass("none")});this.listeners_.push(f);var f=google.maps.event.addListener(this,"loadend",function(){a("#"+d.sidebarPrefix_+"_ajax-spinner").addClass("none")});this.listeners_.push(f)}if(this.options_.drawTableOpts!=null){var f=google.maps.event.addListener(this,"settings_changed",function(){d.drawTableAjaxRequest()});this.listeners_.push(f)}};wundermap.layers.Extremes.setWxvarsDefaults=function(){var c=[];if(this.options_.maxt=="on"||this.options_.maxt==1){c.push("maxt")}if(this.options_.mint=="on"||this.options_.mint==1){c.push("mint")}if(this.options_.himn=="on"||this.options_.himn==1){c.push("himn")}if(this.options_.lomn=="on"||this.options_.lomx==1){c.push("lomn")}if(this.options_.prcp=="on"||this.options_.prcp==1){c.push("prcp")}if(this.options_.snow=="on"||this.options_.snow==1){c.push("snow")}this.options_.wxvars=c.toString();return};wundermap.layers.Extremes.setTypesDefaults=function(){var c=[];if(this.options_.alltime=="on"||this.options_.alltime==1){c.push("alltime")}if(this.options_.yearly=="on"||this.options_.yearly==1){c.push("yearly")}if(this.options_.monthly=="on"||this.options_.monthly==1){c.push("monthly")}if(this.options_.daily=="on"||this.options_.daily==1){c.push("daily")}if(this.options_.storm=="on"||this.options_.storm==1){c.push("storm")}this.options_.types=c.toString();return};wundermap.layers.Extremes.getPrefs=function(){var c=this.getDateRange({startdate:this.getElementValue("startdate","input","01-01-2000"),enddate:this.getElementValue("enddate","input","01-01-2020")}).split(",");return{db:this.getElementsValue("db","radiogroup",this.options_.db),alldates:(this.getElementValue("alldates","checkbox",this.options_.alldates))?"1":"0",maxt:(this.getElementValue("maxt","checkbox",this.options_.maxt))?"1":"0",mint:(this.getElementValue("mint","checkbox",this.options_.mint))?"1":"0",lomx:(this.getElementValue("lomx","checkbox",this.options_.lomx))?"1":"0",himn:(this.getElementValue("himn","checkbox",this.options_.himn))?"1":"0",prcp:(this.getElementValue("prcp","checkbox",this.options_.prcp))?"1":"0",snow:(this.getElementValue("snow","checkbox",this.options_.snow))?"1":"0",alltime:(this.getElementValue("alltime","checkbox",this.options_.alltime))?"1":"0",yearly:(this.getElementValue("yearly","checkbox",this.options_.yearly))?"1":"0",monthly:(this.getElementValue("monthly","checkbox",this.options_.monthly))?"1":"0",daily:(this.getElementValue("daily","checkbox",this.options_.daily))?"1":"0",storm:(this.getElementValue("storm","checkbox",this.options_.storm))?"1":"0",startdate:this.getElementValue("startdate","input",this.options_.startdate),enddate:this.getElementValue("enddate","input",this.options_.enddate)}};wundermap.layers.Extremes.getURL=function(h,l,f,k,e,m,c){this.key_="extremes_"+this.getElementsValue("db","radiogroup",this.options_.db);var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",gmapzoom:this.map_.getZoom(),units:wundermap.options.units||"english"};a.extend(g,this.extendURLParams());var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.Extremes.extendURLParams=function(l){var r="extremes_"+this.getElementsValue("db","radiogroup",this.options_.db);var n=this.getElementsValue("type","checkboxgroup",this.options_.types);var f=this.getElementsValue("wxvar","checkboxgroup",this.options_.wxvars);var g={key:r,"filter.wxvar.any":f,"filter.record_type.any":n};var d=this.getElementValue("alldates","checkbox",this.options_.alldates);if(d){if(this.key_.match("burt")){}else{if(this.key_.match("ncdc")&&!l){a.extend(g,{"filter.iscurrentrecord.eq":1});var k=g["filter.record_type.any"];if(k.match("alltime")){if(g["filter.iscurrentrecord.eq"]==1){g["filter.record_type.any"]="alltime"}else{g["filter.record_type.any"]=""}}}}}else{var c=this.map_.getBounds();if(c){var p=c.getSouthWest();var q=c.getNorthEast();var h=q.lat();var o=q.lng();var e=p.lat();var m=p.lng();if(Math.abs(h-e)>10&&Math.abs(o-m)>10){a.extend(g,{"extend.overview":1})}}a.extend(g,{"filter.date.btw":this.getDateRange({})})}return g};wundermap.layers.Extremes.getDataURL=function(h,l,f,k,e,m,c){this.key_="extremes_"+this.getElementsValue("db","radiogroup",this.options_.db);var g={minlat:-1000,minlon:-1000,maxlat:89.99,maxlon:179.99,width:e,height:m,proj:"me",extension:"js",gmapzoom:this.map_.getZoom(),units:wundermap.options.units||"english"};a.extend(g,this.extendDataURLParams());var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.Extremes.extendDataURLParams=function(){return this.extendURLParams()};wundermap.layers.Extremes.drawTableAjaxRequest=function(){var e=this.options_.drawTableOpts;if(e!=null){var c=this;var d=a("#"+this.sidebarPrefix_+"_"+e.containerid);if(!d){if(wundermap.debug>0){wui.log("No value set for wundermap.layers.Extremes.options_.drawTableOpts.containerid")}}d.html("Loading table...");a.ajax({url:c.getDataURL(90,179,-90,-180,640,480,{}),success:function(f){c.jsonCallback(f.ICONS)},error:function(){google.maps.event.trigger(c,"loaderror","failed to load details for id: "+id)}})}};wundermap.layers.Extremes.jsonCallback=function(d,e,c){var f=[];for(i=0;i<d.length;i++){if(d[i].clusternodes){f=f.concat(d[i].clusternodes)}else{f=f.concat(d[i])}}this.jsonData_=f;var k=wundermap.layers.Extremes.getTableFields();a("#"+this.sidebarPrefix_+"_dynamiclegend").html("");a("#"+this.sidebarPrefix_+"_dynamiclegend").html(this.getCompleteOptionsListHTML());a("#"+this.sidebarPrefix_+"_numresults").html(this.getTableTitle(f.length,true));if(f.length==0){a("#"+this.sidebarPrefix_+"_isdata").html("NO").css("color","red");var g=this.options_.drawTableOpts.containerid||"datatable_container";g=this.sidebarPrefix_+"_"+g;a("#"+g).html("")}else{a("#"+this.sidebarPrefix_+"_isdata").html("YES").css("color","green");if(this.options_.drawTableOpts!=null){var l={};var m=this.key_.split("_")[1];a.extend(l,k[m].columns);var h={json:f,startdate:this.startdate_,enddate:this.enddate_,fields:l,sort:k[m].sort,sorttype:k[m].sorttype};a.extend(h,this.options_.drawTableOpts);this.drawTable(h)}}};wundermap.layers.Extremes.getDetailsURL=function(f,d){var e=f.split(",");var c="";if(e.length>1){c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.station_id="+e[0]+"&id.wxvar="+e[1]+"&id.record_type="+e[2]+"&id.record="+e[4]+"&id.date="+e[3]}else{c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+f}return c};wundermap.layers.Extremes.onClick=function(h,g){var f=h.ICONS[0];if(!f){google.maps.event.trigger(this,"loaderror","failed to load detailed click.");return}var e=this.getBalloonContent(f);if(this.options_.infopane){this.options_.infopane.showHTML(e)}else{var k=parseFloat(f.lat);var l=parseFloat(f.lon);var c=new google.maps.LatLng(k,l);if(g&&g>0){var d=this.map_.maxZoom;if(g>d){g=d}this.map_.setZoom(g)}wundermap.openInfoBox({content:e,position:c})}};wundermap.layers.Extremes.getMarkerTitle=function(f,c){var h="";if(!c){h+=this.getLocationString(f)+": "}var g=f.record_type;var e=f.wxvar;var d=f.date;h+=this.getCleanType(g,d)+" "+this.getCleanVariable(e)+" of "+this.getCleanRecord(f.record,e)+" on "+d;return h};wundermap.layers.Extremes.getClusterTitle=function(d){var c=d.clusternodes[0];var e=this.getLocationString(c);return d.clustercount+" records set near "+e};wundermap.layers.Extremes.getTableTitle=function(e,h){var c="";var d="";if(h){if(e==0){c='style="color:red;"'}else{c='style="color:green;"'}}if(this.options_.sqllimit&&e>=this.options_.sqllimit){d=" (limited to "+this.options_.sqllimit+")"}var g='Showing <span class="b" '+c+">"+e+"</span>"+d;if(this.getElementValue("alldates","checkbox",false)){g+=" current standing records"}else{var f=this.getDateRange({}).split(",");g+=' records from <span class="b">'+this.getCleanDate(f[0],"MM d, yy")+'</span> to <span class="b">'+this.getCleanDate(f[1],"MM d, yy")+"</span>"}return g};wundermap.layers.Extremes.onChangeDB=function(){var c=this;this.key_=this.getElementsValue("db","radiogroup",this.options_.db);if(this.key_.match("burt")&&this.changeBurtOptionsOnFirstDisplay_){this.setBurtDefaultOptions()}if(this.key_.match("burtcity")){this.onChangeWxvar()}this.strikeInvalidCheckboxes();wui.glossary.stop();wui.glossary.start()};wundermap.layers.Extremes.onChangeWxvar=function(){if(this.key_.match("burtcity")){a('[name="'+this.sidebarPrefix_+'_wxvar"]').removeAttr("checked");a("#"+this.sidebarPrefix_+"_"+this.lastClickedWxvar_).attr("checked","checked");this.strikeInvalidCheckboxes()}};wundermap.layers.Extremes.onChangeAllDates=function(e){if(e===undefined){var e={ncdc:["prcp_min","yearly","monthly","daily","storm"]}}this.strikeInvalidCheckboxes();if(this.getElementValue("alldates","checkbox",this.options_.alldates)){a("#"+this.sidebarPrefix_+"_startdate").attr("disabled",true);a("#"+this.sidebarPrefix_+"_enddate").attr("disabled",true);var d=this.getElementsValue("db","radiogroup","ncdc");if(d.match("ncdc")){a("div#"+this.sidebarPrefix_+"_options label").parent().parent().removeClass("none");for(var c=0;c<e.ncdc.length;c++){a('[for="'+this.sidebarPrefix_+"_"+e.ncdc[c]+'"]').parent().parent().addClass("none")}}}else{a("#"+this.sidebarPrefix_+"_startdate").removeAttr("disabled");a("#"+this.sidebarPrefix_+"_enddate").removeAttr("disabled")}};wundermap.layers.Extremes.onChangeDatepicker=function(){this.refresh();this.drawTableAjaxRequest();google.maps.event.trigger(this,"settings_changed")};wundermap.layers.Extremes.setBurtDefaultOptions=function(){this.setElementsValue("types","checkboxgroup",this.options_.types);this.setElementsValue("wxvars","checkboxgroup",this.options_.wxvars);this.setElementValue("alldates","checkbox",this.options_.alldates);this.changeBurtOptionsOnFirstDisplay_=0};wundermap.layers.Extremes.strikeInvalidCheckboxes=function(){var d=this;var f=this.getElementsValue("db","radiogroup",this.options_.db);var c=wundermap.layers.Extremes.getTableFields();var g=c[f].dfn.wxvar;a("div#"+this.sidebarPrefix_+"_options label").parent().parent().addClass("none");if(f=="burtcity"){a.each(g,function(k,l){var m=d;var h=a('[for="'+d.sidebarPrefix_+"_"+k+'"]');h.parent().parent().removeClass("none");h.html(l.title);if(k==d.lastClickedWxvar_){a.each(l.type,function(o,p){var n=a('[for="'+m.sidebarPrefix_+"_"+o+'"]');n.parent().parent().removeClass("none");n.html(p)})}})}else{a.each(g,function(k,l){var h=a('[for="'+d.sidebarPrefix_+"_"+k+'"]');h.parent().parent().removeClass("none");h.html(l)});var e=c[f].dfn.type;a.each(e,function(k,l){var h=a('[for="'+d.sidebarPrefix_+"_"+k+'"]');h.parent().parent().removeClass("none");h.html(l)})}};wundermap.layers.Extremes.getCompleteVariableList=function(){var d='<span class="'+this.sidebarPrefix_+'_selectedlisttitle"> Selected Variables: </span>';var c=this.getElementsValue("wxvar","checkboxgroup",this.options_.wxvars).split(",");for(i=0;i<c.length;i++){d+=this.getCleanVariable(c[i]);if(i!=c.length-1){d+=", "}}return d};wundermap.layers.Extremes.getCompleteTypeList=function(){var d='<span class="'+this.sidebarPrefix_+'_selectedlisttitle"> Selected Types: </span>';var c=this.getElementsValue("type","checkboxgroup",this.options_.types).split(",");for(i=0;i<c.length;i++){d+=this.getCleanType(c[i]);if(i!=c.length-1){d+=", "}}return d};wundermap.layers.Extremes.getCompleteOptionsListHTML=function(){html="";html+='<div id="multiple"><img src="http://icons.wxug.com/i/climate/extremes/multiple.png" /><span>Multiple Records</span></div>';var c='<br class="clear" />';var d=this.getElementsValue("type","checkboxgroup",this.options_.types).split(",");var e=this.getElementsValue("wxvar","checkboxgroup",this.options_.wxvars).split(",");for(i=0;i<e.length;i++){for(j=0;j<d.length;j++){if(!d[j]||!e[i]){continue}if(d[j]=="storm"){if(e[i]=="maxt"||e[i]=="himn"||e[i]=="lomx"||e[i]=="mint"){continue}}html+='<div id="'+e[i]+"_"+d[j]+'"><img src="http://icons.wxug.com/i/climate/extremes/'+e[i]+"_"+d[j]+'.png" alt="" /><span>'+this.getCleanType(d[j])+" "+this.getCleanVariable(e[i])+"</span></div>"}}html+=c;return html};wundermap.layers.Extremes.getBalloonContent=function(g){var f=g.field;var e=g.wxvar;var d=g.record_type;var k=false;if(this.getElementsValue("db","radiogroup",this.options_.db)=="burtworld"){k=true}var h=this.getLocationString(g,k);var c='<div class="ExtremesBalloon">';c+='<div class="infobox-title">'+h+"</div>";c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Date: <span>'+this.getCleanDate(g.date,"M d, yy")+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(g.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(g.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(k){c+='<tr><td class="vaT nobr">City:</td><td class="full">'+this.getLocationString(g,!k)+"</td></tr>"}if(g.country){c+='<tr><td class="vaT nobr">Country:</td><td class="full">'+g.country+"</td></tr>"}if(g.record){c+='<tr><td class="vaT nobr">Record:</td><td class="full"><span class="">'+this.getCleanRecord(g.record,g.wxvar)+"</span></td></tr>"}if(g.record_type){c+='<tr><td class="vaT nobr">Record Type:</td><td class="full"><span class="">'+this.getCleanType(g.record_type,g.date)+"</span></td></tr>"}if(g.wxvar&&!this.key_.match("burtcity")){c+='<tr><td class="vaT nobr">Weather Variable:</td><td class="full"><span class="">'+this.getCleanVariable(g.wxvar)+"</span></td></tr>"}if(g.previous_record){c+='<tr><td class="vaT nobr">Previous Record:</td><td class="full">'+this.getCleanRecord(g.previous_record,g.wxvar)+" ("+this.getCleanDate(g.previous_date,"mm-dd-yy")+")</td></tr>"}if(g.por){c+='<tr><td class="vaT nobr">Period of Record (Years):</td><td class="full"><span class="">'+g.por+"</span></td></tr>"}if(g.footnotes){c+='<tr><td class="vaT nobr">Footnotes:</td><td class="full">'+g.footnotes+"</td></tr>"}c+="</table>";c+="</div>";c+='<div class="contentFooterPad taC brBot5"><a href="/climate/local_extremes.asp?extremesstation.db='+this.key_.split("_")[1]+"&extremesstation.station_id="+g.station_id+'" target="_blank">View this station on the Local Extremes page</a></div>';c+="</div>";return c};wundermap.layers.Extremes.getBalloonContentCluster=function(p){var k='<div class="'+this.className+'Balloon">';k+='<div class="infobox-title">'+this.getClusterTitle(p)+"</div>";k+='<div class="contentData">';var o={};var e=p.clusternodes;var n=p.clusterindex;for(var h=0;h<e.length;h++){var g=e[h];var l=null;if(o[g.station_id]){l=o[g.station_id]}else{l="<div>"+this.getLocationString(g)+"</div><ul>";o[g.station_id]=l}if(p.cluster_hasDetailedResults){var d="javascript:wundermap.layers."+this.className+".getDetailsCached("+n+","+h+","+this.map_.zoom+")"}else{var d=this.getImagemapAreasHref(g,h,false,this.map_.zoom)}var f=true;l+='<li><a href="'+d+'">'+this.getMarkerTitle(g,f)+"</a></li>";o[g.station_id]=l}a.each(o,function(q,r){k+=r+"</ul>"});k+="<ul>";var m=(p.clustercount-p.clustercount_limited);if(m>0){k+="<li>and "+m+" more&hellip;</li>"}k+="</ul>";var d="javascript:wundermap.zoomIn()";k+='<div class="p10"><a href="'+d+'">Zoom in for a closer look</a></div>';if(this.as5000_){var c="http://www.wunderground.com/cgi-bin/tally?node="+this.as5000_+"."+wundermap.options.source+"&value=cluster";k+='<div class="none"><img src="'+c+'" alt="" /></div>'}k+="</div></div>";return k};wundermap.layers.Extremes.drawTable=function(c){var u=c.json||this.jsonData_||null;var q=c.fields||{station_id:"Implement opts.fields in extremes.drawTable!"};var k=c.containerid||"dataTableContainer";var e=c.tableid||"dataTable";var g=c.classes||"tablesorter contentTable borderAll";var r=c.headerTitle||"Extremes Data Table";var n=c.sort||[[0,"desc"]];var d=c.sorttype||[];k=this.sidebarPrefix_+"_"+k;e=this.sidebarPrefix_+"_"+e;a("#"+k).empty();var p='<div class="titleThin brTop5" id="'+this.sidebarPrefix_+'_datatable_header">'+this.getTableTitle(u.length)+"</div>";p+='<table cellspacing="0" cellpadding="0" id="'+e+'" class="'+g+'">';p+="<thead><tr>";var f=0;a.each(q,function(v,w){p+="<th>"+w+"</th>";f++});p+="</tr></thead><tbody>";if(u.length>0){var o=c.startrecord||0;var s=c.endrecord||u.length;if(o>s||o<0){o=0}if(s>u.length||s<o){s=u.length}for(var m=o;m<s;m++){p+=this.getTableRow(u[m],q)}}p+="</tbody></table>";a("#"+k).html(p);a("#"+e).dataTable({oLanguage:{sSearch:'<dfn data-definition="'+this.getFilterResultsDefn()+'">Filter Results</dfn>: ',sInfoEmpty:"No results.",sZeroRecords:"No filtered results.",sLengthMenu:'Display <select><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option><option value="-1">All</option></select> records'},bAutoWidth:false,sScrollX:"100%",aaSorting:n,sPaginationType:"full_numbers",iDisplayLength:25,aoColumns:d});a("#"+e).dataTable().fnSettings().aoDrawCallback.push({fn:function(v){wui.glossary.stop();wui.glossary.start()},sName:"user"});p+='<div class="LayerExtremes_selectedlist">'+this.getCompleteVariableList()+'</div><div class="LayerExtremes_selectedlist">'+this.getCompleteTypeList()+"</div>";var l=a("<div></div>").addClass(this.sidebarPrefix_+"_selectedlist").html(this.getCompleteVariableList());var t=a("<div></div>").addClass(this.sidebarPrefix_+"_selectedlist").html(this.getCompleteTypeList());var h="#"+k+" .dataTables_scroll";t.insertAfter(h);l.insertAfter(h);wui.glossary.stop();wui.glossary.start()};wundermap.layers.Extremes.drawTableMetadata=function(c){var n=c.json||null;var l=c.fields||{station_id:"Implement opts.fields in extremes.drawTable!"};var f=c.containerid||"dataTableContainer";var d=c.tableid||"dataTable";var e=c.classes||"tablesorter contentTable borderAll brBot5 bm12";var k=c.startrecord||0;var m=c.endrecord||n.length;var h=c.header||"Add header with opts.header";f=this.sidebarPrefix_+"_"+f;d=this.sidebarPrefix_+"_"+d;a("#"+f).html();var g='<div class="titleThin" id="'+this.sidebarPrefix_+'_datatable_header">'+h+"</div>";g+='<table cellspacing="0" cellpadding="0" id="'+d+'" class="'+e+'">';if(n.station_id){a.each(l,function(o,q){var p=n[o];if(!p){return true}g+="<tr><td>"+q+"</td><td>"+p+"</td></tr>"})}else{g+='<tr><td colspan="2">No data.</td></tr>'}g+="</tbody></table>";a("#"+f).html(g)};wundermap.layers.Extremes.getDateRange=function(h){var c=h.dateFormat||"mm-dd-yy";var g=h.startdate||this.getElementValue("startdate","input","01-01-2000");var f=h.enddate||this.getElementValue("enddate","input","01-01-2020");try{var n=a.datepicker.parseDate(c,g)}catch(k){}try{var m=a.datepicker.parseDate(c,f)}catch(k){}var o=null;if(n.getTime()>m.getTime()){o=m;m=n;n=o}var l=a.datepicker.formatDate("yy-mm-dd",n);var d=a.datepicker.formatDate("yy-mm-dd",m);return l+","+d};wundermap.layers.Extremes.getLocationString=function(d,c){if(c&&d.country){return a.trim(d.country).titlizer()}var e=a.trim(d.place).titlizer();if(d.state){e+=", "+a.trim(d.state)}return e};wundermap.layers.Extremes.getTableRow=function(g,c){var h=this.getLocationString(g);var e="<tr>";var d="";var f="";if(g.footnotes&&g.footnotes!=""){d='<dfn data-definition="'+g.footnotes+'">';f="</dfn>"}e+="<td>"+this.getCleanDate(g.date,"mm-dd-yy")+"</td>";if(c.place){e+="<td>"+h+"</td>"}if(c.country&&g.country){e+="<td>"+g.country+"</td>"}if(g.continent){e+="<td>"+g.continent+"</td>"}if(c.wxvar&&g.wxvar&&!this.key_.match("burtcity")){e+="<td>"+this.getCleanVariable(g.wxvar)+"</td>"}e+="<td>"+this.getCleanType(g.record_type,g.date)+"</td>";e+="<td>"+d+this.getCleanRecord(g.record,g.wxvar)+f+"</td>";if(c.previous_record&&g.previous_record&&g.previous_date){e+="<td>"+this.getCleanRecord(g.previous_record,g.wxvar)+" ("+this.getCleanDate(g.previous_date,"mm-dd-yy")+")</td>"}e+="</tr>";return e};wundermap.layers.Extremes.getCleanDate=function(f,h){try{var d=f.split("-");if(!f){return"00-00-0000"}else{if(f.match("0000")||f.match("-00")){return d[1]+"-"+d[2]+"-"+d[0]}else{var c=a.datepicker.parseDate("yy-mm-dd",f);return a.datepicker.formatDate(h,c)}}}catch(g){return f}};wundermap.layers.Extremes.getCleanVariable=function(f){var c=wundermap.layers.Extremes.getTableFields();var e=this.getElementsValue("db","radiogroup","ncdc");var d=c[e].dfn;if(d){if(d.wxvar[f].title){return d.wxvar[f].title}else{return d.wxvar[f]}}return f};wundermap.layers.Extremes.getCleanType=function(e,f,h){var c=wundermap.layers.Extremes.getTableFields();var g=this.getElementsValue("db","radiogroup","ncdc");var d=c[g].dfn;if(d.type){return d.type[e]}else{if(this.lastClickedWxvar_){return d.wxvar[this.lastClickedWxvar_].type[e]}}return e};wundermap.layers.Extremes.getCleanRecord=function(d,h){var g=parseFloat(d);if(!isNaN(g)){var f=wundermap.utils;var e=wundermap.options.units;if(h=="prcp"||h=="snow"||h=="prcp_min"){var c=2;if(h.match("snow")){c=1}if(g==-1){return"Trace"}else{return f.convertRainIntoUnitsMM(e,d,c)+" "+f.getRainUnitsMM(e)}}else{var c=0;if(this.key_.match("burt")){c=1}return f.convertTempIntoUnits(e,d,c)+" &deg;"+f.getTempUnits(e)}}else{return"NaN"}};wundermap.layers.Extremes.getTableFields=function(){return{ncdc:{columns:{date:"Date",place:"Location",wxvar:"Variable",record_type:"Type",record:"Record",previous_record:"Prev Record"},sort:[[0,"desc"],[3,"asc"],[4,"asc"],[5,"desc"]],sorttype:[{sType:"us_date"},null,null,null,{sType:"numeric-stripchars"},null],dfn:{type:{alltime:"All-Time Record",monthly:"Monthly Record",daily:"Daily Record"},wxvar:{maxt:"High Maximum Temp",lomx:"Low Maximum Temp",himn:"High Minimum Temp",mint:"Low Minimum Temp",prcp:"Maximum Rainfall",snow:"Maximum Snowfall"}}},burtcity:{columns:{date:"Date",place:"Location",record_type:"Type",record:"Record"},sort:[[0,"desc"]],sorttype:[{sType:"us_date"},null,null,{sType:"numeric-stripchars"}],dfn:{wxvar:{maxt:{title:"High Temp",type:{alltime:"All-Time Warmest Temp",yearly:"All-Time Warmest Summer",monthly:"All-Time Warmest Month"}},mint:{title:"Low Temp",type:{alltime:"All-Time Coldest Temp",yearly:"All-Time Coldest Winter",monthly:"All-Time Coldest Month"}},snow:{title:"Snowfall",type:{alltime:"All-Time Greatest Snow Depth",yearly:"Most Snow in a Season",monthly:"Most Snow in a Month",daily:"Most Snow in 24 Hours",storm:"Most Snow in a Single Storm"}},prcp:{title:"Rainfall",type:{yearly:"Most Rain in a Year",monthly:"Most Rain in a Month",daily:"Most Rain in 24 Hours"}}}}},burtworld:{columns:{date:"Date",place:"Location",country:"Country",continent:"Continent",wxvar:"Variable",record_type:"Type",record:"Record"},sort:[[0,"desc"]],sorttype:[{sType:"us_date"},null,null,null,null,null,{sType:"numeric-stripchars"}],dfn:{type:{alltime:"All-Time Record"},wxvar:{maxt:"High Temp",mint:"Low Temp"}}},defaultlist:{columns:{station_id:"Station Id",date:"Date",record:"Record"},sort:[[1,"desc"]],sorttype:[{sType:"us_date"},null,{sType:"numeric-stripchars"}],dfn:{}}}};wundermap.layers.Extremes.setupDatepickers=function(){var n=this;var d=new Date();var m=new Date();var l=this.options_.startenddatediff||1;m.setDate(d.getDate()-l);if(this.options_.startdate){try{var f=wundermap.utils.cleanDate(this.options_.startdate);m=a.datepicker.parseDate("mm-dd-yy",f)}catch(h){if(wundermap.debug>0){wui.log("Invalid start date "+f+" in query string. Defaulting to "+m.toDateString()+". "+h.toString())}}}else{this.options_.startdate=wui.date.strftime("%m-%d-%Y",m)}if(this.options_.enddate){try{var k=wundermap.utils.cleanDate(this.options_.enddate);d=a.datepicker.parseDate("mm-dd-yy",k)}catch(h){if(wundermap.debug>0){wui.log("Invalid end date "+k+" in query string. Defaulting to "+d.toDateString()+". "+h.toString())}}}else{this.options_.enddate=wui.date.strftime("%m-%d-%Y",d)}var c=a("#"+this.sidebarPrefix_+"_startdate");var g=a("#"+this.sidebarPrefix_+"_enddate");c.val(a.datepicker.formatDate("mm-dd-yy",m));g.val(a.datepicker.formatDate("mm-dd-yy",d));c.datepicker({minDate:new Date(1800,1,1),maxDate:new Date(),changeMonth:true,changeYear:true,yearRange:"1850:2020",dateFormat:"mm-dd-yy",onChangeMonthYear:function(e,p,o){c.val(a.datepicker.formatDate("mm-dd-yy",new Date(e,p-1,1)))},onClose:function(o,e){n.onChangeDatepicker()}});g.datepicker({defaultDate:null,minDate:new Date(1800,1,1),maxDate:new Date(),changeMonth:true,changeYear:true,yearRange:"1850:2020",dateFormat:"mm-dd-yy",onChangeMonthYear:function(e,p,o){g.val(a.datepicker.formatDate("mm-dd-yy",new Date(e,p-1,1)))},onClose:function(o,e){n.onChangeDatepicker()}})};wundermap.layers.Extremes.getMonthString=function(d){var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return c[d-1]};wundermap.layers.Extremes.getFilterResultsDefn=function(){return"<div>Try filtering table rows by entering a space separated list of search keys.<br />For example: 'phila trace 2011'. This would display Philadelphia precip records from 2011 where a trace amount of precip was recorded, if any exist in the table.<br />Search terms are case-insensitive.</div>"};wundermap.layers.Tide=new wundermap.Layer();wundermap.layers.Tide.className="Tide";wundermap.layers.Tide.initialize=function(e,c){var d={name:"tide",sidebarPrefix:"LayerTide"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="tide";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.listImagemapAreas,this)})};wundermap.layers.Tide.listImagemapAreas=function(c,d,f){try{receiveNodes(c,"Tide")}catch(e){}};wundermap.layers.Tide.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.Tide.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.Tide.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.Tide.getDetails=function(f,e){var c=this;var d=this.getDetailsURL(f,e);if(this.debug_>0){wui.log("getDetailsURL: "+d)}setMarineTide(f)};wundermap.layers.Beach=new wundermap.Layer();wundermap.layers.Beach.className="Beach";wundermap.layers.Beach.initialize=function(e,c){var d={name:"beach",sidebarPrefix:"LayerBeach"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="beach";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.listImagemapAreas,this)})};wundermap.layers.Beach.listImagemapAreas=function(c,d,f){try{receiveNodes(c,"Beach")}catch(e){}};wundermap.layers.Beach.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.Beach.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.Beach.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.Beach.getDetails=function(d,c){setSelectedBeach(d)};wundermap.layers.Marine=new wundermap.Layer();wundermap.layers.Marine.className="Marine";wundermap.layers.Marine.initialize=function(e,c){var d={name:"mar",sidebarPrefix:"LayerMarine"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="marine";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.listImagemapAreas,this)})};wundermap.layers.Marine.listImagemapAreas=function(c,d,f){try{receiveNodes(c,"Marine")}catch(e){}};wundermap.layers.Marine.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.Marine.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.Marine.getDetails=function(d,c){setMarineBuoy(d)};wundermap.layers.Marine.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.ActiveCaptain=new wundermap.Layer();wundermap.layers.ActiveCaptain.className="ActiveCaptain";wundermap.layers.ActiveCaptain.initialize=function(e,c){var d={name:"activecaptain",sidebarPrefix:"LayerActiveCaptain"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="activecaptain";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.listImagemapAreas,this)})};wundermap.layers.ActiveCaptain.listImagemapAreas=function(c,d,f){try{receiveNodes(c,"ActiveCaptain")}catch(e){}};wundermap.layers.ActiveCaptain.getURL=function(h,l,f,k,e,m,c){var n=new Date();var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_,epoch:n.getTime()/1000};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.ActiveCaptain.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.ActiveCaptain.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.ActiveCaptain.getDetails=function(c,d,e){setSelectedActiveCaptain(c,e)};wundermap.layers.ActiveCaptain.getMarkerTitle=function(c){return unescape(c.id)};wundermap.layers.ActiveCaptain.getImagemapAreasHref=function(f,d,c,e){var e=e||0;return"javascript:wundermap.layers."+this.className+".getDetails('"+escape(f.id)+"',"+e+","+f.ID+")"};wundermap.layers.ActiveCaptainCoOp=new wundermap.Layer();wundermap.layers.ActiveCaptainCoOp.className="ActiveCaptainCoOp";wundermap.layers.ActiveCaptainCoOp.initialize=function(e,c){var d={name:"activecaptaincoop",sidebarPrefix:"LayerActiveCaptainCoOp"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="activecaptaincoop";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.listImagemapAreas,this)})};wundermap.layers.ActiveCaptainCoOp.listImagemapAreas=function(c,d,f){try{receiveNodes(c,"ActiveCaptainCoOp")}catch(e){}};wundermap.layers.ActiveCaptainCoOp.getURL=function(h,l,f,k,e,m,c){var n=new Date();var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_,"filter.CoOpStart.lt":n.getTime()/1000,"filter.CoOpEnd.gt":n.getTime()/1000};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.ActiveCaptainCoOp.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.ActiveCaptainCoOp.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.ActiveCaptainCoOp.getDetails=function(c,d,e){setSelectedActiveCaptain(c,e)};wundermap.layers.ActiveCaptainCoOp.getMarkerTitle=function(c){return unescape(c.id)};wundermap.layers.ActiveCaptainCoOp.getImagemapAreasHref=function(f,d,c,e){var e=e||0;return"javascript:wundermap.layers."+this.className+".getDetails('"+escape(f.id)+"',"+e+","+f.ID+")"};wundermap.layers.ghcn=new wundermap.Layer();wundermap.layers.ghcn.className="ghcn";wundermap.layers.ghcn.initialize=function(e,c){var d={name:"ghcn",sidebarPrefix:"LayerGHCN",mode:"TAVG"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="ghcn";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.setElementsValue("var","radiogroup",this.options_.mode);this.addElementsListeners("var","click")};wundermap.layers.ghcn.getMarkerTitle=function(c){return c.name+" ("+c.id+")"};wundermap.layers.ghcn.getURL=function(k,m,g,l,e,n,c){var f=this.getElementsValue("var","radiogroup","TAVG");if("wxvar" in c){f=c.wxvar}var h={minlat:g,minlon:l,maxlat:k,maxlon:m,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.wxvar.eq":f};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(h);return d};wundermap.layers.ghcn.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.id="+e+"&id.wxvar="+this.getElementsValue("var","radiogroup","TAVG");return c};wundermap.layers.ghcn.getBalloonContent=function(d){var c='<div class="GHCNBalloon">';c+='<div class="infobox-title">'+d.name.titlizer()+"</div>";c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Station ID: <span>'+d.id+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(d.start_year){c+='<tr><td class="vaT nobr">Start Year:</td><td class="full">'+d.start_year+"</td></tr>"}if(d.end_year){c+='<tr><td class="vaT nobr">End Year:</td><td class="full">'+d.end_year+"</td></tr>"}c+="</table>";c+="</div>";c+='<div class="contentFooterPad taC brBot5"><a href="/climate/local.html?id='+d.id+"&var="+d.wxvar+'" >View This Station</a></div>';c+="</div>";return c};wundermap.layers.OAR=new wundermap.Layer();wundermap.layers.OAR.className="OAR";wundermap.layers.OAR.initialize=function(e,c){var d={name:"oar",sidebarPrefix:"LayerOAR",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="oar";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.OAR.getMarkerTitle=function(c){return c.name};wundermap.layers.OAR.getBalloonContent=function(d){var c='<div class="OARBalloon">';c+='<div class="infobox-title">'+d.name+"</div>";c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Date: <span>'+d.prettydate+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(d.type=="dhl_usa"){c+='<tr><td class="vaT nobr">Location:</td><td class="full">'+d.location+"</td></tr>";c+='<tr><td class="vaT nobr">Distance:</td><td class="full">'+d.distance+" mi.</td></tr>"}else{c+='<tr><td class="vaT nobr">Distance:</td><td class="full">'+d.distance+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Heading:</td><td class="full">'+d.heading+" &deg;</td></tr>";c+='<tr><td class="vaT nobr">Distance from start:</td><td class="full">'+d.distance_from_start+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Distance from finish:</td><td class="full">'+d.distance_from_finish+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Progress total:</td><td class="full">'+d.progress_total+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Progress today:</td><td class="full">'+d.progress_today+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Progress average:</td><td class="full">'+d.progress_average+" mi. per day</td></tr>";c+='<tr><td class="vaT nobr">Days remaining:</td><td class="full">'+d.days_remaining+"</td></tr>"}c+="</table>";c+="</div>";c+='<div class="contentFooterPad taC brBot5">Date: <span>'+d.prettydate+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+d.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.SailingSevere=new wundermap.Layer();wundermap.layers.SailingSevere.className="SailingSevere";wundermap.layers.SailingSevere.initialize=function(e,c){var d={name:"sailsvr",theme:"all",sidebarPrefix:"LayerSailingSevere",opacity:70};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_customClickResponse:a.proxy(this.customClickResponse,this),fn_getClickURL:a.proxy(this.getClickURL,this)});this.addOpacityListener();this.addElementsListeners("theme","click");this.setElementsValue("theme","radiogroup",this.options_.theme)};wundermap.layers.SailingSevere.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"mapgen_category_"+this.getElementsValue("theme","radiogroup",this.options_.theme),proj:"automerc",format:"gif",alpha:"1",stdout:"1",rand:Math.floor((new Date()).getTime()/60000)};var d="http://wumaps.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.SailingSevere.getClickURL=function(c){var e={profile:"wmapv3_severe",lat:c.lat(),lon:c.lng()};var d="/cgi-bin/shapeclick";d+="?"+a.param(e);return d};wundermap.layers.SailingSevere.customClickResponse=function(k,c){var h=k.Region;var l=k.ID;var d=l.substr(0,2);var g=l.substr(2);var f;if(h=="US"){f="/US/"+d+"/"+g+".html?view=SailingAlertTextBubble"}else{if(h=="CANADA"){f="/severe/canada/"+l+".html?view=SailingAlertTextBubble"}else{f="/EU/"+d+"/"+g+".html?view=SailingAlertTextBubble"}}var e=this;a.ajax({url:f,success:function(n,m){try{openSailingSevereAlert(n)}catch(o){}},error:function(o,m,n){if(wundermap.debug>0){wui.log(m)}}})};wundermap.layers.SailingSevere.getPrefs=function(){return{opa:this.getElementValue("opacity_slider","slider",null)}};wundermap.layers.SailingSevere.listImagemapAreas=function(c,d,f){try{receiveNodes(c,"Severe")}catch(e){}};wundermap.layers.Inciweb=new wundermap.Layer();wundermap.layers.Inciweb.className="Inciweb";wundermap.layers.Inciweb.initialize=function(e,c){var d={name:"inciweb",title:"Fire (inciweb)",sidebarPrefix:"LayerInciweb"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.key_="inciweb"};wundermap.layers.Inciweb.getTableHeadContent=function(g,h){var f=a("<tr></tr>");var e=a("<th></th>").appendTo(f);var d=e.clone().appendTo(f);var c=e.clone().appendTo(f);e.html("Name").attr("title","Sort by Name");d.html("State").attr("title","Sort by State");c.html("Size (Acres)").attr("title","Sort by Size");return f};wundermap.layers.Inciweb.getTableRowContent=function(g){var f=a("<tr></tr>");var e=a("<td></td>").appendTo(f);var d=e.clone().appendTo(f);var c=e.clone().appendTo(f);e.html(g.name);d.html(g.STATE);c.html(g.SIZE);f.bind("click",function(h){wundermap.layers.Inciweb.getDetails(g.id,null)});return f};wundermap.layers.ASTC=new wundermap.Layer();wundermap.layers.ASTC.className="ASTC";wundermap.layers.ASTC.initialize=function(e,c){var d={name:"astc",title:"ASTC - centers",sidebarPrefix:"LayerASTC",timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.key_="astc"};wundermap.layers.NYCEvac=new wundermap.Layer();wundermap.layers.NYCEvac.className="NYCEvac";wundermap.layers.NYCEvac.initialize=function(e,c){var d={name:"nycevac",sidebarPrefix:"LayerNYCEvac",title:"Hurricane NYC Evacuation Zones",opacity:60,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.addOpacityListener()};wundermap.layers.NYCEvac.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"nycevac",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.NYCEvac.getClickURL=function(c){var e={profile:"wmapv3_nycevac",lat:c.lat(),lon:c.lng()};var d="timelord.wunderground.com/cgi-bin/shapeclick";d+="?"+a.param(e);return d};wundermap.layers.HurrEvac=new wundermap.Layer();wundermap.layers.HurrEvac.className="HurrEvac";wundermap.layers.HurrEvac.initialize=function(e,c){var d={name:"hurrevac",sidebarPrefix:"LayerHurrEvac",title:"Evacuation Routes",timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)})};wundermap.layers.HurrEvac.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"hurrevac",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.HurrEvac.getClickURL=function(c){var e={profile:"wmapv3_hurrevac",lat:c.lat(),lon:c.lng()};var d="timelord.wunderground.com/cgi-bin/shapeclick";d+="?"+a.param(e);return d};wundermap.layers.SST=new wundermap.Layer();wundermap.layers.SST.className="SST";wundermap.layers.SST.initialize=function(e,c){var d={name:"sst",sidebarPrefix:"LayerSST",title:"Sea Surface Temps",img:"global_sst"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="sst";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.addElementsListeners("img","click");this.setElementsValue("img","radiogroup",this.options_.img);this.addOpacityListener()};wundermap.layers.SST.getURL=function(h,l,f,k,e,n,c){var m=this.getElementsValue("img","radiogroup",this.options_.img);var d="http://wublast.wunderground.com/cgi-bin/WUBLAST";var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:n,key:m,proj:"me",rand:Math.floor((new Date()).getTime()/60000)};d+="?"+a.param(g);return d};wundermap.layers.SST.getPrefs=function(){return{img:this.getElementsValue("img","radiogroup",this.options_.img),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)}};wundermap.layers.LiveSurge=new wundermap.Layer();wundermap.layers.LiveSurge.className="LiveSurge";wundermap.layers.LiveSurge.initialize=function(e,c){var d={name:"livesurge",sidebarPrefix:"LayerLiveSurge",title:"Storm Surge",img:"surge",expsrg:"checked"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="livesurge";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),ajaxOptions:{cache:false}});this.addImageLayer({fn_getURL:a.proxy(this.getURLSRG,this)});this.setElementsValue("img","radiogroup",this.options_.img);this.addElementsListeners("img","click");this.setElementValue("expsrg","checkbox",this.options_.expsrg);this.addElementListener("expsrg","click");this.addOpacityListener([1])};wundermap.layers.LiveSurge.getURL=function(h,l,f,k,e,o,c){var m=this.getElementsValue("img","radiogroup",this.options_.img);var d="";var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:o,field:"residual",proj:"me",extension:(c.isDataURL===true)?"js":"png",gmapzoom:this.map_.getZoom(),units:wundermap.options.units||"english"};var n=this.key_;if(m!="surge"){n=this.key_+"_"+m}a.extend(g,{key:n});d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.LiveSurge.getURLSRG=function(h,m,f,k,e,n,c){var l=this.getElementValue("expsrg","checkbox",this.options_.expsrg);if(wundermap.utils.isCheckedValue(l)){var d="";var g={minlat:f,minlon:k,maxlat:h,maxlon:m,width:e,height:n,proj:"automerc",theme:"HUR_LAYERS/dynamic/gmapSurge",stdout:"1",size:e+"x"+n,alpha:"1",format:"gif",rand:Math.floor((new Date()).getTime()/60000)};d="http://wumaps.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d}else{return""}};wundermap.layers.LiveSurge.getBalloonContent=function(f){var c=wundermap.options.units||"english";var d=wundermap.utils.getHeightUnits(c);var e='<div class="LiveSurgeBalloon">';e+='<div class="infobox-title">'+f.name+"</div>";e+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';e+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(f.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(f.lon).toFixed(2)+"</span></td></tr></table>";e+='<div class="grt p10">';e+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';e+='<tr><td class="vaT nobr">Water Level:</td><td class="full">'+wundermap.utils.convertHeightIntoUnits(c,f.height,2)+" "+d+"</td></tr>";e+='<tr><td class="vaT nobr">Predicted Water Level:</td><td class="full">'+wundermap.utils.convertHeightIntoUnits(c,f.prediction,2)+" "+d+"</td></tr>";e+='<tr><td class="vaT nobr">Storm Surge:</td><td class="full">'+wundermap.utils.convertHeightIntoUnits(c,f.residual,2)+" "+d+"</td></tr>";e+="</table>";e+="</div>";e+="</div>";return e};wundermap.layers.LiveSurge.getPrefs=function(){return{img:this.getElementsValue("img","radiogroup",this.options_.img),expsrg:this.getElementValue("expsrg","checkbox",this.options_.expsrg),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)}};wundermap.layers.FemaFlood=new wundermap.Layer();wundermap.layers.FemaFlood.className="FemaFlood";wundermap.layers.FemaFlood.initialize=function(f,c){var e={title:"Flood",name:"femaflood",sidebarPrefix:"LayerFemaFlood",opacity:70};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),ajaxOptions:{dataType:"jsonp"},fn_getClickURLs:[a.proxy(this.getClickURL,this),a.proxy(this.getClickURL2,this)],fn_getBalloonContent:a.proxy(this.getBalloonContent,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLQ3,this),ajaxOptions:{dataType:"jsonp"}});this.addOpacityListener([0,1]);var d=new google.maps.ImageMapType({getTileUrl:function(l,g){if(g>12){return}var k=l.x%(1<<g);var h=l.y;return"http://timelord.wunderground.com/overlays/femaflood/"+g+"/"+k+"/"+h+".png"},opacity:0.01*this.getElementValue("opacity_slider","slider",this.options_.opacity),tileSize:new google.maps.Size(256,256),name:"femaflood"});this.findId("opacity_slider").bind("slide",function(g,h){d.setOpacity(h.value/100)});google.maps.event.addListener(this,"layertoggled",function(g){if(g){wundermap.utils.overlayMapTypes.add(d)}else{wundermap.utils.overlayMapTypes.removeByName("femaflood")}})};wundermap.layers.FemaFlood.getURL=function(h,l,f,k,e,m,c){if(wundermap.map.getZoom()<=12){return null}var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"femaflood",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.FemaFlood.getURLQ3=function(h,l,f,k,e,m,c){if(wundermap.map.getZoom()<=12){return null}var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"q3flood",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.FemaFlood.getClickURL=function(c){var e={profile:"wmapv3_femaflood",lat:c.lat(),lon:c.lng()};var d="http://timelord.wunderground.com/cgi-bin/shapeclick?"+a.param(e);return d};wundermap.layers.FemaFlood.getClickURL2=function(c){var e={profile:"wmapv3_femaflood_date",lat:c.lat(),lon:c.lng()};var d="http://timelord.wunderground.com/cgi-bin/shapeclick?"+a.param(e);return d};wundermap.layers.FemaFlood.getBalloonContent=function(f){var e=f[0];var d=f[1];var n="";switch(e.FLD_ZONE){case"0.2 PCT ANNUAL CHANCE FLOOD HAZARD":n="Inside 500 year flood zone.";break;case"100":n="This is an area inundated by 100-year flooding for which BFEs (Base Flood Elevations) or velocity may have been determined. No distinctions are made between the different flood hazard zones that may be included within the SFHA.";break;case"100IC":n="An area where the 100-year flooding is contained within the channel banks and the channel is too narrow to show to scale. An arbitrary channel width of 3 meters is shown.";break;case"A":n="Inside 100 year flood zone, No Base Flood Elevation.";break;case"A99":n="An area inundated by 100-year flooding, for which no BFEs (Base Flood Elevations) have been determined. This is an area to be protected from the 100-year flood by a Federal flood protection system under construction.";break;case"AE":n="An area inundated by 100-year flooding, for which BFEs (Base Flood Elevations) have been determined.";break;case"AH":n="An area inundated by 100-year flooding (usually an area of ponding), for which BFEs (Base Flood Elevations) have been determined; flood depths range from 1 to 3 feet.";break;case"ANI":n="An area that is located within a community or county that is not mapped on any published FIRM.";break;case"AO":n="An area inundated by 100-year flooding (usually sheet flow on sloping terrain), for which average depths have been determined; flood depths range from 1 to 3 feet.";break;case"AR":n="An area inundated by flooding, for which BFEs (Base Flood Elevations) or average depths have been determined.";break;case"B":n="An area inundated by 500-year flooding; an area inundated by 100-year flooding with average depths of less than 1 foot or with drainage areas less than 1 square mile; or an area protected by levees from 100-year flooding.";break;case"BE":n="An area inundated by 500-year flooding; an area inundated by 100-year flooding with average depths of less than 1 foot or with drainage areas less than 1 square mile; or an area protected by levees from 100-year flooding.";break;case"BL":n="Areas protected from the 1% annual chance flood by levees. No Base Flood Elevations or depths are shown within this zone.";break;case"BX":n="An area inundated by 500-year flooding; an area inundated by 100-year flooding with average depths of less than 1 foot or with drainage areas less than 1 square mile; or an area protected by levees from 100-year flooding.";break;case"C":case"CE":case"CX":n="An area that is determined to be outside the 100- and 500-year floodplains.";break;case"D":n="An area of undetermined but possible flood hazards.";break;case"FW":n="An area that includes the channel of a river or other watercourse (Usually adjacent to Zone AE).";break;case"FWIC":n="An area where the floodway is contained within the channel banks and the channel is too narrow to show to scale. An arbitrary channel width of 3 meters is shown. BFEs (Base Flood Elevations) are not shown in this area, although they may be reflected on the corresponding profile";break;case"IN":n="This is an area inundated by 100-year flooding for which BFEs (Base Flood Elevations) or velocity may have been determined. No distinctions are made between the different flood hazard zones that may be included within the SFHA.";break;case"NM":n="An area that is located within a community or county that is not mapped on any published FIRM.";break;case"OUT":n='An area designated as outside a "Special Flood Hazard Area" (or SFHA) on a FIRM. This is an area inundated by 500-year flooding; an area inundated by 100-year flooding with average depths of less than 1 foot or with drainage areas less than 1 square mile.';break;case"OW":n="A body of open water, such as a large pond, lake, bay, ocean, etc., located within a community's jurisdictional limits, that has no defined flood hazard.";break;case"UNDES":n="A body of open water, such as a pond, lake ocean, etc., located within a community's jurisdictional limits, that has no defined flood hazard.";break;case"V":n="Inside 100-year flood zone with velocity hazard (wave action); no Base Flood Elevations have been determined.";break;case"VE":n="An area inundated by 100-year flooding with velocity hazard (wave action); BFEs (Base Flood Elevations) have been determined.";break;case"X":n="Outside the 100- and 500-year floodplains";break;case"X5":n="An area inundated by 500-year flooding; an area inundated by 100-year flooding with average depths of less than 1 foot or with drainage areas less than 1 square mile; or an area protected by levees from 100-year flooding.";break;case"X500":n="An area inundated by 500-year flooding; an area inundated by 100-year flooding with average depths of less than 1 foot or with drainage areas less than 1 square mile; or an area protected by levees from 100-year flooding.";break;case"X500IC":n="An area where the 500-year flooding is contained within the channel banks and the channel is too narrow to show to scale. An arbitrary channel width of 3 meters is shown.";break;case"X500L":n="Areas protected from the 1% annual chance flood by levees. No Base Flood Elevations or depths are shown within this zone.";break;case"A1":case"A2":case"A3":case"A4":case"A5":case"A6":case"A7":case"A8":case"A9":case"A10":case"A11":case"A12":case"A13":case"A14":case"A15":case"A16":case"A17":case"A18":case"A19":case"A20":case"A21":case"A22":case"A23":case"A24":case"A25":case"A26":case"A27":case"A28":case"A29":case"A30":n="An area inundated by 100 year flooding, for which no BFEs (Base Flood Elevations) have been established.";break;case"V0":case"V1":case"V2":case"V3":case"V4":case"V5":case"V6":case"V7":case"V8":case"V9":case"V10":case"V11":case"V12":case"V13":case"V14":case"V15":case"V16":case"V17":case"V18":case"V19":case"V20":case"V21":case"V22":case"V23":case"V24":case"V25":case"V26":case"V27":case"V28":case"V29":case"V30":n="An area inundated by 100-year flooding with velocity hazard (wave action); no BFEs (Base Flood Elevations) have been determined.";break;case"Z":n="An area of Data Discrepancy or an Unclaimed Area. Internal TFHC designation.";break;case"N":n="An area that is located within a community or county that is not mapped on any published FIRM (Usually a community not participating in NFIP). Internal TFHC designation.";break;case"AR/A":n="An area inundated by flooding, for which BFEs (Base Flood Elevations) or average depths have not been determined.";break;case"AR/AE":n="An area inundated by flooding, for which BFEs (Base Flood Elevations) or average depths have been determined.";break;case"AR/AH":n="An area inundated by flooding, for which BFEs (Base Flood Elevations) or average depths have been determined.";break}var g='<div class="FemaFloodBalloon">';g+='<div class="infobox-title">FEMA Flood Zone</div>';g+='<div class="grt p10">';g+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';g+='<tr><td class="nobr">ID:</td></td><td class="full"><span class="b cap">'+e.name+"id:"+e.OBJECTID+"</td></tr>";g+='<tr><td class="nobr">Flood Zone:</td><td>['+e.FLD_ZONE+"] "+n+"</td></tr>";var m="N/A";if(e.SFHA_TF=="T"){m="True"}if(e.SFHA_TF=="F"){m="False"}g+='<tr><td class="nobr">Special Flood Hazard Area:</td><td>'+m+"</td></tr>";if(e.FLOODWAY.length>0){g+='<tr><td class="nobr">Floodway:</td><td>'+e.FLOODWAY+"</td></tr>"}if(e.DEPTH>-8888){g+='<tr><td class="nobr">Depth:</td><td>'+e.DEPTH+e.LEN_UNIT+"</td></tr>"}if(e.VELOCITY>-8888){g+='<tr><td class="nobr">Velocity:</td><td>'+e.VELOCITY+e.VEL_UNIT+"</td></tr>"}if(e.STATIC_BFE>-8888){g+='<tr><td class="nobr">Static Base Flood Elevation (BFE):</td><td>'+e.STATIC_BFE+" "+e.LEN_UNIT+"</td></tr>"}if(e.BFE_REVERT>-8888){g+='<tr><td class="nobr">BFE REVERT:</td><td>'+e.BFE_REVERT+"</td></tr>"}if(e.DEP_REVERT>-8888){g+='<tr><td class="nobr">DEP REVERT:</td><td>'+e.DEP_REVERT+"</td></tr>"}g+='<tr><td class="nobr">Data Source:</td><td>'+e.DATA_TYPE+"</td></tr>";if(d.FIRM_PAN){g+='<tr><td class="nobr">Map Panel:</td><td><a target=_blank href="https://msc.fema.gov/webapp/wcs/stores/servlet/QuickOrderResultView?storeId=10001&catalogId=10001&langId=-1&fisID=&fl_id=&fi_id=&isMapID=1&isKitID=0&strErrorMessage=&kit_id=&floodID=12001&fromHome=Y&map_id='+d.FIRM_PAN+'&map_id=&map_id=&productSearchButton2=Search+by+Map+Panel+ID">FEMA Map Viewer: '+d.FIRM_PAN+"</a></td></tr>"}g+="</table>";g+="</div>";var c=d.UPDATE_DATE;if(c&&c!="0"){var k=c.substr(0,4);var h=c.substr(4,2);var l=c.substr(6,2);g+='<div class="contentFooterPad taC brBot5">Records Updated: <span>'+h+"/"+l+"/"+k+"</span></div>"}g+="</div>";return g};wundermap.layers.Tsunami=new wundermap.Layer();wundermap.layers.Tsunami.className="Tsunami";wundermap.layers.Tsunami.initialize=function(e,c){var d={name:"tsunami",sidebarPrefix:"LayerTsunami"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.addOpacityListener()};wundermap.layers.Tsunami.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"tsunami",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.SeismicRisk=new wundermap.Layer();wundermap.layers.SeismicRisk.className="SeismicRisk";wundermap.layers.SeismicRisk.initialize=function(e,c){var d={title:"Seismic Risk",name:"seismicrisk",sidebarPrefix:"LayerSeismicRisk",timelord:false,seismicrisk:0,liquefaction:1,landslide:1,faultregions:1};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURLMapgen,this),getURL_opts:{theme:"liquefaction",subdomain:"timelord"},checkbox:["liquefaction",this.options_.liquefaction]});this.addImageLayer({fn_getURL:a.proxy(this.getURLMapgen,this),getURL_opts:{theme:"landslide_seismic",subdomain:"timelord"},checkbox:["landslide",this.options_.landslide]});this.addImageLayer({fn_getURL:a.proxy(this.getURLMapgen,this),getURL_opts:{theme:"faultregions",subdomain:"timelord"},checkbox:["faultregions",this.options_.faultregions]});this.setElementValue("seismicrisk","checkbox",this.options_.seismicrisk);this.setElementValue("liquefaction","checkbox",this.options_.liquefaction);this.setElementValue("landslide","checkbox",this.options_.landslide);this.setElementValue("faultregions","checkbox",this.options_.faultregions);this.addOpacityListener([0,1,2,3])};wundermap.layers.SeismicRisk.getPrefs=function(c){return{seismicrisk:this.getElementValue("seismicrisk","checkbox",this.options_.seismicrisk)?"1":"0",liquefaction:this.getElementValue("liquefaction","checkbox",this.options_.liquefaction)?"1":"0",landslide:this.getElementValue("landslide","checkbox",this.options_.landslide)?"1":"0",faultregions:this.getElementValue("faultregions","checkbox",this.options_.faultregions)?"1":"0"}};wundermap.layers.SeismicRisk.getURL=function(d,g,f,h,k,c,l){var e="http://timelord.wunderground.com/data/ca_faultregion/seismic_conus.gif";return e};wundermap.layers.Fault=new wundermap.Layer();wundermap.layers.Fault.className="Fault";wundermap.layers.Fault.initialize=function(e,c){var d={name:"fault",sidebarPrefix:"LayerFault",timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getClickBalloonContent:a.proxy(this.getClickBalloonContent,this),ajaxOptions:{dataType:"jsonp"},fn_getClickURL:a.proxy(this.getClickURL,this)})};wundermap.layers.Fault.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"faults",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.Fault.getClickURL=function(c){var e={profile:"wmapv3_fault",lat:c.lat(),lon:c.lng()};var d="http://timelord.wunderground.com/cgi-bin/shapeclick?"+a.param(e);return d};wundermap.layers.Fissures=new wundermap.Layer();wundermap.layers.Fissures.className="Fissures";wundermap.layers.Fissures.initialize=function(e,c){var d={title:"Ground Fissures (Arizona only)",name:"fissures",sidebarPrefix:"LayerFissures",timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)})};wundermap.layers.Fissures.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"fissures",proj:"automerc",format:"gif",alpha:"1",stdout:"1"};var d="http://timelord.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.Fissures.getClickURL=function(c){var e={profile:"wmapv3_fissures",lat:c.lat(),lon:c.lng()};var d="http://timelord.wunderground.com/cgi-bin/shapeclick";d+="?"+a.param(e);return d};wundermap.layers.Fronts=new wundermap.Layer();wundermap.layers.Fronts.className="Fronts";wundermap.layers.Fronts.initialize=function(e,c){var d={name:"fronts",sidebarPrefix:"LayerFronts",clickable:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="fronts";this.addMarkerLayer({fn_getURL:a.proxy(this.getURL,this),ignoreEvents:["idle"],ajaxOptions:{dataType:"jsonp",cache:false},fn_getURLDataCallback:a.proxy(this.drawData,this)});this.timestamp=null};wundermap.layers.Fronts.getURL=function(d,g,f,h,k,c,l){var e="http://api.wunderground.com/api/"+wundermap.options.apikey+"/fronts/view.json";return e};wundermap.layers.Fronts.drawData=function(o){if(!o||!o.FRONTS||!o.FRONTS.FRONTS){return}var n=this.markerlayers_[0];n.removeOverlays();var f=o.FRONTS;var k=f.UTCDATE;this.utcdate=null;if(k&&k.year&&k.mon&&k.day&&k.hour){this.utcdate=new Date(Date.UTC(k.year,k.mon-1,k.day,k.hour,0,0,0))}for(var g in f.FRONTS){var c=f.FRONTS[g];var h=[];for(var e in c.points){var q=c.points[e];var m=new google.maps.LatLng(q.lat,q.lon);h.push(m)}var p=this.makeFront(c.type,h);this.markerlayers_[0].addMarker(p)}for(var g in f.HIGHS){var d=f.HIGHS[g];this.makeHighLow(d,true)}for(var g in f.LOWS){var l=f.LOWS[g];this.makeHighLow(l,false)}};wundermap.layers.Fronts.makeHighLow=function(l,m){var n=this;var c=0.5;var f=new google.maps.LatLngBounds(new google.maps.LatLng(parseFloat(l.lat)-c,parseFloat(l.lon)-c),new google.maps.LatLng(parseFloat(l.lat)+c,parseFloat(l.lon)+c));var d="#0000FF";var k="High Pressure";if(!m){d="#FF0000";k="Low Pressure"}var g=k+": "+l.pressuremb+" mb";var h=new google.maps.LatLng(parseFloat(l.lat),parseFloat(l.lon));var e=new google.maps.Marker({clickable:true,icon:this.makeIcon(m),map:null,position:h,title:g,visible:true});google.maps.event.addListener(e,"click",function(o){wundermap.openInfoBox({title:k,content:n.getBalloonContent(l.lat,l.lon,l.pressuremb),position:h})});this.markerlayers_[0].addMarker(e)};wundermap.layers.Fronts.getBalloonContent=function(e,h,g){var f=g+" mb";var c="Unknown";if(this.utcdate){c=wui.date.strftime("%a, %b %d, %Y %I:%M %p",this.utcdate,false)+" "+wundermap.options.timezone["short"]}var d='<div class="FrontsBalloon">';d+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';d+='<td class="full">Pressure: <span>';d+=f;d+="</span></td>";d+='<td class="vaT nobr dtr">Lat: <span>'+e.toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+h.toFixed(2)+"</span></td></tr></table>";d+='<div class="contentFooterPad taC brBot5">Last Updated: '+c+"</div>";d+="</div>";return d};wundermap.layers.Fronts.makeIcon=function(k){var g=30;var c=30;var h=0;var f=0;var l="H.png";if(k){l="H.png"}else{l="L.png"}var d=wundermap.options.iconsdomain+"/i/wm/fronts/";d=d+l;var e=new google.maps.MarkerImage(d,new google.maps.Size(g,c),null,new google.maps.Point(g/2+h,c/2+f));return e};wundermap.layers.Fronts.makeFront=function(e,d){var c=null;var f={path:"M 0,-1 0,1",strokeOpacity:1,strokeWeight:2,scale:5,strokeColor:"#999999"};if(e=="WARM"){c=new google.maps.Polyline({clickable:false,map:wundermap.map,path:d,strokeOpacity:1,strokeColor:"#FF0000",icons:[{icon:{path:"M 0,-2 A 2,2 0 0 0 0,2 z",fillColor:"red",fillOpacity:1,strokeWeight:1,scale:3},offset:"12px",repeat:"24px"}],zIndex:3})}else{if(e=="COLD"){c=new google.maps.Polyline({clickable:false,map:wundermap.map,path:d,strokeOpacity:1,strokeColor:"#0000FF",icons:[{icon:{path:"M 0,-2 0,2 -2,0 z",fillColor:"blue",fillOpacity:1,strokeWeight:1,scale:3},offset:"12px",repeat:"24px"}],zIndex:3})}else{if(e=="STNRY"){c=new google.maps.Polyline({clickable:false,map:wundermap.map,path:d,strokeOpacity:0,icons:[{icon:{path:"M 0,-4 0,4",strokeWeight:3,strokeOpacity:1,strokeColor:"blue"},offset:"0px",repeat:"48px"},{icon:{path:"M 0,-4 0,4",strokeWeight:3,strokeOpacity:1,strokeColor:"red"},offset:"24px",repeat:"48px"},{icon:{path:"M 0,-2 0,2 -2,0 z",fillColor:"blue",fillOpacity:1,scale:3},offset:"0",repeat:"48px"},{icon:{path:"M 0,-2 A 2,2 0 0 1 0,2 z",fillColor:"red",fillOpacity:1,scale:3},offset:"24px",repeat:"48px"}],zIndex:3})}else{if(e=="OCFNT"){c=new google.maps.Polyline({clickable:false,map:wundermap.map,path:d,strokeOpacity:1,strokeColor:"#912CEE",icons:[{icon:{path:"M 0,-4 A 2,2 0 0 0 0,0 L -3,2 0,4 z",fillColor:"#912CEE",fillOpacity:1,strokeWeight:1,scale:3},offset:"18px",repeat:"36px"}],zIndex:3})}else{c=new google.maps.Polyline({clickable:false,map:wundermap.map,path:d,strokeOpacity:0,icons:[{icon:f,offset:"0",repeat:"20px"}],zIndex:3})}}}}return c};wundermap.layers.Fronts.getPrefs=function(){return{}}})(jQuery);