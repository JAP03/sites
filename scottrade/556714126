ªHTTPS208.88.144.44"ı
5GET /Marketing/Javascript/searchSuggest.js HTTP/1.1
'Host: marketingcontent1.scottrade.com
Connection: keep-alive
Accept: */*
vUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36
%Referer: https://www.scottrade.com/
$Accept-Encoding: gzip,deflate,sdch
!Accept-Language: en-US,en;q=0.8

*∑*
HTTP/1.1 200 OK
Content-Length: 5147
(Content-Type: application/x-javascript
.Last-Modified: Tue, 28 Jan 2014 17:59:34 GMT
Accept-Ranges: bytes
ETag: "076ab3521ccf1:2da"
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
%Date: Tue, 08 Apr 2014 22:21:57 GMT
ù(

/* --- Symbol Suggest Autocomplete --- */

/*
* jQuery UI Autocomplete HTML Extension
* http://github.com/scottgonzalez/jquery-ui-extensions
*/
(function($) {
    var proto = $.ui.autocomplete.prototype,
        initSource = proto._initSource;
    function filter(array, term) {
        var matcher = new RegExp($.ui.autocomplete.escapeRegex(term), "i");
        return $.grep(array, function(value) {
            return matcher.test($("<div>").html(value.label || value.value || value).text());
        });
    }
    $.extend(proto, {
        _initSource: function() {
            if (this.options.html && $.isArray(this.options.source)) {
                this.source = function(request, response) {
                    response(filter(this.options.source, request.term));
                };
            } else {
                initSource.call(this);
            }
        },
        _renderItem: function(ul, item) {
            return $("<li></li>").data("item.autocomplete", item).append($("<a></a>")[this.options.html ? "html" : "text"](item.label)).appendTo(ul);
        }
    });

})(jQuery);



/**
* Stock Symbol Suggest - jQuery UI Plugin
* 
*/
(function($) {
    $.widget("ui.symbolsuggest", {
        exactMatch: false,
        WORKING: "WORKING",
        WAITING: "WAITING",
        STOPPED: "STOPPED",
        state: this.STOPPED,
        options: {
            source: "https://symbollookupsvcext.scottrade.com/SecuritiesService/SecuritiesService.svc/security/{0}?callback=?",
            delay: 5,
            searchUrl: "",
            quoteUrl: "",
            language: ""
        },
        _create: function() {
            var self = this,
                o = self.options,
                $el = self.element;
            $el.autocomplete({
                source: function(req, res) {
                    self._getSuggestions(req.term, res);
                },
                search: function(req, res) {
                	self.state = this.value != "" ? self.WORKING : self.STOPPED;
                    self.exactMatch = false;
                },
                select: function(req, res) {
                    self.exactMatch = true;
                },
                html: true,
                delay: o.delay,
                position: o.position
            }).keypress(function(e) {
                    if (!e) e = window.event;
                    if (e.keyCode == 13) {
                        self._submitQuery(e);
                    }
            });
            self.element.siblings("a").first().click(function(event) {
                self._submitQuery(event);
            });
            self.element.parents(".search-field").children(".search").first().click(function(event) {
                self._submitQuery(event);
            });
        },
        destroy: function() {
            this.element.autocomplete("destroy");
        },
        _getSuggestions: function(term, res) {
            var self = this,
                lastTerm = term.split(',').pop(),
                source = self.options.source.replace("{0}", encodeURIComponent(lastTerm));

            $.getJSON(source, function(data) {
                var suggestions = [];
                $.each(data, function(i, security) {
                    self.exactMatch = self.exactMatch || security.Symbol == lastTerm.toUpperCase();
                    suggestions.push({
                        label: self._getDisplayableRow(security, lastTerm),
                        value: security.Symbol
                    });
                });
                res(suggestions);
                if(self.state == self.WAITING) {
                	self.state = self.STOPPED;
                	self._submitQuery();
                } else {
                	self.state = self.STOPPED;
                }
            });
        },
        _highlightTerm: function(item, term) {
            var re = new RegExp("\\b" + term, "i");
            return item.replace(re, "<b>$&</b>");
        },
        _getDisplayableRow: function(sec, term) {
            var row = "<span class='security-sym'>" + this._highlightTerm(sec.Symbol, term) + "</span>";
            row += "<span class='security-name'>" + this._highlightTerm(sec.Name, term) + "</span>";
            row += "<span class='security-xch'>" + sec.Exchange + "</span>";
            return row;
        },
        _submitQuery: function(event) {
        	if(this.state == this.WORKING) {
        		this.state = this.WAITING;
        		setTimeout("location.href = \"" + this.options.searchUrl + "?q=" + encodeURIComponent(this.element[0].value) + "\";", 3000);
        		return false;
        	}
            if (this.options.searchUrl == "" || this.exactMatch) {
            	googleAnalyticsEvent(event, "Symbol Search", "_submitQuery");
                location.href = this.options.quoteUrl + "?lang=" + this.options.language + "&symbol=" + encodeURIComponent(this.element[0].value);
            } else {
                location.href = this.options.searchUrl + "?q=" + encodeURIComponent(this.element[0].value);
            }
        }
    });
})(jQuery);

/* --- End Symbol Suggest Autocomplete --- */
